function centerAlignStr(t){return'<div style="display:table-cell;vertical-align: middle; padding:0 10px">'+t+"</div>"}function shuffleArray(t){for(var e,i,n=t.length;n;e=Math.floor(Math.random()*n),i=t[--n],t[n]=t[e],t[e]=i);return t}function darkenColor(t){var e=tinycolor(t);return e.isDark()?e.lighten(25):e.darken()}function lightenColor(t){return tinycolor(t).lighten(25)}function gotoResultPage(t){"undefined"==typeof t&&(t=!1);var e="Thank you!",i="";i=gameHasBeenWon?"?win=true":"?win=false",1==gameAssets.game_type?e="You have mostly answered "+G_outcome:3==gameAssets.game_type||6==gameAssets.game_type?e="Your score is "+G_score+"%":8==gameAssets.game_type?e="Your score is "+G_score:4==gameAssets.game_type?e=G_outcome:5==gameAssets.game_type?e="You have found all the words!":9==gameAssets.game_type&&gameHasBeenWon?e="You have found the hidden sentence!":9!=gameAssets.game_type||gameHasBeenWon||(e="You couldn't find the hidden sentence!"),e=encodeURI(e),(gameHasBeenWon&&gameAssets.outcome_on_successful_result||!gameHasBeenWon&&gameAssets.outcome_on_successful_result)&&(i+="&outcome="+e);var n;if(n=gameAssets.is_rule_based&&gameresult.result_page_link?gameresult.result_page_link:"/games/result/"+gameAssets.oid+"/"+gameAssets.game_id+i,t)document.getElementById("endscreen").style.display="none",document.getElementById("loadingimg").style.display="block",window.location.href=n;else{var r=window.open(n,"name","height=700,width=800,scrollbars=1");window.focus&&r.focus()}}function GameResult(){this.message,this.capture_leads,this.collect_email,this.collect_name,this.collect_address,this.collect_phone,this.redirect,this.redirect_link,this.view_result_page,this.result_page_link,this.retry_btn,this.score_on_result_page,this.skip_message,watch(this,"message",function(){document.getElementById("message").innerHTML=this.message}),watch(this,"capture_leads",function(t,e,i){if(0==i&&(document.getElementById("message").className+=" verticalAlign",this.view_result_page?document.getElementById("leadform_btn").addEventListener("click",function(t){t.preventDefault(),gotoResultPage(!0)}):this.redirect?(document.getElementById("leadform_btn").setAttribute("target","_blank"),document.getElementById("leadform_btn").href=this.redirect_link):this.retry_btn?document.getElementById("leadform_btn").addEventListener("click",function(t){t.preventDefault(),document.getElementById("endscreen").style.display="none",document.getElementById("loadingimg").style.display="block",location.reload()}):document.getElementById("leadform_btn").style.display="none",document.getElementById("message_box").removeChild(document.getElementById("leadformbox"))),1==i){var n=document.getElementById("leadform_btn"),r=document.getElementById("leadform");n.addEventListener("click",function(t){t.preventDefault(),sendLead(r)})}}),watch(this,"collect_email",function(t,e,i){0==i&&document.getElementById("allfields").removeChild(document.getElementById("collect_email"))}),watch(this,"collect_phone",function(t,e,i){0==i&&document.getElementById("allfields").removeChild(document.getElementById("collect_phone"))}),watch(this,"collect_name",function(t,e,i){0==i&&document.getElementById("allfields").removeChild(document.getElementById("collect_fname"))}),watch(this,"collect_address",function(t,e,i){0==i&&document.getElementById("allfields").removeChild(document.getElementById("collect_address"))})}function copyToGameResult(t){gameresult.message=results[t].message.replace("[score]",G_score.toString()),gameresult.result_page_link="/games/rules/"+gameAssets.game_id+"/"+results[t].rid,gameAssets.capture_leads_successful=results[t].capture_leads,gameAssets.collect_email_successful=results[t].collect_email,gameAssets.collect_name_successful=results[t].collect_name,gameAssets.collect_address_successful=results[t].collect_address,gameAssets.collect_phone=results[t].collect_phone,gameAssets.redirect_on_successful=results[t].redirect,gameAssets.successful_btn.link=results[t].redirect_link,gameAssets.view_result_on_successful=results[t].view_result_page,gameAssets.skip_resultpage_successful=results[t].skip_message,gameAssets.retry_btn_successful=results[t].retry_btn,gameAssets.outcome_on_successful_result=results[t].score_on_result_page}function initVariables(){indAnalytics.GameId=gameAssets.game_id,indAnalytics.oid=gameAssets.oid,gameresult=new GameResult}function postLead(t){var e=new XMLHttpRequest;e.open("POST","/savelead"),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(t)}function sendLead(t){for(var e={},i=[],n=0;n<t.length;n++){if(""==t.elements[n].value)return document.getElementById("notification").innerHTML=gameAssets.missing_fields_msg,!1;e[t.elements[n].name]=t.elements[n].value}var r=e.email,s=gameAssets.collect_email_successful;if(gameHasBeenWon||(s=gameAssets.collect_email_unsuccessful),s&&!validateEmail(r))return document.getElementById("notification").innerHTML=gameAssets.email_invalid_msg,!1;e.outcome=G_outcome,e.score=G_score,e.lid=lead_id,gameAssets.record_ind_analytics&&(e.field1=gameAssets.field_1,e.field2=gameAssets.field_2),e.answers=JSON.stringify(answersArr),e.timetocomp=internalCounter.toString();for(key in e)i.push(encodeURIComponent(key)+"="+encodeURIComponent(e[key]));var a=i.join("&").replace(/%20/g,"+");postLead(a),document.getElementById("message").innerHTML=gameAssets.thank_u_msg,gameAssets.facebook_pixel&&_fbq.push(["track","ViewContent"]),document.getElementById("leadformbox").style.display="none",document.getElementById("leadform_btn").style.display="none",loadSharingButtons(),gameresult.redirect?window.open(gameresult.redirect_link):gameresult.view_result_page?gotoResultPage(!0):gameresult.retry_btn&&location.reload()}function saveIndAnalytics(){postLead("oid="+gameAssets.oid+"&game_id="+gameAssets.game_id+"&outcome="+G_outcome+"&timetocomp="+internalCounter.toString()+"&field1="+encodeURIComponent(gameAssets.field_1)+"&field2="+encodeURIComponent(gameAssets.field_2)+"&answers="+JSON.stringify(answersArr)+"&score="+G_score)}function hex2rgb(t,e){"#"==t[0]&&(t=t.substr(1));var i=t.match(/.{1,2}/g),n=1;return void 0!=e&&(n=e),"rgba("+parseInt(i[0],16)+","+parseInt(i[1],16)+","+parseInt(i[2],16)+","+n+")"}function displayResultIcon(t){resultMark.visible=!0,t?(resultMark.text("&#10004;"),resultMark.css({color:"#00a000"})):(resultMark.text("&#x2717;"),resultMark.css({color:"#c73417"}))}function validateEmail(t){var e=/\S+@\S+\.\S+/;return e.test(t)}function increaseCounter(){internalCounter++}function increaseNPlayers(){xmlhttp=new XMLHttpRequest,xmlhttp.open("POST","/incrementp",!0),xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xmlhttp.send("oid="+gameAssets.oid+"&game_id="+gameAssets.game_id+"&ref=web"),Parse.Cloud.run("increaseNPlayers",{game_id:gameAssets.game_id,oid:gameAssets.oid})}function loadSharingButtons(){if(gameAssets.social_btns){document.getElementById("sharebox").style.display="block";var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5490bbbf4d923c03"),document.head.appendChild(t),t.onload=function(){void 0!==typeof addthis&&addthis.init()}}}function saveGroupedAnalytics(){Parse.Cloud.run("saveGroupedAnalytics",{game_id:gameAssets.game_id,oid:gameAssets.oid,game_type:gameAssets.game_type,answers:JSON.stringify(answersArr)}),analyticSaved=!0}function setBG(){Crafty.background(""!=gameAssets.bgnd_image&&void 0!=gameAssets.bgnd_image?"url('"+gameAssets.bgnd_image+"') no-repeat":void 0!=gameAssets.bgnd_color&&""!=gameAssets.bgnd_color?gameAssets.bgnd_color:"#2d3d4b")}function displayBG(){setBG(),Crafty.c("TimeBar",{init:function(){this.addComponent("2D, DOM, Color"),this.color(gameAssets.banner.bgnd_color),this.css({display:"table","text-align":"center","border-top":"1px solid #ffffff","border-bottom":"1px solid #ffffff","border-right":"1px solid #ffffff","background-color":gameAssets.banner.bgnd_color})}}),resultMark=Crafty.e("2D, DOM, Text, Mouse").attr({x:Crafty.viewport.width/2-50,y:.45*Crafty.viewport.height,w:100,h:150,z:10}).textFont({size:"150px"}),resultMark.visible=!1,gameAssets.display_logo&&(Crafty.sprite(0,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAZCAYAAAC7OJeSAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0RJREFUeNpi+P//f/9/KoPPX779r+mcQbI+JkZGxkIGBoYDDFQCX75+Zyiq72cw0FYlWS8LlA4E4vtALEBIw8Wrt7GKi4sJMUiICjN0Tl3EcOfBE4YmM32capEBNzcng4qCDJjNCBMEhpIBkDpPSLNTSBZW8eaydLAjFq7aCubvWzMNp1pkYKCtxtDXWIASMgzA6LoAdBAoyvoJGSAhJszg7mAB5/MAfaesKAMOFeToyk4MAdO4wM4DJ7BGE8xBE4AOsgcyA/A6Bhgd8WHeKGJT569Bsfjo6YsMwd5OcP7tw3cZVG2V8UY5Exa7EoH4AqmJD2Q5LNhBABZdMPDjy0+GM6vwpwIMxwBD5wPUQR9IccyLV2/BtD4wF4FCDcRHdpCcoQzDkXknGX4CHUW0Y2DpB0gVEnIAKMFiC+7YYFdwCIEcA5P7+PwT2CFnVl0gzTFQBy0AUgvwOWbt1n0Y0QECT65tZyjLiQWza7tmgNMSzBGn8UQVEz7LgA7Cm35gvkd30M9v7xjYfj1mcHe0ADukvnoaOAGD5YChc3n7NdIdg1QgfsBe2n4D0xeu3kJxIAi8f36VwdXWCFygNbZmMfBL8sHVPD7/lDzHAEPnAZCaiC/NIJc3WiqSYPa/v78YlMSYGEqSnBn+fXuKkq1f3n5NnmOA5Y4CkMonpmoAlStf3z+C8z+9vs3A+Pkaw6c3t4G5SRou/opcxwDBelx1Fiw7Izvm7ZPzKGkHBL5/esHAzsNO0CImAqEyH5QMiClnQGmF+e9HcPSQC5jwOCQBSCUQqqPQcxE2wMrOg1LYiamKEu8YaA1OsMK0NtVHSsyPGTj5JLCq4xNVBWbte3C+GlodhdMxQIeA0sd8Yto2oGIflINgtfSW/ReAFqugqGHnEmJ4fI6B4fI2SNkCyuImYQZEhwzR6QTkkL7GQriDQDX3keu/GcSVbMGhJCpvzvDquhzDjs6DcIcEtfngTMwsaKFSQKj5gA5Ahdqsnip4PQRy0M79MgwJ7p4Ml+pOguskUBoBRQ0oRPDlKhZS0wmu9k15dhyGuJWrIeltYGg62U+sJlDxT0yTktgiAT1k1hOTYGGJlpoAuXhgBPWbgHQBwyAAAAEGAOICzKZN5ApuAAAAAElFTkSuQmCC",{smalllogo:[0,0]}),Crafty.c("SmallLogo",{init:function(){this.addComponent("2D, DOM, smalllogo, Mouse"),this.css({cursor:"pointer"}),this.bind("Click",function(){window.open("https://www.fyrebox.com?utm_source=fyrebox&utm_medium=game&utm_campaign=live_game_logo")})}}),Crafty.e("SmallLogo").attr({x:665,y:375,w:35,h:25}))}!function(){function t(i,n){if(i=i?i:"",n=n||{},i instanceof t)return i;if(!(this instanceof t))return new t(i,n);var r=e(i);this._originalInput=i,this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=z(100*this._a)/100,this._format=n.format||r.format,this._gradientType=n.gradientType,this._r<1&&(this._r=z(this._r)),this._g<1&&(this._g=z(this._g)),this._b<1&&(this._b=z(this._b)),this._ok=r.ok,this._tc_id=F++}function e(t){var e={r:0,g:0,b:0},n=1,s=!1,o=!1;return"string"==typeof t&&(t=j(t)),"object"==typeof t&&(t.hasOwnProperty("r")&&t.hasOwnProperty("g")&&t.hasOwnProperty("b")?(e=i(t.r,t.g,t.b),s=!0,o="%"===String(t.r).substr(-1)?"prgb":"rgb"):t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("v")?(t.s=R(t.s),t.v=R(t.v),e=a(t.h,t.s,t.v),s=!0,o="hsv"):t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("l")&&(t.s=R(t.s),t.l=R(t.l),e=r(t.h,t.s,t.l),s=!0,o="hsl"),t.hasOwnProperty("a")&&(n=t.a)),n=A(n),{ok:s,format:t.format||o,r:B(255,L(e.r,0)),g:B(255,L(e.g,0)),b:B(255,L(e.b,0)),a:n}}function i(t,e,i){return{r:255*C(t,255),g:255*C(e,255),b:255*C(i,255)}}function n(t,e,i){t=C(t,255),e=C(e,255),i=C(i,255);var n,r,s=L(t,e,i),a=B(t,e,i),o=(s+a)/2;if(s==a)n=r=0;else{var u=s-a;switch(r=o>.5?u/(2-s-a):u/(s+a),s){case t:n=(e-i)/u+(i>e?6:0);break;case e:n=(i-t)/u+2;break;case i:n=(t-e)/u+4}n/=6}return{h:n,s:r,l:o}}function r(t,e,i){function n(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+6*(e-t)*(2/3-i):t}var r,s,a;if(t=C(t,360),e=C(e,100),i=C(i,100),0===e)r=s=a=i;else{var o=.5>i?i*(1+e):i+e-i*e,u=2*i-o;r=n(u,o,t+1/3),s=n(u,o,t),a=n(u,o,t-1/3)}return{r:255*r,g:255*s,b:255*a}}function s(t,e,i){t=C(t,255),e=C(e,255),i=C(i,255);var n,r,s=L(t,e,i),a=B(t,e,i),o=s,u=s-a;if(r=0===s?0:u/s,s==a)n=0;else{switch(s){case t:n=(e-i)/u+(i>e?6:0);break;case e:n=(i-t)/u+2;break;case i:n=(t-e)/u+4}n/=6}return{h:n,s:r,v:o}}function a(t,e,i){t=6*C(t,360),e=C(e,100),i=C(i,100);var n=U.floor(t),r=t-n,s=i*(1-e),a=i*(1-r*e),o=i*(1-(1-r)*e),u=n%6,c=[i,a,s,s,o,i][u],h=[o,i,i,a,s,s][u],l=[s,s,o,i,i,a][u];return{r:255*c,g:255*h,b:255*l}}function o(t,e,i,n){var r=[D(z(t).toString(16)),D(z(e).toString(16)),D(z(i).toString(16))];return n&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function u(t,e,i,n){var r=[D(P(n)),D(z(t).toString(16)),D(z(e).toString(16)),D(z(i).toString(16))];return r.join("")}function c(e,i){i=0===i?0:i||10;var n=t(e).toHsl();return n.s-=i/100,n.s=E(n.s),t(n)}function h(e,i){i=0===i?0:i||10;var n=t(e).toHsl();return n.s+=i/100,n.s=E(n.s),t(n)}function l(e){return t(e).desaturate(100)}function d(e,i){i=0===i?0:i||10;var n=t(e).toHsl();return n.l+=i/100,n.l=E(n.l),t(n)}function f(e,i){i=0===i?0:i||10;var n=t(e).toRgb();return n.r=L(0,B(255,n.r-z(255*-(i/100)))),n.g=L(0,B(255,n.g-z(255*-(i/100)))),n.b=L(0,B(255,n.b-z(255*-(i/100)))),t(n)}function p(e,i){i=0===i?0:i||10;var n=t(e).toHsl();return n.l-=i/100,n.l=E(n.l),t(n)}function _(e,i){var n=t(e).toHsl(),r=(z(n.h)+i)%360;return n.h=0>r?360+r:r,t(n)}function g(e){var i=t(e).toHsl();return i.h=(i.h+180)%360,t(i)}function m(e){var i=t(e).toHsl(),n=i.h;return[t(e),t({h:(n+120)%360,s:i.s,l:i.l}),t({h:(n+240)%360,s:i.s,l:i.l})]}function v(e){var i=t(e).toHsl(),n=i.h;return[t(e),t({h:(n+90)%360,s:i.s,l:i.l}),t({h:(n+180)%360,s:i.s,l:i.l}),t({h:(n+270)%360,s:i.s,l:i.l})]}function y(e){var i=t(e).toHsl(),n=i.h;return[t(e),t({h:(n+72)%360,s:i.s,l:i.l}),t({h:(n+216)%360,s:i.s,l:i.l})]}function b(e,i,n){i=i||6,n=n||30;var r=t(e).toHsl(),s=360/n,a=[t(e)];for(r.h=(r.h-(s*i>>1)+720)%360;--i;)r.h=(r.h+s)%360,a.push(t(r));return a}function w(e,i){i=i||6;for(var n=t(e).toHsv(),r=n.h,s=n.s,a=n.v,o=[],u=1/i;i--;)o.push(t({h:r,s:s,v:a})),a=(a+u)%1;return o}function x(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[t[i]]=i);return e}function A(t){return t=parseFloat(t),(isNaN(t)||0>t||t>1)&&(t=1),t}function C(t,e){S(t)&&(t="100%");var i=M(t);return t=B(e,L(0,parseFloat(t))),i&&(t=parseInt(t*e,10)/100),U.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function E(t){return B(1,L(0,t))}function O(t){return parseInt(t,16)}function S(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)}function M(t){return"string"==typeof t&&-1!=t.indexOf("%")}function D(t){return 1==t.length?"0"+t:""+t}function R(t){return 1>=t&&(t=100*t+"%"),t}function P(t){return Math.round(255*parseFloat(t)).toString(16)}function k(t){return O(t)/255}function j(t){t=t.replace(I,"").replace(T,"").toLowerCase();var e=!1;if(H[t])t=H[t],e=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=K.rgb.exec(t))?{r:i[1],g:i[2],b:i[3]}:(i=K.rgba.exec(t))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=K.hsl.exec(t))?{h:i[1],s:i[2],l:i[3]}:(i=K.hsla.exec(t))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=K.hsv.exec(t))?{h:i[1],s:i[2],v:i[3]}:(i=K.hsva.exec(t))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=K.hex8.exec(t))?{a:k(i[1]),r:O(i[2]),g:O(i[3]),b:O(i[4]),format:e?"name":"hex8"}:(i=K.hex6.exec(t))?{r:O(i[1]),g:O(i[2]),b:O(i[3]),format:e?"name":"hex"}:(i=K.hex3.exec(t))?{r:O(i[1]+""+i[1]),g:O(i[2]+""+i[2]),b:O(i[3]+""+i[3]),format:e?"name":"hex"}:!1}function N(t){var e,i;return t=t||{level:"AA",size:"small"},e=(t.level||"AA").toUpperCase(),i=(t.size||"small").toLowerCase(),"AA"!==e&&"AAA"!==e&&(e="AA"),"small"!==i&&"large"!==i&&(i="small"),{level:e,size:i}}var I=/^[\s,#]+/,T=/\s+$/,F=0,U=Math,z=U.round,B=U.min,L=U.max,q=U.random;t.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,i,n,r,s,a=this.toRgb();return t=a.r/255,e=a.g/255,i=a.b/255,n=.03928>=t?t/12.92:Math.pow((t+.055)/1.055,2.4),r=.03928>=e?e/12.92:Math.pow((e+.055)/1.055,2.4),s=.03928>=i?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*n+.7152*r+.0722*s},setAlpha:function(t){return this._a=A(t),this._roundA=z(100*this._a)/100,this},toHsv:function(){var t=s(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=s(this._r,this._g,this._b),e=z(360*t.h),i=z(100*t.s),n=z(100*t.v);return 1==this._a?"hsv("+e+", "+i+"%, "+n+"%)":"hsva("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var t=n(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=n(this._r,this._g,this._b),e=z(360*t.h),i=z(100*t.s),r=z(100*t.l);return 1==this._a?"hsl("+e+", "+i+"%, "+r+"%)":"hsla("+e+", "+i+"%, "+r+"%, "+this._roundA+")"},toHex:function(t){return o(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(){return u(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:z(this._r),g:z(this._g),b:z(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+z(this._r)+", "+z(this._g)+", "+z(this._b)+")":"rgba("+z(this._r)+", "+z(this._g)+", "+z(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:z(100*C(this._r,255))+"%",g:z(100*C(this._g,255))+"%",b:z(100*C(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+z(100*C(this._r,255))+"%, "+z(100*C(this._g,255))+"%, "+z(100*C(this._b,255))+"%)":"rgba("+z(100*C(this._r,255))+"%, "+z(100*C(this._g,255))+"%, "+z(100*C(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":this._a<1?!1:G[o(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var i="#"+u(this._r,this._g,this._b,this._a),n=i,r=this._gradientType?"GradientType = 1, ":"";if(e){var s=t(e);n=s.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+i+",endColorstr="+n+")"},toString:function(t){var e=!!t;t=t||this._format;var i=!1,n=this._a<1&&this._a>=0,r=!e&&n&&("hex"===t||"hex6"===t||"hex3"===t||"name"===t);return r?"name"===t&&0===this._a?this.toName():this.toRgbString():("rgb"===t&&(i=this.toRgbString()),"prgb"===t&&(i=this.toPercentageRgbString()),("hex"===t||"hex6"===t)&&(i=this.toHexString()),"hex3"===t&&(i=this.toHexString(!0)),"hex8"===t&&(i=this.toHex8String()),"name"===t&&(i=this.toName()),"hsl"===t&&(i=this.toHslString()),"hsv"===t&&(i=this.toHsvString()),i||this.toHexString())},_applyModification:function(t,e){var i=t.apply(null,[this].concat([].slice.call(e)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(d,arguments)},brighten:function(){return this._applyModification(f,arguments)},darken:function(){return this._applyModification(p,arguments)},desaturate:function(){return this._applyModification(c,arguments)},saturate:function(){return this._applyModification(h,arguments)},greyscale:function(){return this._applyModification(l,arguments)},spin:function(){return this._applyModification(_,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(b,arguments)},complement:function(){return this._applyCombination(g,arguments)},monochromatic:function(){return this._applyCombination(w,arguments)},splitcomplement:function(){return this._applyCombination(y,arguments)},triad:function(){return this._applyCombination(m,arguments)},tetrad:function(){return this._applyCombination(v,arguments)}},t.fromRatio=function(e,i){if("object"==typeof e){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]="a"===r?e[r]:R(e[r]));e=n}return t(e,i)},t.equals=function(e,i){return e&&i?t(e).toRgbString()==t(i).toRgbString():!1},t.random=function(){return t.fromRatio({r:q(),g:q(),b:q()})},t.mix=function(e,i,n){n=0===n?0:n||50;var r,s=t(e).toRgb(),a=t(i).toRgb(),o=n/100,u=2*o-1,c=a.a-s.a;r=-1==u*c?u:(u+c)/(1+u*c),r=(r+1)/2;var h=1-r,l={r:a.r*r+s.r*h,g:a.g*r+s.g*h,b:a.b*r+s.b*h,a:a.a*o+s.a*(1-o)};return t(l)},t.readability=function(e,i){var n=t(e),r=t(i);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)},t.isReadable=function(e,i,n){var r,s,a=t.readability(e,i);switch(s=!1,r=N(n),r.level+r.size){case"AAsmall":case"AAAlarge":s=a>=4.5;break;case"AAlarge":s=a>=3;break;case"AAAsmall":s=a>=7}return s},t.mostReadable=function(e,i,n){var r,s,a,o,u=null,c=0;n=n||{},s=n.includeFallbackColors,a=n.level,o=n.size;for(var h=0;h<i.length;h++)r=t.readability(e,i[h]),r>c&&(c=r,u=t(i[h]));return t.isReadable(e,u,{level:a,size:o})||!s?u:(n.includeFallbackColors=!1,t.mostReadable(e,["#fff","#000"],n))};var H=t.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},G=t.hexNames=x(H),K=function(){var t="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",i="(?:"+e+")|(?:"+t+")",n="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?",r="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?";return{rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+r),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):window.tinycolor=t}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function this_value(){return this.valueOf()}function quote(t){return rx_escapable.lastIndex=0,rx_escapable.test(t)?'"'+t.replace(rx_escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,n,r,s,a,o=gap,u=e[t];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(t)),"function"==typeof rep&&(u=rep.call(e,t,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(u)){for(s=u.length,i=0;s>i;i+=1)a[i]=str(i,u)||"null";return r=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+o+"]":"["+a.join(",")+"]",gap=o,r}if(rep&&"object"==typeof rep)for(s=rep.length,i=0;s>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],r=str(n,u),r&&a.push(quote(n)+(gap?": ":":")+r));else for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(r=str(n,u),r&&a.push(quote(n)+(gap?": ":":")+r));return r=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+o+"}":"{"+a.join(",")+"}",gap=o,r}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var i,n,r=t[e];if(r&&"object"==typeof r)for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n=walk(r,i),void 0!==n?r[i]=n:delete r[i]);return reviver.call(t,e,r)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function t(e,i,n){function r(a,o){if(!i[a]){if(!e[a]){var u="function"==typeof require&&require;if(!o&&u)return u(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=i[a]={exports:{}};e[a][0].call(c.exports,function(t){var i=e[a][1][t];return r(i?i:t)},c,c.exports,t,e,i,n)}return i[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t){var e=t("./core.js"),i=(window.document,t("./HashMap.js"));e._rectPool=function(){var t=[],e=0;return{get:function(i,n,r,s){t.length<=e&&t.push({});var a=t[e++];return a._x=i,a._y=n,a._w=r,a._h=s,a},copy:function(i){t.length<=e&&t.push({});var n=t[e++];return n._x=i._x,n._y=i._y,n._w=i._w,n._h=i._h,n},recycle:function(){e--}}}(),e.map=new i;var n=Math,r=(n.cos,n.sin,n.PI),s=r/180;e.extend({zeroFill:function(t,e){return e-=t.toString().length,e>0?new Array(e+(/\./.test(t)?2:1)).join("0")+t:t.toString()}}),e.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_rotation:0,_alpha:1,_visible:!0,_globalZ:null,_origin:null,_mbr:null,_entry:null,_children:null,_parent:null,_changed:!1,_define2DProperties:function(){Object.defineProperty(this,"x",{set:function(t){this._attr("_x",t)},get:function(){return this._x},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_x",{enumerable:!1}),Object.defineProperty(this,"y",{set:function(t){this._attr("_y",t)},get:function(){return this._y},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_y",{enumerable:!1}),Object.defineProperty(this,"w",{set:function(t){this._attr("_w",t)},get:function(){return this._w},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_w",{enumerable:!1}),Object.defineProperty(this,"h",{set:function(t){this._attr("_h",t)},get:function(){return this._h},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_h",{enumerable:!1}),Object.defineProperty(this,"z",{set:function(t){this._attr("_z",t)},get:function(){return this._z},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_z",{enumerable:!1}),Object.defineProperty(this,"rotation",{set:function(t){this._attr("_rotation",t)},get:function(){return this._rotation},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_rotation",{enumerable:!1}),Object.defineProperty(this,"alpha",{set:function(t){this._attr("_alpha",t)},get:function(){return this._alpha},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_alpha",{enumerable:!1}),Object.defineProperty(this,"visible",{set:function(t){this._attr("_visible",t)},get:function(){return this._visible},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_visible",{enumerable:!1})},init:function(){this._globalZ=this[0],this._origin={x:0,y:0},this._bx1=0,this._bx2=0,this._by1=0,this._by2=0,this._children=[],this._define2DProperties(),this._entry=e.map.insert(this),this.bind("Move",function(t){var e=this._cbr||this._mbr||this;this._entry.update(e),this._children.length>0&&this._cascade(t)}),this.bind("Rotate",function(t){var e=this._cbr||this._mbr||this;this._entry.update(e),this._children.length>0&&this._cascade(t)}),this.bind("Remove",function(){if(this._children){for(var t=0;t<this._children.length;t++)delete this._children[t]._parent,this._children[t].destroy&&this._children[t].destroy();this._children=[]}this._parent&&this._parent.detach(this),e.map.remove(this),this.detach()})},offsetBoundary:function(t,e,i,n){return 1===arguments.length&&(e=i=n=t),this._bx1=t,this._bx2=i,this._by1=e,this._by2=n,this.trigger("BoundaryOffset"),this._calculateMBR(),this},_calculateMBR:function(){var t=this._origin.x+this._x,e=this._origin.y+this._y,i=-this._rotation*s,n=this._x-this._bx1-t,r=this._x+this._w+this._bx2-t,a=this._y-this._by1-e,o=this._y+this._h+this._by2-e,u=Math.cos(i),c=Math.sin(i);u=1e-10>u&&u>-1e-10?0:u,c=1e-10>c&&c>-1e-10?0:c;var h=n*u+a*c,l=-n*c+a*u,d=r*u+a*c,f=-r*c+a*u,p=r*u+o*c,_=-r*c+o*u,g=n*u+o*c,m=-n*c+o*u,v=Math.floor(Math.min(h,d,p,g)+t),y=Math.floor(Math.min(l,f,_,m)+e),b=Math.ceil(Math.max(h,d,p,g)+t),w=Math.ceil(Math.max(l,f,_,m)+e);if(this._mbr?(this._mbr._x=v,this._mbr._y=y,this._mbr._w=b-v,this._mbr._h=w-y):this._mbr={_x:v,_y:y,_w:b-v,_h:w-y},this._cbr){var x=this._cbr,A=x.cx,C=x.cy,E=x.r,O=t+(A+this._x-t)*u+(C+this._y-e)*c,S=e-(A+this._x-t)*c+(C+this._y-e)*u;x._x=Math.min(O-E,v),x._y=Math.min(S-E,y),x._w=Math.max(O+E,b)-x._x,x._h=Math.max(S+E,w)-x._y}},_rotate:function(t){var e=-1*(t%360),i=this._rotation-t;if(0!==i){this._rotation=t;var n=e*s,r={x:this._origin.x+this._x,y:this._origin.y+this._y};this._calculateMBR();{var a=i*s;Math.cos(n),Math.sin(n)}this.trigger("Rotate",{cos:Math.cos(a),sin:Math.sin(a),deg:i,rad:a,o:r})}},area:function(){return this._w*this._h},intersect:function(t,e,i,n){var r,s=this._mbr||this;return r="object"==typeof t?t:{x:t,y:e,w:i,h:n},s._x<r.x+r.w&&s._x+s._w>r.x&&s._y<r.y+r.h&&s._h+s._y>r.y},within:function(t,e,i,n){var r,s=this._mbr||this;return r="object"==typeof t?t:{_x:t,_y:e,_w:i,_h:n},r._x<=s._x&&r._x+r._w>=s._x+s._w&&r._y<=s._y&&r._y+r._h>=s._y+s._h
},contains:function(t,e,i,n){var r,s=this._mbr||this;return r="object"==typeof t?t:{_x:t,_y:e,_w:i,_h:n},r._x>=s._x&&r._x+r._w<=s._x+s._w&&r._y>=s._y&&r._y+r._h<=s._y+s._h},pos:function(){return{_x:this._x,_y:this._y,_w:this._w,_h:this._h}},mbr:function(){return this._mbr?{_x:this._mbr._x,_y:this._mbr._y,_w:this._mbr._w,_h:this._mbr._h}:this.pos()},isAt:function(t,e){if(this.mapArea)return this.mapArea.containsPoint(t,e);if(this.map)return this.map.containsPoint(t,e);var i=this._mbr||this;return i._x<=t&&i._x+i._w>=t&&i._y<=e&&i._y+i._h>=e},move:function(t,e){return"n"===t.charAt(0)&&(this.y-=e),"s"===t.charAt(0)&&(this.y+=e),("e"===t||"e"===t.charAt(1))&&(this.x+=e),("w"===t||"w"===t.charAt(1))&&(this.x-=e),this},shift:function(t,e,i,n){return t&&(this.x+=t),e&&(this.y+=e),i&&(this.w+=i),n&&(this.h+=n),this},_cascade:function(t){if(t){var e,i=0,n=this._children,r=n.length;if("cos"in t||"sin"in t)for(;r>i;++i)e=n[i],"rotate"in e&&e.rotate(t);else for(var s=this._x-t._x,a=this._y-t._y,o=this._w-t._w,u=this._h-t._h;r>i;++i)e=n[i],e.shift(s,a,o,u)}},attach:function(){for(var t,e=0,i=arguments,n=arguments.length;n>e;++e)t=i[e],t._parent&&t._parent.detach(t),t._parent=this,this._children.push(t);return this},detach:function(t){var e;if(!t){for(e=0;e<this._children.length;e++)this._children[e]._parent=null;return this._children=[],this}for(e=0;e<this._children.length;e++)this._children[e]==t&&this._children.splice(e,1);return t._parent=null,this},origin:function(t,e){if("string"==typeof t)if("centre"===t||"center"===t||-1===t.indexOf(" "))t=this._w/2,e=this._h/2;else{var i=t.split(" ");"top"===i[0]?e=0:"bottom"===i[0]?e=this._h:("middle"===i[0]||"center"===i[1]||"centre"===i[1])&&(e=this._h/2),"center"===i[1]||"centre"===i[1]||"middle"===i[1]?t=this._w/2:"left"===i[1]?t=0:"right"===i[1]&&(t=this._w)}return this._origin.x=t,this._origin.y=e,this},flip:function(t){return t=t||"X",this["_flip"+t]||(this["_flip"+t]=!0,this.trigger("Invalidate")),this},unflip:function(t){return t=t||"X",this["_flip"+t]&&(this["_flip"+t]=!1,this.trigger("Invalidate")),this},rotate:function(t){var e,i;e=(this._x+this._origin.x-t.o.x)*t.cos+(this._y+this._origin.y-t.o.y)*t.sin+(t.o.x-this._origin.x),i=(this._y+this._origin.y-t.o.y)*t.cos-(this._x+this._origin.x-t.o.x)*t.sin+(t.o.y-this._origin.y),this._attr("_rotation",this._rotation-t.deg),this._attr("_x",e),this._attr("_y",i)},_attr:function(t,i){if(this[t]!==i){var n,r=e._rectPool.copy(this);if("_rotation"===t)this._rotate(i);else if("_z"===t)this._globalZ=parseInt(i+e.zeroFill(this[0],5),10),this.trigger("reorder");else if("_x"===t||"_y"===t)n=this._mbr,n&&(n[t]-=this[t]-i,this._cbr&&(this._cbr[t]-=this[t]-i)),this[t]=i,this.trigger("Move",r);else if("_h"===t||"_w"===t){n=this._mbr;var s=this[t];this[t]=i,n&&this._calculateMBR(),"_w"===t?this.trigger("Resize",{axis:"w",amount:i-s}):"_h"===t&&this.trigger("Resize",{axis:"h",amount:i-s}),this.trigger("Move",r)}this[t]=i,this.trigger("Invalidate"),e._rectPool.recycle(r)}}}),e.c("Gravity",{_gravityConst:.2,_gy:0,_falling:!0,_anti:null,init:function(){this.requires("2D")},gravity:function(t){return t&&(this._anti=t),isNaN(this._jumpSpeed)&&(this._jumpSpeed=0),this.bind("EnterFrame",this._enterFrame),this},gravityConst:function(t){return this._gravityConst=t,this},_enterFrame:function(){this._falling?(this._gy+=this._gravityConst,this.y+=this._gy,this.trigger("Moved",{x:this._x,y:this._y-this._gy})):this._gy=0;var t,i,n,r=!1,s=this.pos(),a=0;for(s._y++,s.x=s._x,s.y=s._y,s.w=s._w,s.h=s._h,i=e.map.search(s),n=i.length;n>a;++a)if(t=i[a],t!==this&&t.has(this._anti)&&t.intersect(s)){r=t;break}r?this._falling&&(this._gy>this._jumpSpeed||!this._up)&&this.stopFalling(r):this._falling=!0},stopFalling:function(t){t&&(this.y=t._y-this._h),this._falling=!1,this._up&&(this._up=!1),this.trigger("hit")},antigravity:function(){this.unbind("EnterFrame",this._enterFrame)}}),e.polygon=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0)),this.points=t},e.polygon.prototype={containsPoint:function(t,e){var i,n,r=this.points,s=!1;for(i=0,n=r.length-1;i<r.length;n=i++)r[i][1]>e!=r[n][1]>e&&t<(r[n][0]-r[i][0])*(e-r[i][1])/(r[n][1]-r[i][1])+r[i][0]&&(s=!s);return s},shift:function(t,e){for(var i,n=0,r=this.points.length;r>n;n++)i=this.points[n],i[0]+=t,i[1]+=e},rotate:function(t){for(var e,i,n,r=0,s=this.points.length;s>r;r++)e=this.points[r],i=t.o.x+(e[0]-t.o.x)*t.cos+(e[1]-t.o.y)*t.sin,n=t.o.y-(e[0]-t.o.x)*t.sin+(e[1]-t.o.y)*t.cos,e[0]=i,e[1]=n}},e.circle=function(t,e,i){this.x=t,this.y=e,this.radius=i,this.points=[];for(var n,r=0;8>r;r++)n=r*Math.PI/4,this.points[r]=[this.x+Math.sin(n)*i,this.y+Math.cos(n)*i]},e.circle.prototype={containsPoint:function(t,e){var i=this.radius,n=(Math.sqrt,this.x-t),r=this.y-e;return i*i>n*n+r*r},shift:function(t,e){this.x+=t,this.y+=e;for(var i,n=0,r=this.points.length;r>n;n++)i=this.points[n],i[0]+=t,i[1]+=e},rotate:function(){}},e.matrix=function(t){this.mtx=t,this.width=t[0].length,this.height=t.length},e.matrix.prototype={x:function(t){if(this.width==t.height){for(var i=[],n=0;n<this.height;n++){i[n]=[];for(var r=0;r<t.width;r++){for(var s=0,a=0;a<this.width;a++)s+=this.mtx[n][a]*t.mtx[a][r];i[n][r]=s}}return new e.matrix(i)}},e:function(t,e){return 1>t||t>this.mtx.length||1>e||e>this.mtx[0].length?null:this.mtx[t-1][e-1]}}},{"./HashMap.js":4,"./core.js":10}],2:[function(t){var e=t("./core.js"),i=window.document;e.c("DOM",{_element:null,_cssStyles:null,avoidCss3dTransforms:!1,init:function(){this._cssStyles={visibility:"",left:"",top:"",width:"",height:"",zIndex:"",opacity:"",transformOrigin:"",transform:""},this._element=i.createElement("div"),e.stage.inner.appendChild(this._element),this._element.style.position="absolute",this._element.id="ent"+this[0],this.bind("Invalidate",this._invalidateDOM),this.bind("NewComponent",this._updateClass),this.bind("RemoveComponent",this._removeClass),this._invalidateDOM()},remove:function(){this.undraw(),this.unbind("NewComponent",this._updateClass),this.unbind("RemoveComponent",this._removeClass),this.unbind("Invalidate",this._invalidateDOM)},getDomId:function(){return this._element.id},_removeClass:function(t){var e=0,i=this.__c,n="";for(e in i)e!=t&&(n+=" "+e);n=n.substr(1),this._element.className=n},_updateClass:function(){var t=0,e=this.__c,i="";for(t in e)i+=" "+t;i=i.substr(1),this._element.className=i},_invalidateDOM:function(){this._changed||(this._changed=!0,e.DrawManager.addDom(this))},DOM:function(t){return t&&t.nodeType&&(this.undraw(),this._element=t,this._element.style.position="absolute"),this},draw:function(){var t=this._element.style,i=this.__coord||[0,0,0,0],n={x:i[0],y:i[1],w:i[2],h:i[3]},r=e.support.prefix,s=[];if(this._cssStyles.visibility!==this._visible&&(this._cssStyles.visibility=this._visible,t.visibility=this._visible?"visible":"hidden"),e.support.css3dtransform&&!this.avoidCss3dTransforms?s.push("translate3d("+~~this._x+"px,"+~~this._y+"px,0)"):(this._cssStyles.left!==this._x&&(this._cssStyles.left=this._x,t.left=~~this._x+"px"),this._cssStyles.top!==this._y&&(this._cssStyles.top=this._y,t.top=~~this._y+"px")),this._cssStyles.width!==this._w&&(this._cssStyles.width=this._w,t.width=~~this._w+"px"),this._cssStyles.height!==this._h&&(this._cssStyles.height=this._h,t.height=~~this._h+"px"),this._cssStyles.zIndex!==this._z&&(this._cssStyles.zIndex=this._z,t.zIndex=this._z),this._cssStyles.opacity!==this._alpha&&(this._cssStyles.opacity=this._alpha,t.opacity=this._alpha,t[r+"Opacity"]=this._alpha),this._mbr){var a=this._origin.x+"px "+this._origin.y+"px";t.transformOrigin=a,t[r+"TransformOrigin"]=a,s.push(e.support.css3dtransform?"rotateZ("+this._rotation+"deg)":"rotate("+this._rotation+"deg)")}return this._flipX&&s.push("scaleX(-1)"),this._flipY&&s.push("scaleY(-1)"),this._cssStyles.transform!=s.join(" ")&&(this._cssStyles.transform=s.join(" "),t.transform=this._cssStyles.transform,t[r+"Transform"]=this._cssStyles.transform),this.trigger("Draw",{style:t,type:"DOM",co:n}),this},undraw:function(){var t=this._element;return t&&null!==t.parentNode&&t.parentNode.removeChild(t),this},css:function(t,i){var n,r,s=this._element,a=s.style;if("object"==typeof t)for(n in t)t.hasOwnProperty(n)&&(r=t[n],"number"==typeof r&&(r+="px"),a[e.DOM.camelize(n)]=r);else{if(!i)return e.DOM.getStyle(s,t);"number"==typeof i&&(i+="px"),a[e.DOM.camelize(t)]=i}return this.trigger("Invalidate"),this}}),e.extend({DOM:{window:{init:function(){this.width=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,this.height=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,e.uniqueBind("RenderScene",e.DrawManager.renderDOM),e.uniqueBind("ViewportResize",this._resize),e.uniqueBind("PixelartSet",this._setPixelArt)},_resize:function(){e.stage.elem.style.width=e.viewport.width+"px",e.stage.elem.style.height=e.viewport.height+"px"},_setPixelArt:function(t){var i=e.stage.inner.style;t?(i[e.DOM.camelize("image-rendering")]="optimizeSpeed",i[e.DOM.camelize("image-rendering")]="-moz-crisp-edges",i[e.DOM.camelize("image-rendering")]="-o-crisp-edges",i[e.DOM.camelize("image-rendering")]="-webkit-optimize-contrast",i[e.DOM.camelize("-ms-interpolation-mode")]="nearest-neighbor",i[e.DOM.camelize("image-rendering")]="optimize-contrast",i[e.DOM.camelize("image-rendering")]="pixelated",i[e.DOM.camelize("image-rendering")]="crisp-edges"):(i[e.DOM.camelize("image-rendering")]="optimizeQuality",i[e.DOM.camelize("-ms-interpolation-mode")]="bicubic",i[e.DOM.camelize("image-rendering")]="auto")},width:0,height:0},inner:function(t){var e=t.getBoundingClientRect(),n=e.left+(window.pageXOffset?window.pageXOffset:i.body.scrollLeft),r=e.top+(window.pageYOffset?window.pageYOffset:i.body.scrollTop),s=parseInt(this.getStyle(t,"border-left-width")||0,10)||parseInt(this.getStyle(t,"borderLeftWidth")||0,10)||0,a=parseInt(this.getStyle(t,"border-top-width")||0,10)||parseInt(this.getStyle(t,"borderTopWidth")||0,10)||0;return n+=s,r+=a,{x:n,y:r}},getStyle:function(t,e){var n;return t.currentStyle?n=t.currentStyle[this.camelize(e)]:window.getComputedStyle&&(n=i.defaultView.getComputedStyle(t,null).getPropertyValue(this.csselize(e))),n},camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},csselize:function(t){return t.replace(/[A-Z]/g,function(t){return t?"-"+t.toLowerCase():""})},translate:function(t,n){var r=i.documentElement,s=i.body;return{x:(t-e.stage.x+(r&&r.scrollLeft||s&&s.scrollLeft||0))/e.viewport._scale-e.viewport._x,y:(n-e.stage.y+(r&&r.scrollTop||s&&s.scrollTop||0))/e.viewport._scale-e.viewport._y}}}})},{"./core.js":10}],3:[function(t){var e=t("./core.js"),i=window.document;e.c("DebugCanvas",{init:function(){this.requires("2D"),e.DebugCanvas.context||e.DebugCanvas.init(),e.DebugCanvas.add(this),this._debug={alpha:1,lineWidth:1},this.bind("RemoveComponent",this.onDebugRemove),this.bind("Remove",this.onDebugDestroy)},onDebugRemove:function(t){"DebugCanvas"===t&&e.DebugCanvas.remove(this)},onDebugDestroy:function(){e.DebugCanvas.remove(this)},debugAlpha:function(t){return this._debug.alpha=t,this},debugFill:function(t){return"undefined"==typeof t&&(t="red"),this._debug.fillStyle=t,this},debugStroke:function(t){return"undefined"==typeof t&&(t="red"),this._debug.strokeStyle=t,this},debugDraw:function(t){var e=t.globalAlpha,i=this._debug;i.alpha&&(t.globalAlpha=this._debug.alpha),i.strokeStyle&&(t.strokeStyle=i.strokeStyle),i.lineWidth&&(t.lineWidth=i.lineWidth),i.fillStyle&&(t.fillStyle=i.fillStyle),this.trigger("DebugDraw"),t.globalAlpha=e}}),e.c("DebugRectangle",{init:function(){this.requires("2D, DebugCanvas")},debugRectangle:function(t){return this.debugRect=t,this.unbind("DebugDraw",this.drawDebugRect),this.bind("DebugDraw",this.drawDebugRect),this},drawDebugRect:function(){ctx=e.DebugCanvas.context;var t=this.debugRect;null!==t&&void 0!==t&&t._h&&t._w&&(this._debug.fillStyle&&ctx.fillRect(t._x,t._y,t._w,t._h),this._debug.strokeStyle&&ctx.strokeRect(t._x,t._y,t._w,t._h))}}),e.c("VisibleMBR",{init:function(){this.requires("DebugRectangle").debugFill("purple").bind("EnterFrame",this._assignRect)},_assignRect:function(){this.debugRectangle(this._mbr?this._mbr:this)}}),e.c("DebugPolygon",{init:function(){this.requires("2D, DebugCanvas")},debugPolygon:function(t){return this.polygon=t,this.unbind("DebugDraw",this.drawDebugPolygon),this.bind("DebugDraw",this.drawDebugPolygon),this},drawDebugPolygon:function(){if("undefined"!=typeof this.polygon){ctx=e.DebugCanvas.context,ctx.beginPath();for(var t in this.polygon.points)ctx.lineTo(this.polygon.points[t][0],this.polygon.points[t][1]);ctx.closePath(),this._debug.fillStyle&&ctx.fill(),this._debug.strokeStyle&&ctx.stroke()}}}),e.c("WiredHitBox",{init:function(){this.requires("DebugPolygon").debugStroke("red").matchHitBox(),this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}}),e.c("SolidHitBox",{init:function(){this.requires("Collision, DebugPolygon").debugFill("orange").debugAlpha(.7).matchHitBox(),this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}}),e.DebugCanvas={context:null,entities:[],onetimeEntities:[],add:function(t){this.entities.push(t)},remove:function(t){for(var e=this.entities,i=e.length-1;i>=0;i--)e[i]==t&&e.splice(i,1)},init:function(){if(!e.DebugCanvas.context){if(!e.support.canvas)return e.trigger("NoCanvas"),void e.stop();var t;t=i.createElement("canvas"),t.width=e.viewport.width,t.height=e.viewport.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.id="debug-canvas",t.style.zIndex=1e5,e.stage.elem.appendChild(t),e.DebugCanvas.context=t.getContext("2d"),e.DebugCanvas._canvas=t}e.unbind("RenderScene",e.DebugCanvas.renderScene),e.bind("RenderScene",e.DebugCanvas.renderScene)},renderScene:function(t){t=t||e.viewport.rect();var i,n=e.DebugCanvas.entities,r=0,s=n.length,a=e.DebugCanvas.context,o=e.viewport;for(a.setTransform(o._scale,0,0,o._scale,Math.round(o._x*o._scale),Math.round(o._y*o._scale)),a.clearRect(t._x,t._y,t._w,t._h);s>r;r++)i=n[r],i.debugDraw(a)}}},{"./core.js":10}],4:[function(t,e){function i(t,e,i){this.keys=t,this.map=i,this.obj=e}var n,r=(t("./core.js"),window.document,function(t){n=t||64,this.map={}}),s=" ",a={};r.prototype={insert:function(t){var e,n,s=r.key(t),a=new i(s,t,this),o=0;for(o=s.x1;o<=s.x2;o++)for(e=s.y1;e<=s.y2;e++)n=o<<16^e,this.map[n]||(this.map[n]=[]),this.map[n].push(t);return a},search:function(t,e){var i,n,s,o=r.key(t,a),u=[];for(void 0===e&&(e=!0),i=o.x1;i<=o.x2;i++)for(n=o.y1;n<=o.y2;n++)if(cell=this.map[i<<16^n])for(s=0;s<cell.length;s++)u.push(cell[s]);if(e){var c,h,d=[],f={};for(i=0,l=u.length;l>i;i++)c=u[i],c&&(h=c[0],c=c._mbr||c,!f[h]&&c._x<t._x+t._w&&c._x+c._w>t._x&&c._y<t._y+t._h&&c._h+c._y>t._y&&(f[h]=u[i]));for(c in f)d.push(f[c]);return d}return u},remove:function(t,e){var i,n,s=0;for(1==arguments.length&&(e=t,t=r.key(e,a)),s=t.x1;s<=t.x2;s++)for(i=t.y1;i<=t.y2;i++)if(n=s<<16^i,this.map[n]){var o,u=this.map[n],c=u.length;for(o=0;c>o;o++)u[o]&&u[o][0]===e[0]&&u.splice(o,1)}},refresh:function(t){var e,i,n,s,a,o=t.keys,u=t.obj;for(i=o.x1;i<=o.x2;i++)for(n=o.y1;n<=o.y2;n++)if(e=this.map[i<<16^n])for(a=e.length,s=0;a>s;s++)e[s]&&e[s][0]===u[0]&&e.splice(s,1);for(r.key(u,o),i=o.x1;i<=o.x2;i++)for(n=o.y1;n<=o.y2;n++)e=this.map[i<<16^n],e||(e=this.map[i<<16^n]=[]),e.push(u);return t},boundaries:function(){var t,e,i={max:{x:-1/0,y:-1/0},min:{x:1/0,y:1/0}},n={max:{x:-1/0,y:-1/0},min:{x:1/0,y:1/0}};for(var r in this.map)if(this.map[r].length){var s=r>>16,a=r<<16>>16;if(0>a&&(s=-1^s),s>=i.max.x){i.max.x=s;for(t in this.map[r])e=this.map[r][t],"object"==typeof e&&"requires"in e&&(n.max.x=Math.max(n.max.x,e.x+e.w))}if(s<=i.min.x){i.min.x=s;for(t in this.map[r])e=this.map[r][t],"object"==typeof e&&"requires"in e&&(n.min.x=Math.min(n.min.x,e.x))}if(a>=i.max.y){i.max.y=a;for(t in this.map[r])e=this.map[r][t],"object"==typeof e&&"requires"in e&&(n.max.y=Math.max(n.max.y,e.y+e.h))}if(a<=i.min.y){i.min.y=a;for(t in this.map[r])e=this.map[r][t],"object"==typeof e&&"requires"in e&&(n.min.y=Math.min(n.min.y,e.y))}}return n}},r.key=function(t,e){return t._mbr&&(t=t._mbr),e||(e={}),e.x1=Math.floor(t._x/n),e.y1=Math.floor(t._y/n),e.x2=Math.floor((t._w+t._x)/n),e.y2=Math.floor((t._h+t._y)/n),e},r.hash=function(t){return t.x1+s+t.y1+s+t.x2+s+t.y2},i.prototype={update:function(t){r.hash(r.key(t,a))!=r.hash(this.keys)&&this.map.refresh(this)}},e.exports=r},{"./core.js":10}],5:[function(t){{var e=t("./core.js");window.document}e.easing=function(t){this.timePerFrame=1e3/e.timer.FPS(),this.duration=t,this.reset()},e.easing.prototype={duration:0,clock:0,steps:null,complete:!1,paused:!1,reset:function(){this.loops=1,this.clock=0,this.complete=!1,this.paused=!1},repeat:function(t){this.loops=t},setProgress:function(t,e){this.clock=this.duration*t,"undefined"!=typeof e&&(this.loops=e)},pause:function(){this.paused=!0},resume:function(){this.paused=!1,this.complete=!1},tick:function(t){if(!this.paused&&!this.complete)for(this.clock+=t,this.frames=Math.floor(this.clock/this.timePerFrame);this.clock>=this.duration&&this.complete===!1;)this.loops--,this.loops>0?this.clock-=this.duration:this.complete=!0},time:function(){return Math.min(this.clock/this.duration,1)},value:function(){return this.time()}},e.c("Tween",{init:function(){this.tweenGroup={},this.tweenStart={},this.tweens=[],this.bind("EnterFrame",this._tweenTick)},_tweenTick:function(t){var e,i,n;for(n=this.tweens.length-1;n>=0;n--)e=this.tweens[n],e.easing.tick(t.dt),i=e.easing.value(),this._doTween(e.props,i),e.easing.complete&&(this.tweens.splice(n,1),this._endTween(e.props))},_doTween:function(t,e){for(var i in t)this[i]=(1-e)*this.tweenStart[i]+e*t[i]},tween:function(t,i){var n={props:t,easing:new e.easing(i)};for(var r in t)"undefined"!=typeof this.tweenGroup[r]&&this.cancelTween(r),this.tweenStart[r]=this[r],this.tweenGroup[r]=t;return this.tweens.push(n),this},cancelTween:function(t){if("string"==typeof t)"object"==typeof this.tweenGroup[t]&&delete this.tweenGroup[t][t];else if("object"==typeof t)for(var e in t)this.cancelTween(e);return this},_endTween:function(t){for(var e in t)delete this.tweenGroup[e];this.trigger("TweenEnd",t)}})},{"./core.js":10}],6:[function(t){var e=t("./core.js"),i=window.document;e.c("Canvas",{init:function(){e.canvas.context||e.canvas.init(),e.DrawManager.total2D++,this.currentRect={},this._changed=!0,e.DrawManager.addCanvas(this),this.bind("Invalidate",function(){this._changed===!1&&(this._changed=!0,e.DrawManager.addCanvas(this))}),this.bind("Remove",function(){e.DrawManager.total2D--,this._changed=!0,e.DrawManager.addCanvas(this)})},drawVars:{type:"canvas",pos:{},ctx:null,coord:[0,0,0,0],co:{x:0,y:0,w:0,h:0}},draw:function(t,i,n,r,s){if(this.ready){4===arguments.length&&(s=r,r=n,n=i,i=t,t=e.canvas.context);var a=this.drawVars.pos;a._x=this._x+(i||0),a._y=this._y+(n||0),a._w=r||this._w,a._h=s||this._h,context=t||e.canvas.context,coord=this.__coord||[0,0,0,0];var o=this.drawVars.co;o.x=coord[0]+(i||0),o.y=coord[1]+(n||0),o.w=r||coord[2],o.h=s||coord[3],0!==this._rotation&&(context.save(),context.translate(this._origin.x+this._x,this._origin.y+this._y),a._x=-this._origin.x,a._y=-this._origin.y,context.rotate(this._rotation%360*(Math.PI/180))),(this._flipX||this._flipY)&&(context.save(),context.scale(this._flipX?-1:1,this._flipY?-1:1),this._flipX&&(a._x=-(a._x+a._w)),this._flipY&&(a._y=-(a._y+a._h)));var u;return this._alpha<1&&(u=context.globalAlpha,context.globalAlpha=this._alpha),this.drawVars.ctx=context,this.trigger("Draw",this.drawVars),(0!==this._rotation||this._flipX||this._flipY)&&context.restore(),u&&(context.globalAlpha=u),this}}}),e.extend({canvas:{context:null,init:function(){if(!e.support.canvas)return e.trigger("NoCanvas"),void e.stop();var t;t=i.createElement("canvas"),t.width=e.viewport.width,t.height=e.viewport.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",e.stage.elem.appendChild(t),e.canvas.context=t.getContext("2d"),e.canvas._canvas=t;var n=e.viewport._scale;1!=n&&e.canvas.context.scale(n,n),this._setPixelart(e._pixelartEnabled),e.uniqueBind("PixelartSet",this._setPixelart),e.uniqueBind("RenderScene",e.DrawManager.renderCanvas),e.uniqueBind("ViewportResize",this._resize)},_resize:function(){var t=e.canvas._canvas;t.width=e.viewport.width,t.height=e.viewport.height},_setPixelart:function(t){var i=e.canvas.context;i.imageSmoothingEnabled=!t,i.mozImageSmoothingEnabled=!t,i.webkitImageSmoothingEnabled=!t,i.oImageSmoothingEnabled=!t,i.msImageSmoothingEnabled=!t}}})},{"./core.js":10}],7:[function(t){var e=t("./core.js"),i=(window.document,Math.PI/180);e.c("Collision",{init:function(){this.requires("2D"),this._collisionData={},this.collision()},remove:function(){this._cbr=null,this.unbind("Resize",this._resizeMap),this.unbind("Resize",this._checkBounds)},collision:function(t){if(this.unbind("Resize",this._resizeMap),this.unbind("Resize",this._checkBounds),t){if(arguments.length>1){var n=Array.prototype.slice.call(arguments,0);t=new e.polygon(n)}this._findBounds(t.points)}else t=new e.polygon([0,0],[this._w,0],[this._w,this._h],[0,this._h]),this.bind("Resize",this._resizeMap),this._cbr=null;return this.rotation&&t.rotate({cos:Math.cos(-this.rotation*i),sin:Math.sin(-this.rotation*i),o:{x:this._origin.x,y:this._origin.y}}),this.map=t,this.attach(this.map),this.map.shift(this._x,this._y),this.trigger("NewHitbox",t),this},_findBounds:function(t){for(var e,i=1/0,n=-1/0,r=1/0,s=-1/0,a=0;a<t.length;++a)e=t[a],e[0]<i&&(i=e[0]),e[0]>n&&(n=e[0]),e[1]<r&&(r=e[1]),e[1]>s&&(s=e[1]);var o={cx:(i+n)/2,cy:(r+s)/2,r:Math.sqrt((n-i)*(n-i)+(s-r)*(s-r))/2};return i>=0&&r>=0&&(this._checkBounds=function(){null===this._cbr&&this._w<n||this._h<s?(this._cbr=o,this._calculateMBR()):this._cbr&&(this._cbr=null,this._calculateMBR())},this.bind("Resize",this._checkBounds)),i>=0&&r>=0&&n<=this._w&&s<=this._h?(this._cbr=null,!1):(this._cbr=o,this._calculateMBR(),!0)},_resizeMap:function(t){var e,n,r=this.rotation*i,s=this.map.points;"w"===t.axis?(r?(e=t.amount*Math.cos(r),n=t.amount*Math.sin(r)):(e=t.amount,n=0),s[1][0]+=e,s[1][1]+=n):(r?(n=t.amount*Math.cos(r),e=-t.amount*Math.sin(r)):(e=0,n=t.amount),s[3][0]+=e,s[3][1]+=n),s[2][0]+=e,s[2][1]+=n},hit:function(t){var i,n,r,s,a=this._cbr||this._mbr||this,o=e.map.search(a,!1),u=0,c=o.length,h={},l="map"in this&&"containsPoint"in this.map,d=[];if(!c)return!1;for(;c>u;++u)n=o[u],r=n._cbr||n._mbr||n,n&&(i=n[0],!h[i]&&this[0]!==i&&n.__c[t]&&r._x<a._x+a._w&&r._x+r._w>a._x&&r._y<a._y+a._h&&r._h+r._y>a._y&&(h[i]=n));for(s in h)if(n=h[s],l&&"map"in n){var f=this._SAT(this.map,n.map);f.obj=n,f.type="SAT",f&&d.push(f)}else d.push({obj:n,type:"MBR"});return d.length?d:!1},onHit:function(t,e,i){var n=!1;return this.bind("EnterFrame",function(){var r=this.hit(t);r?(n=!0,e.call(this,r)):n&&("function"==typeof i&&i.call(this),n=!1)}),this},_createCollisionHandler:function(t,e){return function(){var i=this.hit(t);if(e.occurring===!0){if(i!==!1)return;e.occurring=!1,this.trigger("HitOff",t)}else i!==!1&&(e.occurring=!0,this.trigger("HitOn",i))}},checkHits:function(){var t=arguments,e=0;for(1===t.length&&(t=t[0].split(/\s*,\s*/));e<t.length;++e){var i=t[e],n=this._collisionData[i];void 0===n&&(this._collisionData[i]=n={occurring:!1,handler:null},n.handler=this._createCollisionHandler(i,n),this.bind("EnterFrame",n.handler))}return this},ignoreHits:function(){var t,e=arguments,i=0;if(0===e.length){for(t in this._collisionData)this.unbind("EnterFrame",t.handler);this._collisionData={}}for(1===e.length&&(e=e[0].split(/\s*,\s*/));i<e.length;++i){var n=e[i];t=this._collisionData[n],void 0!==t&&(this.unbind("EnterFrame",t.handler),delete this._collisionData[n])}return this},resetHitChecks:function(){var t,e=arguments,i=0;if(0===e.length)for(t in this._collisionData)this._collisionData[t].occurring=!1;for(1===e.length&&(e=e[0].split(/\s*,\s*/));i<e.length;++i){var n=e[i];t=this._collisionData[n],void 0!==t&&(t.occurring=!1)}return this},_SAT:function(t,e){for(var i,n,r,s,a,o,u,c,h,l,d=t.points,f=e.points,p=0,_=d.length,g=f.length,m={x:0,y:0},v=null,y=null,b=null;_>p;p++){for(h=d[p==_-1?0:p+1],l=d[p],m.x=-(h[1]-l[1]),m.y=h[0]-l[0],n=Math.sqrt(m.x*m.x+m.y*m.y),m.x/=n,m.y/=n,r=s=1/0,a=o=-1/0,i=0;_>i;++i)c=d[i][0]*m.x+d[i][1]*m.y,c>a&&(a=c),r>c&&(r=c);for(i=0;g>i;++i)c=f[i][0]*m.x+f[i][1]*m.y,c>o&&(o=c),s>c&&(s=c);if(s>r?(u=s-a,m.x=-m.x,m.y=-m.y):u=r-o,u>=0)return!1;(null===v||u>v)&&(v=u,b={x:m.x,y:m.y})}for(p=0;g>p;p++){for(h=f[p==g-1?0:p+1],l=f[p],m.x=-(h[1]-l[1]),m.y=h[0]-l[0],n=Math.sqrt(m.x*m.x+m.y*m.y),m.x/=n,m.y/=n,r=s=1/0,a=o=-1/0,i=0;_>i;++i)c=d[i][0]*m.x+d[i][1]*m.y,c>a&&(a=c),r>c&&(r=c);for(i=0;g>i;++i)c=f[i][0]*m.x+f[i][1]*m.y,c>o&&(o=c),s>c&&(s=c);if(s>r?(u=s-a,m.x=-m.x,m.y=-m.y):u=r-o,u>=0)return!1;(null===v||u>v)&&(v=u),(u>y||null===y)&&(y=u,b={x:m.x,y:m.y})}return{overlap:y,normal:b}}})},{"./core.js":10}],8:[function(t){var e=t("./core.js"),i=window.document;e.extend({assignColor:function(){function t(t){return t._red=t._blue=t._green=0,t}function e(t){var e=t.toString(16);return 1==e.length&&(e="0"+e),e}function n(t,i,n){return"#"+e(t)+e(i)+e(n)}function r(e,i){var n;if(7===e.length)n=2;else{if(4!==e.length)return t(i);n=1}return i._red=parseInt(e.substr(1,n),16),i._green=parseInt(e.substr(1+n,n),16),i._blue=parseInt(e.substr(1+2*n,n),16),i}function s(e,i){var n=l.exec(e);return null===n||4!=n.length&&5!=n.length?t(i):(i._red=Math.round(parseFloat(n[1])),i._green=Math.round(parseFloat(n[2])),i._blue=Math.round(parseFloat(n[3])),n[4]&&(i._strength=parseFloat(n[4])),i)}function a(t,e){if("undefined"==typeof h[t]){c===!1&&(window.document.body.appendChild(u),c=!0),u.style.color=t;var i=window.getComputedStyle(u).color;s(i,e),h[t]=n(e._red,e._green,e._blue)}else r(h[t],e);return e}function o(t){return"rgba("+t._red+", "+t._green+", "+t._blue+", "+t._strength+")"}var u=i.createElement("div");u.style.display="none";var c=!1,h={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#00ff00",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},l=/rgba?\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,?\s*([0-9.]+)?\)/;return function(t,e){e=e||{},t=t.trim().toLowerCase();var i=null;i="#"===t[0]?r(t,e):"r"===t[0]&&"g"===t[1]&&"b"===t[2]?s(t,e):a(t,e),e._strength=e._strength||1,e._color=o(e)}}()}),e.c("Color",{_red:0,_green:0,_blue:0,_strength:1,_color:"",ready:!0,init:function(){this.bind("Draw",this._drawColor),this.trigger("Invalidate")},remove:function(){this.unbind("Draw",this._drawColor),this.has("DOM")&&(this._element.style.backgroundColor="transparent"),this.trigger("Invalidate")},_drawColor:function(t){this._color&&("DOM"===t.type?(t.style.backgroundColor=this._color,t.style.lineHeight=0):"canvas"===t.type&&(t.ctx.fillStyle=this._color,t.ctx.fillRect(t.pos._x,t.pos._y,t.pos._w,t.pos._h)))},color:function(t){return 0===arguments.length?this._color:(arguments.length>=3?(this._red=arguments[0],this._green=arguments[1],this._blue=arguments[2],"number"==typeof arguments[3]&&(this._strength=arguments[3])):(e.assignColor(t,this),"number"==typeof arguments[1]&&(this._strength=arguments[1])),this._color="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")",this.trigger("Invalidate"),this)}})},{"./core.js":10}],9:[function(t){var e=t("./core.js"),i=window.document;e.extend({over:null,mouseObjs:0,mousePos:{},lastEvent:null,keydown:{},selected:!1,detectBlur:function(t){var i=t.clientX>e.stage.x&&t.clientX<e.stage.x+e.viewport.width&&t.clientY>e.stage.y&&t.clientY<e.stage.y+e.viewport.height;!e.selected&&i&&e.trigger("CraftyFocus"),e.selected&&!i&&e.trigger("CraftyBlur"),e.selected=i},resetKeyDown:function(){for(var t in e.keys)e.keydown[e.keys[t]]&&this.trigger("KeyUp",{key:e.keys[t]});e.keydown={}},mouseDispatch:function(t){if(e.mouseObjs){e.lastEvent=t;var i,n,r,s,a,o=-1,u=0,c=e.DOM.translate(t.clientX,t.clientY),h={},l=t.target?t.target:t.srcElement,d=t.type;if(t.mouseButton="undefined"==typeof t.which?t.button<2?e.mouseButtons.LEFT:4==t.button?e.mouseButtons.MIDDLE:e.mouseButtons.RIGHT:t.which<2?e.mouseButtons.LEFT:2==t.which?e.mouseButtons.MIDDLE:e.mouseButtons.RIGHT,t.realX=s=e.mousePos.x=c.x/globalScale,t.realY=a=e.mousePos.y=c.y/globalScale,"CANVAS"!=l.nodeName){for(;"string"!=typeof l.id&&-1==l.id.indexOf("ent");)l=l.parentNode;ent=e(parseInt(l.id.replace("ent",""),10)),ent.has("Mouse")&&ent.isAt(s,a)&&(i=ent)}if(!i)for(n=e.map.search({_x:s,_y:a,_w:1,_h:1},!1),r=n.length;r>u;++u)if(n[u].__c.Mouse&&n[u]._visible){var f=n[u],p=!1;if(!h[f[0]]&&(h[f[0]]=!0,f.mapArea?f.mapArea.containsPoint(s,a)&&(p=!0):f.isAt(s,a)&&(p=!0),p&&(f._z>=o||-1===o))){if(f._z===o&&f[0]<i[0])continue;o=f._z,i=f}}i?"mousedown"===d?i.trigger("MouseDown",t):"mouseup"===d?i.trigger("MouseUp",t):"dblclick"==d?i.trigger("DoubleClick",t):"click"==d?i.trigger("Click",t):"mousemove"===d?(i.trigger("MouseMove",t),this.over!==i&&(this.over&&(this.over.trigger("MouseOut",t),this.over=null),this.over=i,i.trigger("MouseOver",t))):i.trigger(d,t):("mousemove"===d&&this.over&&(this.over.trigger("MouseOut",t),this.over=null),"mousedown"===d?e.viewport.mouselook("start",t):"mousemove"===d?e.viewport.mouselook("drag",t):"mouseup"==d&&e.viewport.mouselook("stop")),"mousemove"===d&&(this.lastEvent=t)}},touchDispatch:function(t){console.log(t);var n,r=e.lastEvent;"touchstart"===t.type?n="click":"touchmove"===t.type?n="mousemove":"touchend"===t.type?n="mouseup":"touchcancel"===t.type?n="mouseup":"touchleave"===t.type&&(n="mouseup"),t.touches&&t.touches.length?first=t.touches[0]:t.changedTouches&&t.changedTouches.length&&(first=t.changedTouches[0]);var s=i.createEvent("MouseEvent");s.initMouseEvent(n,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,t.relatedTarget),first.target.dispatchEvent(s),null!==r&&"mousedown"==r.type&&"mouseup"==n&&(n="click",s=i.createEvent("MouseEvent"),s.initMouseEvent(n,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,t.relatedTarget),first.target.dispatchEvent(s)),t.target&&"INPUT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName&&t.preventDefault()},keyboardDispatch:function(t){for(var i=t,n={},r="char charCode keyCode type shiftKey ctrlKey metaKey timestamp".split(" "),s=r.length;s;){var a=r[--s];n[a]=i[a]}return n.which=null!==i.charCode?i.charCode:i.keyCode,n.key=i.keyCode||i.which,n.originalEvent=i,t=n,"keydown"===t.type?e.keydown[t.key]!==!0&&(e.keydown[t.key]=!0,e.trigger("KeyDown",t)):"keyup"===t.type&&(delete e.keydown[t.key],e.trigger("KeyUp",t)),e.selected&&!(8==t.key||t.key>=112&&t.key<=135)?(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.target&&"INPUT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName&&t.preventDefault(),!1):void 0}}),e.bind("Load",function(){e.addEvent(this,"keydown",e.keyboardDispatch),e.addEvent(this,"keyup",e.keyboardDispatch),e.addEvent(this,e.stage.elem,"mousedown",e.mouseDispatch),e.addEvent(this,e.stage.elem,"mouseup",e.mouseDispatch),e.addEvent(this,i.body,"mouseup",e.detectBlur),e.addEvent(this,window,"blur",e.resetKeyDown),e.addEvent(this,e.stage.elem,"mousemove",e.mouseDispatch),e.addEvent(this,e.stage.elem,"click",e.mouseDispatch),e.addEvent(this,e.stage.elem,"dblclick",e.mouseDispatch),e.addEvent(this,e.stage.elem,"touchstart",e.touchDispatch),e.addEvent(this,e.stage.elem,"touchmove",e.touchDispatch),e.addEvent(this,e.stage.elem,"touchend",e.touchDispatch),e.addEvent(this,e.stage.elem,"touchcancel",e.touchDispatch),e.addEvent(this,e.stage.elem,"touchleave",e.touchDispatch)}),e.bind("CraftyStop",function(){e.removeEvent(this,"keydown",e.keyboardDispatch),e.removeEvent(this,"keyup",e.keyboardDispatch),e.stage&&(e.removeEvent(this,e.stage.elem,"mousedown",e.mouseDispatch),e.removeEvent(this,e.stage.elem,"mouseup",e.mouseDispatch),e.removeEvent(this,e.stage.elem,"mousemove",e.mouseDispatch),e.removeEvent(this,e.stage.elem,"click",e.mouseDispatch),e.removeEvent(this,e.stage.elem,"dblclick",e.mouseDispatch),e.removeEvent(this,e.stage.elem,"touchstart",e.touchDispatch),e.removeEvent(this,e.stage.elem,"touchmove",e.touchDispatch),e.removeEvent(this,e.stage.elem,"touchend",e.touchDispatch),e.removeEvent(this,e.stage.elem,"touchcancel",e.touchDispatch),e.removeEvent(this,e.stage.elem,"touchleave",e.touchDispatch)),e.removeEvent(this,i.body,"mouseup",e.detectBlur),e.removeEvent(this,window,"blur",e.resetKeyDown)
}),e.c("Mouse",{init:function(){e.mouseObjs++,this.bind("Remove",function(){e.mouseObjs--})},areaMap:function(t){if(arguments.length>1){var i=Array.prototype.slice.call(arguments,0);t=new e.polygon(i)}return t.shift(this._x,this._y),this.mapArea=t,this.attach(this.mapArea),this}}),e.c("Draggable",{_origMouseDOMPos:null,_oldX:null,_oldY:null,_dragging:!1,_dir:null,init:function(){this.requires("Mouse"),this.enableDrag()},_ondrag:function(t){var i=e.DOM.translate(t.clientX,t.clientY);if(0===i.x||0===i.y)return!1;if(this._dir){var n=(i.x-this._origMouseDOMPos.x)*this._dir.x+(i.y-this._origMouseDOMPos.y)*this._dir.y;this.x=this._oldX+n*this._dir.x,this.y=this._oldY+n*this._dir.y}else this.x=this._oldX+(i.x-this._origMouseDOMPos.x),this.y=this._oldY+(i.y-this._origMouseDOMPos.y);this.trigger("Dragging",t)},_ondown:function(t){t.mouseButton===e.mouseButtons.LEFT&&this._startDrag(t)},_onup:function(t){t.mouseButton===e.mouseButtons.LEFT&&this._dragging===!0&&(e.removeEvent(this,e.stage.elem,"mousemove",this._ondrag),e.removeEvent(this,e.stage.elem,"mouseup",this._onup),this._dragging=!1,this.trigger("StopDrag",t))},dragDirection:function(t){if("undefined"==typeof t)this._dir=null;else if(""+parseInt(t,10)==t)this._dir={x:Math.cos(t/180*Math.PI),y:Math.sin(t/180*Math.PI)};else{var e=Math.sqrt(t.x*t.x+t.y*t.y);this._dir={x:t.x/e,y:t.y/e}}},_startDrag:function(t){this._origMouseDOMPos=e.DOM.translate(t.clientX,t.clientY),this._oldX=this._x,this._oldY=this._y,this._dragging=!0,e.addEvent(this,e.stage.elem,"mousemove",this._ondrag),e.addEvent(this,e.stage.elem,"mouseup",this._onup),this.trigger("StartDrag",t)},stopDrag:function(){return e.removeEvent(this,e.stage.elem,"mousemove",this._ondrag),e.removeEvent(this,e.stage.elem,"mouseup",this._onup),this._dragging=!1,this.trigger("StopDrag"),this},startDrag:function(){return this._dragging||this._startDrag(e.lastEvent),this},enableDrag:function(){return this.bind("MouseDown",this._ondown),e.addEvent(this,e.stage.elem,"mouseup",this._onup),this},disableDrag:function(){return this.unbind("MouseDown",this._ondown),this._dragging&&this.stopDrag(),this}}),e.c("Keyboard",{isDown:function(t){return"string"==typeof t&&(t=e.keys[t]),!!e.keydown[t]}}),e.c("Multiway",{_speed:3,_keydown:function(t){this._keys[t.key]&&(this._movement.x=Math.round(1e3*(this._movement.x+this._keys[t.key].x))/1e3,this._movement.y=Math.round(1e3*(this._movement.y+this._keys[t.key].y))/1e3,this.trigger("NewDirection",this._movement))},_keyup:function(t){this._keys[t.key]&&(this._movement.x=Math.round(1e3*(this._movement.x-this._keys[t.key].x))/1e3,this._movement.y=Math.round(1e3*(this._movement.y-this._keys[t.key].y))/1e3,this.trigger("NewDirection",this._movement))},_enterframe:function(){this.disableControls||(0!==this._movement.x&&(this.x+=this._movement.x,this.trigger("Moved",{x:this.x-this._movement.x,y:this.y})),0!==this._movement.y&&(this.y+=this._movement.y,this.trigger("Moved",{x:this.x,y:this.y-this._movement.y})))},_initializeControl:function(){return this.unbind("KeyDown",this._keydown).unbind("KeyUp",this._keyup).unbind("EnterFrame",this._enterframe).bind("KeyDown",this._keydown).bind("KeyUp",this._keyup).bind("EnterFrame",this._enterframe)},multiway:function(t,i){this._keyDirection={},this._keys={},this._movement={x:0,y:0},this._speed={x:3,y:3},i?void 0!==t.x&&void 0!==t.y?(this._speed.x=t.x,this._speed.y=t.y):(this._speed.x=t,this._speed.y=t):i=t,this._keyDirection=i,this.speed(this._speed),this._initializeControl();for(var n in i)e.keydown[e.keys[n]]&&this.trigger("KeyDown",{key:e.keys[n]});return this},enableControl:function(){return this.disableControls=!1,this},disableControl:function(){return this.disableControls=!0,this},speed:function(t){for(var i in this._keyDirection){var n=e.keys[i]||i;this._keys[n]={x:Math.round(1e3*Math.cos(this._keyDirection[i]*(Math.PI/180))*t.x)/1e3,y:Math.round(1e3*Math.sin(this._keyDirection[i]*(Math.PI/180))*t.y)/1e3}}return this}}),e.c("Fourway",{init:function(){this.requires("Multiway")},fourway:function(t){return this.multiway(t,{UP_ARROW:-90,DOWN_ARROW:90,RIGHT_ARROW:0,LEFT_ARROW:180,W:-90,S:90,D:0,A:180,Z:-90,Q:180}),this}}),e.c("Twoway",{_speed:3,_up:!1,init:function(){this.requires("Fourway, Keyboard, Gravity")},twoway:function(t,i){return this.multiway(t,{RIGHT_ARROW:0,LEFT_ARROW:180,D:0,A:180,Q:180}),t&&(this._speed=t),this._jumpSpeed=arguments.length<2?2*this._speed:i,this.bind("EnterFrame",function(){this.disableControls||this._up&&(this.y-=this._jumpSpeed,this._falling=!0,this.trigger("Moved",{x:this._x,y:this._y+this._jumpSpeed}))}).bind("KeyDown",function(t){this._falling||t.key!==e.keys.UP_ARROW&&t.key!==e.keys.W&&t.key!==e.keys.Z||(this._up=!0)}),this}})},{"./core.js":10}],10:[function(t,e){function i(){var t=r++;return t in o?i():t}function n(t){if(null===t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)e[i]=n(t[i]);return e}var r,s,a,o,u,c,h,l,d,f=t("./version"),p=function(t){return new p.fn.init(t)};a={},h=Array.prototype.slice,l=/\s*,\s*/,d=/\s+/;var _=function(){r=1,s=0,o={},u={},c=[]};_(),p.fn=p.prototype={init:function(t){if("string"!=typeof t)return t||(t=0,t in o||(o[t]=this)),t in o?(this[0]=t,this.length=1,this.__c||(this.__c={}),o[t]||(o[t]=this),o[t]):(this.length=0,this);var e,i,n,r,s,u,c,h=0,f=!1,p=!1;if("*"===t){u=0;for(e in o)this[u]=+e,u++;return this.length=u,1===u?o[this[0]]:this}-1!==t.indexOf(",")?(p=!0,n=l):-1!==t.indexOf(" ")&&(f=!0,n=d);for(e in o)if(o.hasOwnProperty(e))if(i=o[e],f||p){for(r=t.split(n),u=0,c=r.length,s=0;c>u;u++)i.__c[r[u]]&&s++;(f&&s===c||p&&s>0)&&(this[h++]=+e)}else i.__c[t]&&(this[h++]=+e);if(h>0&&!f&&!p&&this.extend(a[t]),r&&f)for(u=0;c>u;u++)this.extend(a[r[u]]);return this.length=h,1===h?o[this[h-1]]:this},setName:function(t){var e=String(t);return this._entityName=e,this.trigger("NewEntityName",e),this},addComponent:function(t){var e=[],i=0;if(arguments.length>1)for(var n=0;n<arguments.length;n++)e.push(arguments[n]);else-1!==t.indexOf(",")?e=t.split(l):e.push(t);for(;i<e.length;i++)this.__c[e[i]]!==!0&&(this.__c[e[i]]=!0,this.extend(a[e[i]]),a[e[i]]&&"init"in a[e[i]]&&a[e[i]].init.call(this));return this.trigger("NewComponent",e),this},toggleComponent:function(t){var e,i,n=0;if(arguments.length>1)for(e=arguments.length;e>n;n++)this.has(arguments[n])?this.removeComponent(arguments[n]):this.addComponent(arguments[n]);else if(-1!==t.indexOf(","))for(i=t.split(l),e=i.length;e>n;n++)this.has(i[n])?this.removeComponent(i[n]):this.addComponent(i[n]);else this.has(t)?this.removeComponent(t):this.addComponent(t);return this},requires:function(t){return this.addComponent(t)},removeComponent:function(t,e){var i=a[t];if(this.trigger("RemoveComponent",t),i&&"remove"in i&&i.remove.call(this,!1),e===!1&&i)for(var n in i)delete this[n];return delete this.__c[t],this},getId:function(){return this[0]},has:function(t){return!!this.__c[t]},attr:function(t,e,i,n){return 1===arguments.length&&"string"==typeof arguments[0]?this._attr_get(t):this._attr_set(t,e,i,n)},_attr_get:function(t,e){var i,n,r;return("undefined"==typeof e||null===e)&&(e=this),t.indexOf(".")>-1?(n=t.split("."),i=n.shift(),r=n.join("."),this._attr_get(n.join("."),e[i])):e[t]},_attr_set:function(){var t,e,i;return"string"==typeof arguments[0]?(t=this._set_create_object(arguments[0],arguments[1]),e=!!arguments[2],i=arguments[3]||arguments[0].indexOf(".")>-1):(t=arguments[0],e=!!arguments[1],i=!!arguments[2]),e||this.trigger("Change",t),i?this._recursive_extend(t,this):this.extend.call(this,t),this},_set_create_object:function(t,e){var i,n,r,s={};return t.indexOf(".")>-1?(i=t.split("."),n=i.shift(),r=i.join("."),s[n]=this._set_create_object(r,e)):s[t]=e,s},_recursive_extend:function(t,e){var i;for(i in t)e[i]="Object"===t[i].constructor.name?this._recursive_extend(t[i],e[i]):t[i];return e},toArray:function(){return h.call(this,0)},timeout:function(t,e){return this.each(function(){var i=this;setTimeout(function(){t.call(i)},e)}),this},bind:function(t,e){var i,n=u[t]||(u[t]={});return 1===this.length?(i=n[this[0]],i||(i=n[this[0]]=[],i.depth=0),i.push(e),this):(this.each(function(){i=n[this[0]],i||(i=n[this[0]]=[],i.depth=0),i.push(e)}),this)},uniqueBind:function(t,e){this.unbind(t,e),this.bind(t,e)},one:function(t,e){var i=this,n=function(r){e.call(i,r),i.unbind(t,n)};return i.bind(t,n)},unbind:function(t,e){return this.each(function(){var i,n,r=u[t]||(u[t]={}),s=0;if(!r||!r[this[0]])return this;if(i=r[this[0]].length,!e)return delete r[this[0]],this;for(;i>s;s++)n=r[this[0]],n[s]==e&&delete n[s]}),this},trigger:function(t,e){var i=u[t]||(u[t]={});if(1===this.length){if(i&&i[this[0]]){var n,r=i[this[0]],s=r.length;for(r.depth++,n=0;s>n;n++)"undefined"==typeof r[n]&&r.depth<=1?(r.splice(n,1),n--,s--):r[n].call(this,e);r.depth--}return this}return this.each(function(){if(u[t]&&u[t][this[0]]){var i,n=u[t][this[0]],r=n.length;for(n.depth++,i=0;r>i;i++)"undefined"==typeof n[i]&&n.depth<=1?(n.splice(i,1),i--,r--):n[i].call(this,e);n.depth--}}),this},each:function(t){for(var e=0,i=this.length;i>e;e++)o[this[e]]&&t.call(o[this[e]],e);return this},get:function(t){var e=this.length;if("undefined"!=typeof t)return t>=e||0>t+e?void 0:t>=0?o[this[t]]:o[this[t+e]];for(var i=0,n=[];e>i;i++)o[this[i]]&&n.push(o[this[i]]);return n},clone:function(){var t,e,i=this.__c,n=p.e();for(t in i)n.addComponent(t);for(e in this)"0"!=e&&"_global"!=e&&"_changed"!=e&&"function"!=typeof this[e]&&"object"!=typeof this[e]&&(n[e]=this[e]);return n},setter:function(t,e){return p.support.setter?this.__defineSetter__(t,e):p.support.defineProperty&&Object.defineProperty(this,t,{set:e,configurable:!0}),this},destroy:function(){this.each(function(){var t;this.trigger("Remove");for(var e in this.__c)t=a[e],t&&"remove"in t&&t.remove.call(this,!0);for(var i in u)this.unbind(i);delete o[this[0]]})}},p.fn.init.prototype=p.fn,p.extend=p.fn.extend=function(t){var e,i=this;if(!t)return i;for(e in t)i!==t[e]&&(i[e]=t[e]);return i},p.extend({init:function(t,e,i){return p.viewport.init(t,e,i),this.trigger("Load"),this.timer.init(),this},getVersion:function(){return f},stop:function(t){if(this.timer.stop(),t){if(p.audio.remove(),p.stage&&p.stage.elem.parentNode){var e=document.createElement("div");e.id=p.stage.elem.id,p.stage.elem.parentNode.replaceChild(e,p.stage.elem)}_()}return p.trigger("CraftyStop"),this},pause:function(t){return(1===arguments.length?t:!this._paused)?(this.trigger("Pause"),this._paused=!0,setTimeout(function(){p.timer.stop()},0),p.keydown={}):(this.trigger("Unpause"),this._paused=!1,setTimeout(function(){p.timer.init()},0)),this},isPaused:function(){return this._paused},timer:function(){var t,e,i,n="fixed",r=5,a=40,o=0,u=0,c=50,h=1e3/c;return{init:function(){"undefined"==typeof i&&(i=(new Date).getTime()-h);var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null;n?(t=function(){p.timer.step(),e=n(t)})():t=setInterval(function(){p.timer.step()},1e3/c)},stop:function(){p.trigger("CraftyStopTimer"),"number"==typeof t&&clearInterval(t);var i=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||null;i&&i(e),t=null},steptype:function(t,e){if("variable"===t||"semifixed"===t)n=t,e&&(a=e);else{if("fixed"!==t)throw"Invalid step type specified";n="fixed",e&&(r=e)}},step:function(){var t,e,c,l=0;if(currentTime=(new Date).getTime(),o>0&&p.trigger("MeasureWaitTime",currentTime-o),i+u>=currentTime)return void(o=currentTime);var d=currentTime-(i+u);d>20*h&&(u+=d-h,d=h),"fixed"===n?(l=Math.ceil(d/h),l=Math.min(l,r),e=h):"variable"===n?(l=1,e=d,e=Math.min(e,a)):"semifixed"===n&&(l=Math.ceil(d/a),e=d/l);for(var f=0;l>f;f++){c=currentTime;var _={frame:s++,dt:e,gameTime:i};p.trigger("EnterFrame",_),p.trigger("ExitFrame",_),i+=e,currentTime=(new Date).getTime(),p.trigger("MeasureFrameTime",currentTime-c)}l>0&&(t=currentTime,p.trigger("PreRender"),p.trigger("RenderScene"),p.trigger("PostRender"),currentTime=(new Date).getTime(),p.trigger("MeasureRenderTime",currentTime-t)),o=currentTime},FPS:function(t){return"undefined"==typeof t?c:(c=t,void(h=1e3/c))},simulateFrames:function(t,e){for("undefined"==typeof e&&(e=h);t-->0;){var i={frame:s++,dt:e};p.trigger("EnterFrame",i),p.trigger("ExitFrame",i)}p.trigger("PreRender"),p.trigger("RenderScene"),p.trigger("PostRender")}}}(),e:function(){var t=i();return o[t]=null,o[t]=p(t),arguments.length>0&&o[t].addComponent.apply(o[t],arguments),o[t].setName("Entity #"+t),o[t].addComponent("obj"),p.trigger("NewEntity",{id:t}),o[t]},c:function(t,e){a[t]=e},trigger:function(t,e){var i,n,r,s,a,c=u[t]||(u[t]={});for(i in c)if(c.hasOwnProperty(i)&&(s=c[i],s&&0!==s.length)){if(o[i])a=p(+i);else{if("global"!==i)continue;a=p}for(s.depth++,r=s.length,n=0;r>n;n++)"undefined"==typeof s[n]&&s.depth<=1?(s.splice(n,1),n--,r--):s[n].call(a,e);s.depth--}},bind:function(t,e){var i=u[t]||(u[t]={});return i.global||(i.global=[],i.global.depth=0),i.global.push(e),e},uniqueBind:function(t,e){return this.unbind(t,e),this.bind(t,e)},one:function(t,e){var i=this,n=function(r){e.call(i,r),i.unbind(t,n)};return i.bind(t,n)},unbind:function(t,e){var i,n,r,s,a=u[t];if(void 0===a||void 0===a.global||0===a.global.length)return!1;if(1===arguments.length)return delete a.global,!0;for(r=a.global,s=!1,i=0,n=r.length;n>i;i++)r[i]===e&&(s=!0,delete r[i]);return s},frame:function(){return s},components:function(){return a},isComp:function(t){return t in a},debug:function(t){return"handlers"===t?u:o},settings:function(){var t={},e={};return{register:function(t,i){e[t]=i},modify:function(i,n){e[i]&&(e[i].call(t[i],n),t[i]=n)},get:function(e){return t[e]}}}(),clone:n}),"function"==typeof define&&define("crafty",[],function(){return p}),e.exports=p},{"./version":30}],11:[function(t,e){var i=t("./core");t("./2D"),t("./animation"),t("./canvas"),t("./collision"),t("./color"),t("./controls"),t("./DebugLayer"),t("./device"),t("./diamondiso"),t("./DOM"),t("./drawing"),t("./extensions"),t("./HashMap"),t("./html"),t("./isometric"),t("./keycodes"),t("./loader"),t("./math"),t("./model"),t("./particles"),t("./scenes"),t("./sound"),t("./sprite-animation"),t("./sprite"),t("./storage"),t("./text"),t("./time"),t("./version"),t("./viewport"),window&&(window.Crafty=i),e.exports=i},{"./2D":1,"./DOM":2,"./DebugLayer":3,"./HashMap":4,"./animation":5,"./canvas":6,"./collision":7,"./color":8,"./controls":9,"./core":10,"./device":12,"./diamondiso":13,"./drawing":14,"./extensions":15,"./html":16,"./isometric":17,"./keycodes":18,"./loader":19,"./math":20,"./model":21,"./particles":22,"./scenes":23,"./sound":24,"./sprite":26,"./sprite-animation":25,"./storage":27,"./text":28,"./time":29,"./version":30,"./viewport":31}],12:[function(t){{var e=t("./core.js");window.document}e.extend({device:{_deviceOrientationCallback:!1,_deviceMotionCallback:!1,_normalizeDeviceOrientation:function(t){var i;window.DeviceOrientationEvent?i={tiltLR:t.gamma,tiltFB:t.beta,dir:t.alpha,motUD:null}:window.OrientationEvent&&(i={tiltLR:90*t.x,tiltFB:-90*t.y,dir:null,motUD:t.z}),e.device._deviceOrientationCallback(i)},_normalizeDeviceMotion:function(t){var i=t.accelerationIncludingGravity,n=i.z>0?1:-1,r={acceleration:i,rawAcceleration:"["+Math.round(i.x)+", "+Math.round(i.y)+", "+Math.round(i.z)+"]",facingUp:n,tiltLR:Math.round(i.x/9.81*-90),tiltFB:Math.round((i.y+9.81)/9.81*90*n)};e.device._deviceMotionCallback(r)},deviceOrientation:function(t){this._deviceOrientationCallback=t,e.support.deviceorientation&&(window.DeviceOrientationEvent?e.addEvent(this,window,"deviceorientation",this._normalizeDeviceOrientation):window.OrientationEvent&&e.addEvent(this,window,"MozOrientation",this._normalizeDeviceOrientation))},deviceMotion:function(t){this._deviceMotionCallback=t,e.support.devicemotion&&window.DeviceMotionEvent&&e.addEvent(this,window,"devicemotion",this._normalizeDeviceMotion)}}})},{"./core.js":10}],13:[function(t){{var e=t("./core.js");window.document}e.extend({diamondIso:{_tile:{width:0,height:0,r:0},_map:{width:0,height:0,x:0,y:0},_origin:{x:0,y:0},init:function(t,e,i,n){return this._tile.width=parseInt(t,10),this._tile.height=parseInt(e,10)||parseInt(t,10)/2,this._tile.r=this._tile.width/this._tile.height,this._map.width=parseInt(i,10),this._map.height=parseInt(n,10)||parseInt(i,10),this._origin.x=this._map.height*this._tile.width/2,this},place:function(t,e,i,n){var r=this.pos2px(e,i);n||(n=1);var s=0,a=0;void 0!==t.__margin&&(s=t.__margin[0],a=t.__margin[1]),t.x=r.left+s,t.y=r.top+a-t.h,t.z=r.top*n},centerAt:function(t,i){var n=this.pos2px(t,i);e.viewport.x=-n.left+e.viewport.width/2-this._tile.width,e.viewport.y=-n.top+e.viewport.height/2},area:function(t){t||(t=0);var i=e.viewport.rect(),n=i._x,r=i._y,s=i._w,a=i._h,o=t*this._tile.width,u=t*this._tile.height;n-=this._tile.width/2+o,r-=this._tile.height/2+u,s+=this._tile.width/2+o,a+=this._tile.height/2+u;var c=[];for(yl=r+a;yl>r;r+=this._tile.height/2)for(xl=n+s;xl>n;n+=this._tile.width/2){var h=this.px2pos(n,r);c.push([~~h.x,~~h.y])}return c},pos2px:function(t,e){return{left:(t-e)*this._tile.width/2+this._origin.x,top:(t+e)*this._tile.height/2}},px2pos:function(t,e){var i=(t-this._origin.x)/this._tile.r;return{x:(e+i)/this._tile.height,y:(e-i)/this._tile.height}},polygon:function(t){t.requires("Collision");var i=0,n=0;void 0!==t.__margin&&(i=t.__margin[0],n=t.__margin[1]);var r=[[i-0,t.h-n-this._tile.height/2],[i-this._tile.width/2,t.h-n-0],[i-this._tile.width,t.h-n-this._tile.height/2],[i-this._tile.width/2,t.h-n-this._tile.height]],s=new e.polygon(r);return s}}})},{"./core.js":10}],14:[function(t){{var e=t("./core.js");window.document}e.c("Image",{_repeat:"repeat",ready:!1,init:function(){var t=function(t){if("canvas"===t.type){if(!this.ready||!this._pattern)return;var e=t.ctx;e.fillStyle=this._pattern,e.save(),e.translate(t.pos._x,t.pos._y),e.fillRect(0,0,this._w,this._h),e.restore()}else"DOM"===t.type&&this.__image&&(t.style.backgroundImage="url("+this.__image+")",t.style.backgroundRepeat=this._repeat)};this.bind("Draw",t).bind("RemoveComponent",function(e){"Image"===e&&this.unbind("Draw",t)})},image:function(t,i){if(this.__image=t,this._repeat=i||"no-repeat",this.img=e.asset(t),!this.img){this.img=new Image,e.asset(t,this.img),this.img.src=t;var n=this;return this.img.onload=function(){n.has("Canvas")&&(n._pattern=e.canvas.context.createPattern(n.img,n._repeat)),n.ready=!0,"no-repeat"===n._repeat&&(n.w=n.img.width,n.h=n.img.height),n.trigger("Invalidate")},this}return this.ready=!0,this.has("Canvas")&&(this._pattern=e.canvas.context.createPattern(this.img,this._repeat)),"no-repeat"===this._repeat&&(this.w=this.img.width,this.h=this.img.height),this.trigger("Invalidate"),this}}),e.DrawManager=function(){function t(t,e){return t._globalZ-e._globalZ}var i=[],n=[],r=[],s=!1,a={merge:function(t,e,i){return"undefined"==typeof i&&(i={}),i._h=Math.max(t._y+t._h,e._y+e._h),i._w=Math.max(t._x+t._w,e._x+e._w),i._x=Math.min(t._x,e._x),i._y=Math.min(t._y,e._y),i._w-=i._x,i._h-=i._y,i},clean:function(){var t,e,r;for(r=0,l=n.length;l>r;r++)e=n[r],t=e._mbr||e,"undefined"==typeof e.staleRect&&(e.staleRect={}),e.staleRect._x=t._x,e.staleRect._y=t._y,e.staleRect._w=t._w,e.staleRect._h=t._h,e._changed=!1;n.length=0,i.length=0},createDirty:function(t){var e=t._mbr||t;if(t.staleRect){if(a.overlap(t.staleRect,e))return a.merge(t.staleRect,e,t.staleRect),void i.push(t.staleRect);i.push(t.staleRect)}t.currentRect._x=e._x,t.currentRect._y=e._y,t.currentRect._w=e._w,t.currentRect._h=e._h,i.push(t.currentRect)},overlap:function(t,e){return t._x<e._x+e._w&&t._y<e._y+e._h&&t._x+t._w>e._x&&t._y+t._h>e._y}};return e.bind("InvalidateViewport",function(){s=!0}),e.bind("PostRender",function(){s=!1}),{total2D:e("2D").length,onScreen:function(t){return e.viewport._x+t._x+t._w>0&&e.viewport._y+t._y+t._h>0&&e.viewport._x+t._x<e.viewport.width&&e.viewport._y+t._y<e.viewport.height},mergeSet:function(t){for(var e=0;e<t.length-1;)a.overlap(t[e],t[e+1])?(a.merge(t[e],t[e+1],t[e]),t.splice(e+1,1),e>0&&e--):e++;return t},addCanvas:function(t){n.push(t)},addDom:function(t){r.push(t)},debug:function(){console.log(n,r)},drawAll:function(i){i=i||e.viewport.rect();var n,r=e.map.search(i),s=0,a=r.length,o=e.canvas.context;for(o.clearRect(i._x,i._y,i._w,i._h),r.sort(t);a>s;s++)n=r[s],n._visible&&n.__c.Canvas&&(n.draw(),n._changed=!1)},boundingRect:function(t){if(t&&t.length){var e,i,n=1,r=t.length,s=t[0];for(s=[s._x,s._y,s._x+s._w,s._y+s._h];r>n;)e=t[n],i=[e._x,e._y,e._x+e._w,e._y+e._h],i[0]<s[0]&&(s[0]=i[0]),i[1]<s[1]&&(s[1]=i[1]),i[2]>s[2]&&(s[2]=i[2]),i[3]>s[3]&&(s[3]=i[3]),n++;return i=s,s={_x:i[0],_y:i[1],_w:i[2]-i[0],_h:i[3]-i[1]}}},renderCanvas:function(){var r=n.length;if(r||s){var o,u,c,h,l,d=0,f=e.canvas.context,p=e.DrawManager;if(s){var _=e.viewport;f.setTransform(_._scale,0,0,_._scale,Math.round(_._x*_._scale),Math.round(_._y*_._scale))}if(r/p.total2D>.6||s)return p.drawAll(),void a.clean();for(d=0;r>d;d++)a.createDirty(n[d]);i=p.mergeSet(i),r=i.length;var g=[],m=[];for(d=0;r>d;++d)if(o=i[d],g.length=0,m.length=0,o){for(o._w=o._x+o._w,o._h=o._y+o._h,o._x=o._x>0?0|o._x:(0|o._x)-1,o._y=o._y>0?0|o._y:(0|o._y)-1,o._w-=o._x,o._h-=o._y,o._w=o._w===(0|o._w)?o._w:(0|o._w)+1,o._h=o._h===(0|o._h)?o._h:(0|o._h)+1,u=e.map.search(o,!1),f.clearRect(o._x,o._y,o._w,o._h),f.save(),f.beginPath(),f.rect(o._x,o._y,o._w,o._h),f.clip(),c=0,h=u.length;h>c;++c)l=u[c],!g[l[0]]&&l._visible&&l.__c.Canvas&&(g[l[0]]=!0,m.push(l));for(m.sort(t),c=0,h=m.length;h>c;++c){l=m[c];var v=l._mbr||l;a.overlap(v,o)&&l.draw(),l._changed=!1}f.closePath(),f.restore()}if(e.DrawManager.debugDirty===!0)for(f.strokeStyle="red",d=0,r=i.length;r>d;++d)o=i[d],f.strokeRect(o._x,o._y,o._w,o._h);a.clean()}},renderDOM:function(){if(s){var t=e.stage.inner.style,i=e.viewport;t.transform=t[e.support.prefix+"Transform"]="scale("+i._scale+", "+i._scale+")",t.left=Math.round(i._x*i._scale)+"px",t.top=Math.round(i._y*i._scale)+"px",t.zIndex=10}if(r.length){for(var n=0,a=r.length;a>n;++n)r[n].draw()._changed=!1;r.length=0}}}}(),e.extend({_pixelartEnabled:!1,pixelart:function(t){e._pixelartEnabled=t,e.trigger("PixelartSet",t)}})},{"./core.js":10}],15:[function(t){var e=t("./core.js"),i=window.document;!function(){var t=e.support={},n=navigator.userAgent.toLowerCase(),r=/(webkit)[ \/]([\w.]+)/.exec(n)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(n)||/(ms)ie ([\w.]+)/.exec(n)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(n)||[],s=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(n);if(s&&(e.mobile=!1),t.defineProperty=function(){if(!("defineProperty"in Object))return!1;try{Object.defineProperty({},"x",{})}catch(t){return!1}return!0}(),t.audio="Audio"in window,t.prefix=r[1]||r[0],"moz"===t.prefix&&(t.prefix="Moz"),"o"===t.prefix&&(t.prefix="O"),r[2]&&(t.versionName=r[2],t.version=+r[2].split(".")[0]),t.canvas="getContext"in i.createElement("canvas"),t.canvas){var a;try{a=i.createElement("canvas").getContext("experimental-webgl"),a.viewportWidth=t.canvas.width,a.viewportHeight=t.canvas.height}catch(o){}t.webgl=!!a}else t.webgl=!1;t.css3dtransform="undefined"!=typeof i.createElement("div").style.Perspective||"undefined"!=typeof i.createElement("div").style[t.prefix+"Perspective"],t.deviceorientation="undefined"!=typeof window.DeviceOrientationEvent||"undefined"!=typeof window.OrientationEvent,t.devicemotion="undefined"!=typeof window.DeviceMotionEvent}(),e.extend({_events:{},addEvent:function(t,e,i,n){3===arguments.length&&(n=i,i=e,e=window.document);var r=function(e){e=e||window.event,"function"==typeof n&&n.call(t,e)},s=t[0]||"";this._events[s+e+i+n]||(this._events[s+e+i+n]=r,e.attachEvent?e.attachEvent("on"+i,r):e.addEventListener(i,r,!1))},removeEvent:function(t,e,i,n){3===arguments.length&&(n=i,i=e,e=window.document);var r=t[0]||"",s=this._events[r+e+i+n];s&&(e.detachEvent?e.detachEvent("on"+i,s):e.removeEventListener(i,s,!1),delete this._events[r+e+i+n])},background:function(t){e.stage.elem.style.background=t}})},{"./core.js":10}],16:[function(t){{var e=t("./core.js");window.document}e.c("HTML",{inner:"",init:function(){this.requires("2D, DOM")},replace:function(t){return this.inner=t,this._element.innerHTML=t,this},append:function(t){return this.inner+=t,this._element.innerHTML+=t,this},prepend:function(t){return this.inner=t+this.inner,this._element.innerHTML=t+this.inner,this}})},{"./core.js":10}],17:[function(t){{var e=t("./core.js");window.document}e.extend({isometric:{_tile:{width:0,height:0},_elements:{},_pos:{x:0,y:0},_z:0,size:function(t,e){return this._tile.width=t,this._tile.height=e>0?e:t/2,this},place:function(t,i,n,r){var s=this.pos2px(t,i);return s.top-=n*(this._tile.height/2),r.attr({x:s.left+e.viewport._x,y:s.top+e.viewport._y}).z+=n,this},pos2px:function(t,e){return{left:t*this._tile.width+(1&e)*(this._tile.width/2),top:e*this._tile.height/2}},px2pos:function(t,e){return{x:-Math.ceil(-t/this._tile.width-.5*(1&e)),y:e/this._tile.height*2}},centerAt:function(t,i){if("number"==typeof t&&"number"==typeof i){var n=this.pos2px(t,i);return e.viewport._x=-n.left+e.viewport.width/2-this._tile.width/2,e.viewport._y=-n.top+e.viewport.height/2-this._tile.height/2,this}return{top:-e.viewport._y+e.viewport.height/2-this._tile.height/2,left:-e.viewport._x+e.viewport.width/2-this._tile.width/2}},area:function(){var t=this.centerAt(),i=this.px2pos(-t.left+e.viewport.width/2,-t.top+e.viewport.height/2),n=this.px2pos(-t.left-e.viewport.width/2,-t.top-e.viewport.height/2);return{x:{start:i.x,end:n.x},y:{start:i.y,end:n.y}}}}})},{"./core.js":10}],18:[function(t){{var e=t("./core.js");window.document}e.extend({keys:{BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,PULT_UP:29460,PULT_DOWN:29461,PULT_LEFT:4,PULT_RIGHT:5},mouseButtons:{LEFT:0,MIDDLE:1,RIGHT:2}})},{"./core.js":10}],19:[function(t){{var e=t("./core.js");window.document}e.extend({assets:{},__paths:{audio:"",images:""},paths:function(t){return"undefined"==typeof t?this.__paths:(t.audio&&(this.__paths.audio=t.audio),void(t.images&&(this.__paths.images=t.images)))},asset:function(t,i){return 1===arguments.length?e.assets[t]:e.assets[t]?void 0:(e.assets[t]=i,this.trigger("NewAsset",{key:t,value:i}),i)},image_whitelist:["jpg","jpeg","gif","png","svg"],load:function(t,i,n,r){function s(){var t=this.src;this.removeEventListener&&this.removeEventListener("canplaythrough",s,!1),d++,n&&n({loaded:d,total:f,percent:d/f*100,src:t}),d===f&&i&&i()}function a(){var t=this.src;r&&r({loaded:d,total:f,percent:d/f*100,src:t}),d++,d===f&&i&&i()}t="string"==typeof t?JSON.parse(t):t;var o,u,c,h,l,d=0,f=(t.audio?Object.keys(t.audio).length:0)+(t.images?Object.keys(t.images).length:0)+(t.sprites?Object.keys(t.sprites).length:0),p=e.support.audio,_=e.paths(),g=function(t){return t.substr(t.lastIndexOf(".")+1,3).toLowerCase()},m=function(t,e){return-1===e.search("://")?"audio"==t?_.audio+e:_.images+e:e},v=function(t){return e.asset(t)||null},y=function(t){return e.audio.supports(g(t))},b=function(){return!0},w=function(t,i){t.onload=s,"webkit"===e.support.prefix&&(t.src=""),t.src=i};for(h in t)for(l in t[h]){if(o=t[h][l],"audio"===h&&p){if("object"==typeof o){var x=[];for(var A in o)u=m(h,o[A]),!v(u)&&y(o[A])&&x.push(u);c=e.audio.add(l,x).obj}else"string"==typeof o&&y(o)&&(u=m(h,o),v(u)||(c=e.audio.add(l,u).obj));c&&c.addEventListener&&c.addEventListener("canplaythrough",s,!1)}else l="sprites"===h?l:o,u=m(h,l),b(l)&&(c=v(u),c||(c=new Image,"sprites"===h&&e.sprite(o.tile,o.tileh,u,o.map,o.paddingX,o.paddingY,o.paddingAroundBorder),e.asset(u,c)),w(c,u));c?c.onerror=a:--f}0===f&&i()},removeAssets:function(t){t="string"==typeof t?JSON.parse(t):t;var i,n,r,s,a=e.paths(),o=function(t,e){return-1===e.search("://")?"audio"==t?a.audio+e:a.images+e:e};for(r in t)for(s in t[r])if(i=t[r][s],"audio"===r)if("object"==typeof i)for(var u in i)n=o(r,i[u]),e.asset(n)&&e.audio.remove(s);else"string"==typeof i&&(n=o(r,i),e.asset(n)&&e.audio.remove(s));else if(s="sprites"===r?s:i,n=o(r,s),e.asset(n)){if("sprites"===r)for(var c in i.map)delete e.components()[c];delete e.assets[n]}}})},{"./core.js":10}],20:[function(t){{var e=t("./core.js");window.document}e.math={abs:function(t){return 0>t?-t:t},amountOf:function(t,e,i){return i>e?(t-e)/(i-e):(t-i)/(e-i)},clamp:function(t,e,i){return t>i?i:e>t?e:t},degToRad:function(t){return t*Math.PI/180},distance:function(t,i,n,r){var s=e.math.squaredDistance(t,i,n,r);return Math.sqrt(parseFloat(s))},lerp:function(t,e,i){return t+(e-t)*i},negate:function(t){return Math.random()<t?-1:1},radToDeg:function(t){return 180*t/Math.PI},randomElementOfArray:function(t){return t[Math.floor(t.length*Math.random())]},randomInt:function(t,e){return t+Math.floor((1+e-t)*Math.random())},randomNumber:function(t,e){return t+(e-t)*Math.random()},squaredDistance:function(t,e,i,n){return(t-i)*(t-i)+(e-n)*(e-n)},withinRange:function(t,e,i){return t>=e&&i>=t}},e.math.Vector2D=function(){function t(e,i){if(e instanceof t)this.x=e.x,this.y=e.y;else if(2===arguments.length)this.x=e,this.y=i;else if(arguments.length>0)throw"Unexpected number of arguments for Vector2D()"}return t.prototype.x=0,t.prototype.y=0,t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.angleBetween=function(t){return Math.atan2(this.x*t.y-this.y*t.x,this.x*t.x+this.y*t.y)},t.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},t.prototype.clone=function(){return new t(this)},t.prototype.distance=function(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))},t.prototype.distanceSq=function(t){return(t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y)},t.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.crossProduct=function(t){return this.x*t.y-this.y*t.x},t.prototype.equals=function(e){return e instanceof t&&this.x==e.x&&this.y==e.y},t.prototype.perpendicular=function(e){return e=e||new t,e.setValues(-this.y,this.x)},t.prototype.getNormal=function(e,i){return i=i||new t,i.setValues(e.y-this.y,this.x-e.x).normalize()},t.prototype.isZero=function(){return 0===this.x&&0===this.y},t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.magnitudeSq=function(){return this.x*this.x+this.y*this.y},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return 0===t?(this.x=1,this.y=0):(this.x/=t,this.y/=t),this},t.prototype.scale=function(t,e){return void 0===e&&(e=t),this.x*=t,this.y*=e,this},t.prototype.scaleToMagnitude=function(t){var e=t/this.magnitude();return this.x*=e,this.y*=e,this},t.prototype.setValues=function(e,i){return e instanceof t?(this.x=e.x,this.y=e.y):(this.x=e,this.y=i),this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.toString=function(){return"Vector2D("+this.x+", "+this.y+")"},t.prototype.translate=function(t,e){return void 0===e&&(e=t),this.x+=t,this.y+=e,this},t.tripleProduct=function(t,i,n,r){r=r||new e.math.Vector2D;var s=t.dotProduct(n),a=i.dotProduct(n);return r.setValues(i.x*s-t.x*a,i.y*s-t.y*a)},t}(),e.math.Matrix2D=function(){return Matrix2D=function(t,e,i,n,r,s){if(t instanceof Matrix2D)this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f;
else if(6===arguments.length)this.a=t,this.b=e,this.c=i,this.d=n,this.e=r,this.f=s;else if(arguments.length>0)throw"Unexpected number of arguments for Matrix2D()"},Matrix2D.prototype.a=1,Matrix2D.prototype.b=0,Matrix2D.prototype.c=0,Matrix2D.prototype.d=1,Matrix2D.prototype.e=0,Matrix2D.prototype.f=0,Matrix2D.prototype.apply=function(t){var e=t.x;return t.x=e*this.a+t.y*this.c+this.e,t.y=e*this.b+t.y*this.d+this.f,t},Matrix2D.prototype.clone=function(){return new Matrix2D(this)},Matrix2D.prototype.combine=function(t){var e=this.a;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,e=this.c,this.c=e*t.a+this.d*t.c,this.d=e*t.b+this.d*t.d,e=this.e,this.e=e*t.a+this.f*t.c+t.e,this.f=e*t.b+this.f*t.d+t.f,this},Matrix2D.prototype.equals=function(t){return t instanceof Matrix2D&&this.a==t.a&&this.b==t.b&&this.c==t.c&&this.d==t.d&&this.e==t.e&&this.f==t.f},Matrix2D.prototype.determinant=function(){return this.a*this.d-this.b*this.c},Matrix2D.prototype.invert=function(){var t=this.determinant();if(0!==t){var e={a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f};this.a=e.d/t,this.b=-e.b/t,this.c=-e.c/t,this.d=e.a/t,this.e=(e.c*e.f-e.e*e.d)/t,this.f=(e.e*e.b-e.a*e.f)/t}return this},Matrix2D.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},Matrix2D.prototype.isInvertible=function(){return 0!==this.determinant()},Matrix2D.prototype.preRotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a;return this.a=e*n-i*this.b,this.b=i*n+e*this.b,n=this.c,this.c=e*n-i*this.d,this.d=i*n+e*this.d,this},Matrix2D.prototype.preScale=function(t,e){return void 0===e&&(e=t),this.a*=t,this.b*=e,this.c*=t,this.d*=e,this},Matrix2D.prototype.preTranslate=function(t,e){return"number"==typeof t?(this.e+=t,this.f+=e):(this.e+=t.x,this.f+=t.y),this},Matrix2D.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a;return this.a=e*n-i*this.b,this.b=i*n+e*this.b,n=this.c,this.c=e*n-i*this.d,this.d=i*n+e*this.d,n=this.e,this.e=e*n-i*this.f,this.f=i*n+e*this.f,this},Matrix2D.prototype.scale=function(t,e){return void 0===e&&(e=t),this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.e*=t,this.f*=e,this},Matrix2D.prototype.setValues=function(t,e,i,n,r,s){return t instanceof Matrix2D?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f):(this.a=t,this.b=e,this.c=i,this.d=n,this.e=r,this.f=s),this},Matrix2D.prototype.toString=function(){return"Matrix2D(["+this.a+", "+this.c+", "+this.e+"] ["+this.b+", "+this.d+", "+this.f+"] [0, 0, 1])"},Matrix2D.prototype.translate=function(t,e){return"number"==typeof t?(this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e):(this.e+=this.a*t.x+this.c*t.y,this.f+=this.b*t.x+this.d*t.y),this},Matrix2D}()},{"./core.js":10}],21:[function(t){{var e=t("./core.js");window.document}e.c("Model",{init:function(){this.changed=[],this.bind("Change",this._changed_attributes),this.bind("Change",this._changed_triggers)},_changed_triggers:function(t,i){var n;i=e.extend.call({pre:""},i);for(n in t)this.trigger("Change["+i.pre+n+"]",t[n]),"Object"===t[n].constructor.name&&this._changed_triggers(t[n],{pre:i.pre+n+"."})},_changed_attributes:function(t){var e;for(e in t)this.changed.push(e);return this},is_dirty:function(t){return 0===arguments.length?!!this.changed.length:this.changed.indexOf(t)>-1}})},{"./core.js":10}],22:[function(t){var e=t("./core.js"),i=window.document;e.c("Particles",{init:function(){this._Particles=e.clone(this._Particles),this._Particles.parentEntity=this},particles:function(t){if(!e.support.canvas||e.deactivateParticles)return this;var n,r,s,a,o;n=i.createElement("canvas"),n.width=e.viewport.width,n.height=e.viewport.height,n.style.position="absolute",n.style.left="0px",n.style.top="0px",e.stage.elem.appendChild(n),r=n.getContext("2d"),this._Particles.init(t),this.bind("Remove",function(){e.stage.elem.removeChild(n)}).bind("RemoveComponent",function(t){"particles"===t&&e.stage.elem.removeChild(n)}),s=this.x+e.viewport.x,a=this.y+e.viewport.y,this._Particles.position=this._Particles.vectorHelpers.create(s,a);var u={x:e.viewport.x,y:e.viewport.y};return this.bind("EnterFrame",function(){s=this.x+e.viewport.x,a=this.y+e.viewport.y,this._Particles.viewportDelta={x:e.viewport.x-u.x,y:e.viewport.y-u.y},u={x:e.viewport.x,y:e.viewport.y},this._Particles.position=this._Particles.vectorHelpers.create(s,a),"function"==typeof e.DrawManager.boundingRect?(o=e.DrawManager.boundingRect(this._Particles.register),o&&r.clearRect(o._x,o._y,o._w,o._h)):r.clearRect(0,0,e.viewport.width,e.viewport.height),this._Particles.update(),this._Particles.render(r)}),this},_Particles:{presets:{maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:!1,gravity:{x:0,y:.1},jitter:0,particles:[],active:!0,particleCount:0,elapsedFrames:0,emissionRate:0,emitCounter:0,particleIndex:0},init:function(t){this.position=this.vectorHelpers.create(0,0),"undefined"==typeof t&&(t={});for(var e in this.presets)this[e]="undefined"!=typeof t[e]?t[e]:this.presets[e];this.emissionRate=this.maxParticles/this.lifeSpan,this.positionRandom=this.vectorHelpers.create(this.spread,this.spread)},addParticle:function(){if(this.particleCount==this.maxParticles)return!1;var t=new this.particle(this.vectorHelpers);return this.initParticle(t),this.particles[this.particleCount]=t,this.particleCount++,!0},RANDM1TO1:function(){return 2*Math.random()-1},initParticle:function(t){t.position.x=this.position.x+this.positionRandom.x*this.RANDM1TO1(),t.position.y=this.position.y+this.positionRandom.y*this.RANDM1TO1();var e=(this.angle+this.angleRandom*this.RANDM1TO1())*(Math.PI/180),i=this.vectorHelpers.create(Math.sin(e),-Math.cos(e)),n=this.speed+this.speedRandom*this.RANDM1TO1();t.direction=this.vectorHelpers.multiply(i,n),t.size=this.size+this.sizeRandom*this.RANDM1TO1(),t.size=t.size<0?0:~~t.size,t.timeToLive=this.lifeSpan+this.lifeSpanRandom*this.RANDM1TO1(),t.sharpness=this.sharpness+this.sharpnessRandom*this.RANDM1TO1(),t.sharpness=t.sharpness>100?100:t.sharpness<0?0:t.sharpness,t.sizeSmall=~~(t.size/200*t.sharpness);var r=[this.startColour[0]+this.startColourRandom[0]*this.RANDM1TO1(),this.startColour[1]+this.startColourRandom[1]*this.RANDM1TO1(),this.startColour[2]+this.startColourRandom[2]*this.RANDM1TO1(),this.startColour[3]+this.startColourRandom[3]*this.RANDM1TO1()],s=[this.endColour[0]+this.endColourRandom[0]*this.RANDM1TO1(),this.endColour[1]+this.endColourRandom[1]*this.RANDM1TO1(),this.endColour[2]+this.endColourRandom[2]*this.RANDM1TO1(),this.endColour[3]+this.endColourRandom[3]*this.RANDM1TO1()];t.colour=r,t.deltaColour[0]=(s[0]-r[0])/t.timeToLive,t.deltaColour[1]=(s[1]-r[1])/t.timeToLive,t.deltaColour[2]=(s[2]-r[2])/t.timeToLive,t.deltaColour[3]=(s[3]-r[3])/t.timeToLive},update:function(){if(this.active&&this.emissionRate>0){var t=1/this.emissionRate;for(this.emitCounter++;this.particleCount<this.maxParticles&&this.emitCounter>t;)this.addParticle(),this.emitCounter-=t;this.elapsedFrames++,-1!=this.duration&&this.duration<this.elapsedFrames&&this.stop()}this.particleIndex=0,this.register=[];for(var e;this.particleIndex<this.particleCount;){var i=this.particles[this.particleIndex];if(i.timeToLive>0){i.direction=this.vectorHelpers.add(i.direction,this.gravity),i.position=this.vectorHelpers.add(i.position,i.direction),i.position=this.vectorHelpers.add(i.position,this.viewportDelta),this.jitter&&(i.position.x+=this.jitter*this.RANDM1TO1(),i.position.y+=this.jitter*this.RANDM1TO1()),i.timeToLive--;var n=i.colour[0]+=i.deltaColour[0],r=i.colour[1]+=i.deltaColour[1],s=i.colour[2]+=i.deltaColour[2],a=i.colour[3]+=i.deltaColour[3];e=[],e.push("rgba("+(n>255?255:0>n?0:~~n)),e.push(r>255?255:0>r?0:~~r),e.push(s>255?255:0>s?0:~~s),e.push((a>1?1:0>a?0:a.toFixed(2))+")"),i.drawColour=e.join(","),this.fastMode||(e[3]="0)",i.drawColourEnd=e.join(",")),this.particleIndex++}else this.particleIndex!=this.particleCount-1&&(this.particles[this.particleIndex]=this.particles[this.particleCount-1]),this.particleCount--;var o={};o._x=~~i.position.x,o._y=~~i.position.y,o._w=i.size,o._h=i.size,this.register.push(o)}},stop:function(){this.active=!1,this.elapsedFrames=0,this.emitCounter=0,this.parentEntity.trigger("ParticleEnd")},render:function(t){for(var i=0,n=this.particleCount;n>i;i++){var r=this.particles[i],s=r.size,a=s>>1;if(!(r.position.x+s<0||r.position.y+s<0||r.position.x-s>e.viewport.width||r.position.y-s>e.viewport.height)){var o=~~r.position.x,u=~~r.position.y;if(this.fastMode)t.fillStyle=r.drawColour;else{var c=t.createRadialGradient(o+a,u+a,r.sizeSmall,o+a,u+a,a);c.addColorStop(0,r.drawColour),c.addColorStop(.9,r.drawColourEnd),t.fillStyle=c}t.fillRect(o,u,s,s)}}},particle:function(t){this.position=t.create(0,0),this.direction=t.create(0,0),this.size=0,this.sizeSmall=0,this.timeToLive=0,this.colour=[],this.drawColour="",this.deltaColour=[],this.sharpness=0},vectorHelpers:{create:function(t,e){return{x:t,y:e}},multiply:function(t,e){return t.x*=e,t.y*=e,t},add:function(t,e){return t.x+=e.x,t.y+=e.y,t}}}})},{"./core.js":10}],23:[function(t){{var e=t("./core.js");window.document}e.extend({_scenes:{},_current:null,scene:function(t,i,n){return 1===arguments.length||"function"!=typeof arguments[1]?void e.enterScene(t,arguments[1]):void e.defineScene(t,i,n)},defineScene:function(t,e,i){if("function"!=typeof e)throw"Init function is the wrong type.";this._scenes[t]={},this._scenes[t].initialize=e,"undefined"!=typeof i&&(this._scenes[t].uninitialize=i)},enterScene:function(t,i){if("function"==typeof i)throw"Scene data cannot be a function";e.trigger("SceneDestroy",{newScene:t}),e.viewport.reset(),e("2D").each(function(){this.has("Persist")||this.destroy()}),null!==this._current&&"uninitialize"in this._scenes[this._current]&&this._scenes[this._current].uninitialize.call(this);var n=this._current;this._current=t,e.trigger("SceneChange",{oldScene:n,newScene:t}),this._scenes[t].initialize.call(this,i)}})},{"./core.js":10}],24:[function(t){var e=t("./core.js"),i=window.document;e.extend({audio:{sounds:{},supported:null,codecs:{ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',webma:'audio/webm; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"',m4a:'audio/mp4; codecs="mp4a.40.2"'},volume:1,muted:!1,paused:!1,playCheck:null,_canPlay:function(){if(this.supported={},e.support.audio){var t,i=this.audioElement();for(var n in this.codecs)t=i.canPlayType(this.codecs[n]),this.supported[n]=""!==t&&"no"!==t?!0:!1}},supports:function(t){return null===this.supported&&this._canPlay(),this.supported[t]?!0:!1},audioElement:function(){return"undefined"!=typeof Audio?new Audio(""):i.createElement("audio")},create:function(t,i){var n=i.substr(i.lastIndexOf(".")+1).toLowerCase();if(!this.supports(n))return!1;var r=this.audioElement();return r.id=t,r.preload="auto",r.volume=e.audio.volume,r.src=i,e.asset(i,r),this.sounds[t]={obj:r,played:0,volume:e.audio.volume},this.sounds[t]},add:function(t,i){if(e.support.audio){var n,r;if(1===arguments.length&&"object"==typeof t)for(var s in t)for(n in t[s])if(r=e.audio.create(s,t[s][n]))break;if("string"==typeof t&&("string"==typeof i&&(r=e.audio.create(t,i)),"object"==typeof i))for(n in i)if(r=e.audio.create(t,i[n]))break;return r}},play:function(t,i,n){if(0!==i&&e.support.audio&&this.sounds[t]){var r=this.sounds[t],s=this.getOpenChannel();if(!s)return null;s.id=t,s.repeat=i;var a=s.obj;return s.volume=r.volume=r.obj.volume=n||e.audio.volume,a.volume=r.volume,a.src=r.obj.src,this.muted&&(a.volume=0),a.play(),r.played++,s.onEnd=function(){r.played<s.repeat||-1==i?(this.currentTime&&(this.currentTime=0),this.play(),r.played++):(s.active=!1,this.pause(),this.removeEventListener("ended",s.onEnd,!0),this.currentTime=0,e.trigger("SoundComplete",{id:s.id}))},a.addEventListener("ended",s.onEnd,!0),a}},maxChannels:7,setChannels:function(t){this.maxChannels=t,t<this.channels.length&&(this.channels.length=t)},channels:[],getOpenChannel:function(){for(var t=0;t<this.channels.length;t++){var e=this.channels[t];if(e.active===!1||e.obj.ended&&e.repeat<=this.sounds[e.id].played)return e.active=!0,e}if(t<this.maxChannels){var i={obj:this.audioElement(),active:!0,_is:function(t){return this.id===t&&this.active}};return this.channels.push(i),i}return null},remove:function(t){if(e.support.audio){var i,n,r=e.paths().audio;if(t)this.sounds[t]&&(i=this.sounds[t],n=i.obj.src.split("/").pop(),e.audio.stop(t),delete e.assets[r+n],delete e.assets[i.obj.src],delete e.audio.sounds[t]);else for(var s in this.sounds)i=this.sounds[s],n=i.obj.src.split("/").pop(),e.audio.stop(t),delete e.assets[r+n],delete e.assets[i.obj.src],delete e.audio.sounds[t]}},stop:function(t){if(e.support.audio)for(var i in this.channels)c=this.channels[i],(!t&&c.active||c._is(t))&&(c.active=!1,c.obj.pause())},_mute:function(t){if(e.support.audio){var i;for(var n in this.channels)i=this.channels[n],i.obj.volume=t?0:i.volume;this.muted=t}},toggleMute:function(){this._mute(this.muted?!1:!0)},mute:function(){this._mute(!0)},unmute:function(){this._mute(!1)},pause:function(t){if(e.support.audio&&t&&this.sounds[t]){var i;for(var n in this.channels)i=this.channels[n],i._is(t)&&!i.obj.paused&&i.obj.pause()}},unpause:function(t){if(e.support.audio&&t&&this.sounds[t]){var i;for(var n in this.channels)i=this.channels[n],i._is(t)&&i.obj.paused&&i.obj.play()}},togglePause:function(t){if(e.support.audio&&t&&this.sounds[t]){var i;for(var n in this.channels)i=this.channels[n],i._is(t)&&(i.obj.paused?i.obj.play():i.obj.pause())}},isPlaying:function(t){if(!e.support.audio)return!1;for(var i in this.channels)if(this.channels[i]._is(t))return!0;return!1}}})},{"./core.js":10}],25:[function(t){{var e=t("./core.js");t("./animation.js"),window.document}e.c("SpriteAnimation",{_reels:null,_currentReelId:null,_currentReel:null,_isPlaying:!1,animationSpeed:1,init:function(){this._reels={}},reel:function(t,i,n,r,s){if(0===arguments.length)return this._currentReelId;if(1===arguments.length&&"string"==typeof t){if("undefined"==typeof this._reels[t])throw"The specified reel "+t+" is undefined.";return this.pauseAnimation(),this._currentReelId!==t&&(this._currentReelId=t,this._currentReel=this._reels[t],this._updateSprite(),this.trigger("ReelChange",this._currentReel)),this}var a,o;if(a={id:t,frames:[],currentFrame:0,easing:new e.easing(i),defaultLoops:1},a.duration=a.easing.duration,"number"==typeof n)if(o=n,y=r,s>=0)for(;n+s>o;o++)a.frames.push([o,y]);else for(;o>n+s;o--)a.frames.push([o,y]);else{if(3!==arguments.length||"object"!=typeof n)throw"Urecognized arguments. Please see the documentation for 'reel(...)'.";a.frames=n}return this._reels[t]=a,this},animate:function(t,e){"string"==typeof t&&this.reel(t);var i=this._currentReel;if("undefined"==typeof i||null===i)throw"No reel is specified, and there is no currently active reel.";return this.pauseAnimation(),"undefined"==typeof e&&(e="number"==typeof t?t:1),i.easing.reset(),this.loops(e),this._setFrame(0),this.bind("EnterFrame",this._animationTick),this._isPlaying=!0,this.trigger("StartAnimation",i),this},resumeAnimation:function(){return this._isPlaying===!1&&null!==this._currentReel&&(this.bind("EnterFrame",this._animationTick),this._isPlaying=!0,this._currentReel.easing.resume(),this.trigger("StartAnimation",this._currentReel)),this},pauseAnimation:function(){return this._isPlaying===!0&&(this.unbind("EnterFrame",this._animationTick),this._isPlaying=!1,this._reels[this._currentReelId].easing.pause()),this},resetAnimation:function(){var t=this._currentReel;if(null===t)throw"No active reel to reset.";return this.reelPosition(0),t.easing.repeat(t.defaultLoops),this},loops:function(t){return 0===arguments.length?null!==this._currentReel?this._currentReel.easing.loops:0:(null!==this._currentReel&&(0>t&&(t=1/0),this._currentReel.easing.repeat(t),this._currentReel.defaultLoops=t),this)},reelPosition:function(t){if(null===this._currentReel)throw"No active reel.";if(0===arguments.length)return this._currentReel.currentFrame;var e,i=this._currentReel.frames.length;if("end"===t&&(t=i-1),1>t&&t>0)e=t,t=Math.floor(i*e);else{if(t!==Math.floor(t))throw"Position "+t+" is invalid.";0>t&&(t=i-1+t),e=t/i}return t=Math.min(t,i-1),t=Math.max(t,0),this._setProgress(e),this._setFrame(t),this},_animationTick:function(t){var e=this._reels[this._currentReelId];e.easing.tick(t.dt*this.animationSpeed);var i=e.easing.value(),n=Math.min(Math.floor(e.frames.length*i),e.frames.length-1);this._setFrame(n),e.easing.complete===!0&&(this.pauseAnimation(),this.trigger("AnimationEnd",this._currentReel))},_setFrame:function(t){var e=this._currentReel;t!==e.currentFrame&&(e.currentFrame=t,this._updateSprite(),this.trigger("FrameChange",e))},_updateSprite:function(){var t=this._currentReel,e=t.frames[t.currentFrame];this.sprite(e[0],e[1])},_setProgress:function(t,e){this._currentReel.easing.setProgress(t,e)},isPlaying:function(t){return this._isPlaying?t?this._currentReelId===t:!!this._currentReelId:!1},getReel:function(t){if(0===arguments.length){if(!this._currentReelId)return null;t=this._currentReelId}return this._reels[t]}})},{"./animation.js":5,"./core.js":10}],26:[function(t){{var e=t("./core.js");window.document}e.extend({sprite:function(t,i,n,r,s,a,o){var u,c,h;"string"==typeof t&&(a=s,s=r,r=i,n=t,t=1,i=1),"string"==typeof i&&(a=s,s=r,r=n,n=i,i=t),!a&&s&&(a=s),s=parseInt(s||0,10),a=parseInt(a||0,10);var l=function(){this.ready=!0,this.trigger("Invalidate")};h=e.asset(n),h||(h=new Image,h.src=n,e.asset(n,h),h.onload=function(){for(var t in r)e(t).each(l)});var d=function(){this.requires("2D, Sprite"),this.__trim=[0,0,0,0],this.__image=n,this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]],this.__tile=t,this.__tileh=i,this.__padding=[s,a],this.__padBorder=o,this.sprite(this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]),this.img=h,this.img.complete&&this.img.width>0&&(this.ready=!0,this.trigger("Invalidate")),this.w=this.__coord[2],this.h=this.__coord[3]};for(u in r)r.hasOwnProperty(u)&&(c=r[u],e.c(u,{ready:!1,__coord:[c[0],c[1],c[2]||1,c[3]||1],init:d}));return this}}),e.c("Sprite",{__image:"",__tile:0,__tileh:0,__padding:null,__trim:null,img:null,ready:!1,init:function(){this.__trim=[0,0,0,0];var t=function(t){var e=t.co,i=t.pos,n=t.ctx;if("canvas"===t.type)n.drawImage(this.img,e.x,e.y,e.w,e.h,i._x,i._y,i._w,i._h);else if("DOM"===t.type){var r=this._h/e.h,s=this._w/e.w,a=this._element.style;a.background=a.backgroundColor+" url('"+this.__image+"') no-repeat",a.backgroundPosition="-"+e.x*s+"px -"+e.y*r+"px",(1!=r||1!=s)&&(a.backgroundSize=this.img.width*s+"px "+this.img.height*r+"px")}};this.bind("Draw",t).bind("RemoveComponent",function(e){"Sprite"===e&&this.unbind("Draw",t)})},sprite:function(t,e,i,n){return this.__coord=this.__coord||[0,0,0,0],this.__coord[0]=t*(this.__tile+this.__padding[0])+(this.__padBorder?this.__padding[0]:0)+this.__trim[0],this.__coord[1]=e*(this.__tileh+this.__padding[1])+(this.__padBorder?this.__padding[1]:0)+this.__trim[1],"undefined"!=typeof i&&"undefined"!=typeof n&&(this.__coord[2]=this.__trim[2]||i*this.__tile||this.__tile,this.__coord[3]=this.__trim[3]||n*this.__tileh||this.__tileh),this.trigger("Invalidate"),this},crop:function(t,e,i,n){var r=this._mbr||this.pos();return this.__trim=[],this.__trim[0]=t,this.__trim[1]=e,this.__trim[2]=i,this.__trim[3]=n,this.__coord[0]+=t,this.__coord[1]+=e,this.__coord[2]=i,this.__coord[3]=n,this._w=i,this._h=n,this.trigger("Invalidate",r),this}})},{"./core.js":10}],27:[function(t){{var e=t("./core.js");window.document}e.storage=function(t,e){var i=window.localStorage,n=e;if(!i)return!1;if(1===arguments.length)try{return JSON.parse(i.getItem(t))}catch(r){return i.getItem(t)}else"object"==typeof e&&(n=JSON.stringify(e)),i.setItem(t,n)},e.storage.remove=function(t){window.localStorage.removeItem(t)}},{"./core.js":10}],28:[function(t){{var e=t("./core.js");window.document}e.c("Text",{_text:"",defaultSize:"10px",defaultFamily:"sans-serif",defaultVariant:"normal",defaultLineHeight:"normal",ready:!0,init:function(){this.requires("2D"),this._textFont={type:"",weight:"",size:this.defaultSize,lineHeight:this.defaultLineHeight,family:this.defaultFamily,variant:this.defaultVariant},this.bind("Draw",function(t){var e=this._fontString();if("DOM"===t.type){var i=this._element,n=i.style;n.color=this._textColor,n.font=e,n.fontFamily=this._textFont.family,i.innerHTML=this._text}else if("canvas"===t.type){var r=t.ctx;r.save(),r.textBaseline="top",r.fillStyle=this._textColor||"rgb(0,0,0)",r.font=e,r.fillText(this._text,t.pos._x,t.pos._y),r.restore()}})},_getFontHeight:function(){var t=/([a-zA-Z]+)\b/,e={px:1,pt:4/3,pc:16,cm:96/2.54,mm:96/25.4,"in":96,em:void 0,ex:void 0};return function(i){var n=parseFloat(i),r=t.exec(i),s=r?r[1]:"px";return Math.ceil(void 0!==e[s]?n*e[s]:n)}}(),text:function(t){return"undefined"==typeof t||null===t?this._text:(this._text="function"==typeof t?t.call(this):t,this.has("Canvas")&&this._resizeForCanvas(),this.trigger("Invalidate"),this)},_resizeForCanvas:function(){var t=e.canvas.context;t.font=this._fontString(),this.w=t.measureText(this._text).width;var i=this._textFont.size||this.defaultSize;this.h=1.1*this._getFontHeight(i)},_fontString:function(){return this._textFont.type+" "+this._textFont.variant+" "+this._textFont.weight+" "+this._textFont.size+" / "+this._textFont.lineHeight+" "+this._textFont.family},textColor:function(t){return e.assignColor(t,this),this._textColor="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")",this.trigger("Invalidate"),this},textFont:function(t,e){if(1===arguments.length){if("string"==typeof t)return this._textFont[t];if("object"==typeof t)for(var i in t)this._textFont[i]="family"==i?"'"+t[i]+"'":t[i]}else this._textFont[t]=e;return this.has("Canvas")&&this._resizeForCanvas(),this.trigger("Invalidate"),this},unselectable:function(){return this.has("DOM")&&(this.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"default"}),this.trigger("Invalidate")),this}})},{"./core.js":10}],29:[function(t){{var e=t("./core.js");window.document}e.c("Delay",{init:function(){this._delays=[],this.bind("EnterFrame",function(t){for(var e=this._delays.length;--e>=0;){var i=this._delays[e];if(i===!1)this._delays.splice(e,1);else{for(i.accumulator+=t.dt;i.accumulator>=i.delay&&i.repeat>=0;)i.accumulator-=i.delay,i.repeat--,i.callback.call(this);i.repeat<0&&(this._delays.splice(e,1),"function"==typeof i.callbackOff&&i.callbackOff.call(this))}}})},delay:function(t,e,i,n){return this._delays.push({accumulator:0,callback:t,callbackOff:n,delay:e,repeat:(0>i?1/0:i)||0}),this},cancelDelay:function(t){for(var e=this._delays.length;--e>=0;){var i=this._delays[e];i&&i.callback==t&&(this._delays[e]=!1)}return this}})},{"./core.js":10}],30:[function(t,e){e.exports="0.6.3"},{}],31:[function(t){var e=t("./core.js"),i=window.document;e.extend({viewport:{clampToEntities:!0,_width:0,_height:0,_x:0,_y:0,_scale:1,bounds:null,scroll:function(t,i){this[t]=i,e.trigger("ViewportScroll"),e.trigger("InvalidateViewport")},rect_object:{_x:0,_y:0,_w:0,_h:0},rect:function(){return this.rect_object._x=-this._x,this.rect_object._y=-this._y,this.rect_object._w=this._width/this._scale,this.rect_object._h=this._height/this._scale,this.rect_object},pan:function(){function t(t){o.tick(t.dt);var u=o.value();e.viewport.x=(1-u)*s+u*n,e.viewport.y=(1-u)*a+u*r,e.viewport._clamp(),o.complete&&(i(),e.trigger("CameraAnimationDone"))}function i(){e.unbind("EnterFrame",t)}var n,r,s,a,o;return e.bind("StopCamera",i),function(i,u,c){e.trigger("StopCamera"),"reset"!=i&&(s=e.viewport._x,a=e.viewport._y,n=s-i,r=a-u,o=new e.easing(c),e.uniqueBind("EnterFrame",t))}}(),follow:function(){function t(){e.viewport.scroll("_x",-(this.x+this.w/2-e.viewport.width/2-r)),e.viewport.scroll("_y",-(this.y+this.h/2-e.viewport.height/2-s)),e.viewport._clamp()}function i(){n&&n.unbind("Move",t)}var n,r,s;return e.bind("StopCamera",i),function(i,a,o){i&&i.has("2D")&&(e.trigger("StopCamera"),n=i,r="undefined"!=typeof a?a:0,s="undefined"!=typeof o?o:0,i.bind("Move",t),t.call(i))}}(),centerOn:function(t,i){var n=t.x+e.viewport.x,r=t.y+e.viewport.y,s=t.w/2,a=t.h/2,o=e.viewport.width/2,u=e.viewport.height/2,c=n+s-o,h=r+a-u;e.viewport.pan(c,h,i)},zoom:function(){function t(){e.unbind("EnterFrame",i)}function i(i){var r,l;h.tick(i.dt),r=Math.pow(s,h.value()),l=1===s?h.value():(1/r-1)/(1/s-1),e.viewport.scale(r*n),e.viewport.scroll("_x",a*(1-l)+o*l),e.viewport.scroll("_y",u*(1-l)+c*l),e.viewport._clamp(),h.complete&&(t(),e.trigger("CameraAnimationDone"))}e.bind("StopCamera",t);var n,r,s,a,o,u,c,h;return function(t,l,d,f){return t?(arguments.length<=2&&(f=l,l=e.viewport.x-e.viewport.width,d=e.viewport.y-e.viewport.height),e.trigger("StopCamera"),n=e.viewport._scale,s=t,r=n*s,a=e.viewport.x,u=e.viewport.y,o=-(l-e.viewport.width/(2*r)),c=-(d-e.viewport.height/(2*r)),h=new e.easing(f),void e.uniqueBind("EnterFrame",i)):void e.viewport.scale(1)}}(),scale:function(){return function(t){this._scale=t?t:1,e.trigger("InvalidateViewport"),e.trigger("ViewportScale")}}(),mouselook:function(){var t=!1,i=!1,n={};return old={},function(r,s){if("boolean"==typeof r)return t=r,void(t?e.mouseObjs++:e.mouseObjs=Math.max(0,e.mouseObjs-1));if(t)switch(r){case"move":case"drag":if(!i)return;diff={x:s.clientX-n.x,y:s.clientY-n.y},n.x=s.clientX,n.y=s.clientY,e.viewport.x+=diff.x,e.viewport.y+=diff.y,e.viewport._clamp();break;case"start":e.trigger("StopCamera"),n.x=s.clientX,n.y=s.clientY,i=!0;break;case"stop":i=!1}}}(),_clamp:function(){if(this.clampToEntities){var t=this.bounds||e.map.boundaries();t.max.x*=this._scale,t.min.x*=this._scale,t.max.y*=this._scale,t.min.y*=this._scale,t.max.x-t.min.x>e.viewport.width?e.viewport.x<-t.max.x+e.viewport.width?e.viewport.x=-t.max.x+e.viewport.width:e.viewport.x>-t.min.x&&(e.viewport.x=-t.min.x):e.viewport.x=-1*(t.min.x+(t.max.x-t.min.x)/2-e.viewport.width/2),t.max.y-t.min.y>e.viewport.height?e.viewport.y<-t.max.y+e.viewport.height?e.viewport.y=-t.max.y+e.viewport.height:e.viewport.y>-t.min.y&&(e.viewport.y=-t.min.y):e.viewport.y=-1*(t.min.y+(t.max.y-t.min.y)/2-e.viewport.height/2)}},init:function(t,n,r){e.DOM.window.init(),this._defineViewportProperties(),this._width=t?t:e.DOM.window.width,this._height=n?n:e.DOM.window.height,"undefined"==typeof r&&(r="cr-stage");var s;if("string"==typeof r)s=i.getElementById(r);else{if(!("undefined"!=typeof HTMLElement?r instanceof HTMLElement:r instanceof Element))throw new TypeError("stage_elem must be a string or an HTMLElement");s=r}e.stage={x:0,y:0,fullscreen:!1,elem:s?s:i.createElement("div"),inner:i.createElement("div")},t||n||(i.body.style.overflow="hidden",e.stage.fullscreen=!0),e.addEvent(this,window,"resize",e.viewport.reload),e.addEvent(this,window,"blur",function(){e.settings.get("autoPause")&&(e._paused||e.pause())}),e.addEvent(this,window,"focus",function(){e._paused&&e.settings.get("autoPause")&&e.pause()}),e.settings.register("stageSelectable",function(t){e.stage.elem.onselectstart=t?function(){return!0}:function(){return!1}}),e.settings.modify("stageSelectable",!1),e.settings.register("stageContextMenu",function(t){e.stage.elem.oncontextmenu=t?function(){return!0}:function(){return!1}}),e.settings.modify("stageContextMenu",!1),e.settings.register("autoPause",function(){}),e.settings.modify("autoPause",!1),s||(i.body.appendChild(e.stage.elem),e.stage.elem.id=r);var a,o=e.stage.elem.style;if(e.stage.elem.appendChild(e.stage.inner),e.stage.inner.style.position="absolute",e.stage.inner.style.zIndex="1",e.stage.inner.style.transformStyle="preserve-3d",o.width=this.width+"px",o.height=this.height+"px",o.overflow="hidden",e.bind("ViewportResize",function(){e.trigger("InvalidateViewport")}),e.mobile){void 0!==typeof o.webkitTapHighlightColor&&(o.webkitTapHighlightColor="rgba(0,0,0,0)");var u=i.createElement("meta"),c=i.getElementsByTagName("head")[0];u=i.createElement("meta"),u.setAttribute("name","apple-mobile-web-app-capable"),u.setAttribute("content","yes"),c.appendChild(u),e.addEvent(this,e.stage.elem,"touchmove",function(t){t.preventDefault()})}else o.position="relative",a=e.DOM.inner(e.stage.elem),e.stage.x=a.x,e.stage.y=a.y},_defineViewportProperties:function(){Object.defineProperty(this,"x",{set:function(t){this.scroll("_x",t)},get:function(){return this._x},configurable:!0}),Object.defineProperty(this,"y",{set:function(t){this.scroll("_y",t)},get:function(){return this._y},configurable:!0}),Object.defineProperty(this,"width",{set:function(t){this._width=t,e.trigger("ViewportResize")},get:function(){return this._width},configurable:!0}),Object.defineProperty(this,"height",{set:function(t){this._height=t,e.trigger("ViewportResize")},get:function(){return this._height},configurable:!0})},reload:function(){e.DOM.window.init();var t,i=e.DOM.window.width,n=e.DOM.window.height;e.stage.fullscreen&&(this._width=i,this._height=n,e.trigger("ViewportResize")),t=e.DOM.inner(e.stage.elem),e.stage.x=t.x,e.stage.y=t.y},reset:function(){e.viewport.mouselook("stop"),e.trigger("StopCamera"),e.viewport.scale(1)}}})},{"./core.js":10}]},{},[11]),function(t){t.Parse=t.Parse||{},t.Parse.VERSION="js1.2.16"}(this),function(){var t=this,e=t._,i={},n=Array.prototype,r=Object.prototype,s=Function.prototype,a=n.push,o=n.slice,u=n.concat,c=r.toString,h=r.hasOwnProperty,l=n.forEach,d=n.map,f=n.reduce,p=n.reduceRight,_=n.filter,g=n.every,m=n.some,v=n.indexOf,y=n.lastIndexOf,b=Array.isArray,w=Object.keys,x=s.bind,A=function(t){return t instanceof A?t:this instanceof A?void(this._wrapped=t):new A(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=A),exports._=A):t._=A,A.VERSION="1.4.4";var C=A.each=A.forEach=function(t,e,n){if(null!=t)if(l&&t.forEach===l)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,s=t.length;s>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var a in t)if(A.has(t,a)&&e.call(n,t[a],a,t)===i)return};A.map=A.collect=function(t,e,i){var n=[];return null==t?n:d&&t.map===d?t.map(e,i):(C(t,function(t,r,s){n[n.length]=e.call(i,t,r,s)}),n)};var E="Reduce of empty array with no initial value";A.reduce=A.foldl=A.inject=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduce===f)return n&&(e=A.bind(e,n)),r?t.reduce(e,i):t.reduce(e);if(C(t,function(t,s,a){r?i=e.call(n,i,t,s,a):(i=t,r=!0)}),!r)throw new TypeError(E);return i},A.reduceRight=A.foldr=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),p&&t.reduceRight===p)return n&&(e=A.bind(e,n)),r?t.reduceRight(e,i):t.reduceRight(e);var s=t.length;if(s!==+s){var a=A.keys(t);s=a.length}if(C(t,function(o,u,c){u=a?a[--s]:--s,r?i=e.call(n,i,t[u],u,c):(i=t[u],r=!0)}),!r)throw new TypeError(E);return i},A.find=A.detect=function(t,e,i){var n;return O(t,function(t,r,s){return e.call(i,t,r,s)?(n=t,!0):void 0}),n},A.filter=A.select=function(t,e,i){var n=[];return null==t?n:_&&t.filter===_?t.filter(e,i):(C(t,function(t,r,s){e.call(i,t,r,s)&&(n[n.length]=t)}),n)},A.reject=function(t,e,i){return A.filter(t,function(t,n,r){return!e.call(i,t,n,r)},i)},A.every=A.all=function(t,e,n){e||(e=A.identity);var r=!0;return null==t?r:g&&t.every===g?t.every(e,n):(C(t,function(t,s,a){return(r=r&&e.call(n,t,s,a))?void 0:i}),!!r)};var O=A.some=A.any=function(t,e,n){e||(e=A.identity);var r=!1;return null==t?r:m&&t.some===m?t.some(e,n):(C(t,function(t,s,a){return r||(r=e.call(n,t,s,a))?i:void 0}),!!r)};A.contains=A.include=function(t,e){return null==t?!1:v&&t.indexOf===v?-1!=t.indexOf(e):O(t,function(t){return t===e})},A.invoke=function(t,e){var i=o.call(arguments,2),n=A.isFunction(e);return A.map(t,function(t){return(n?e:t[e]).apply(t,i)})},A.pluck=function(t,e){return A.map(t,function(t){return t[e]})},A.where=function(t,e,i){return A.isEmpty(e)?i?null:[]:A[i?"find":"filter"](t,function(t){for(var i in e)if(e[i]!==t[i])return!1;
return!0})},A.findWhere=function(t,e){return A.where(t,e,!0)},A.max=function(t,e,i){if(!e&&A.isArray(t)&&t[0]===+t[0]&&65535>t.length)return Math.max.apply(Math,t);if(!e&&A.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return C(t,function(t,r,s){var a=e?e.call(i,t,r,s):t;a>=n.computed&&(n={value:t,computed:a})}),n.value},A.min=function(t,e,i){if(!e&&A.isArray(t)&&t[0]===+t[0]&&65535>t.length)return Math.min.apply(Math,t);if(!e&&A.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return C(t,function(t,r,s){var a=e?e.call(i,t,r,s):t;n.computed>a&&(n={value:t,computed:a})}),n.value},A.shuffle=function(t){var e,i=0,n=[];return C(t,function(t){e=A.random(i++),n[i-1]=n[e],n[e]=t}),n};var S=function(t){return A.isFunction(t)?t:function(e){return e[t]}};A.sortBy=function(t,e,i){var n=S(e);return A.pluck(A.map(t,function(t,e,r){return{value:t,index:e,criteria:n.call(i,t,e,r)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index<e.index?-1:1}),"value")};var M=function(t,e,i,n){var r={},s=S(e||A.identity);return C(t,function(e,a){var o=s.call(i,e,a,t);n(r,o,e)}),r};A.groupBy=function(t,e,i){return M(t,e,i,function(t,e,i){(A.has(t,e)?t[e]:t[e]=[]).push(i)})},A.countBy=function(t,e,i){return M(t,e,i,function(t,e){A.has(t,e)||(t[e]=0),t[e]++})},A.sortedIndex=function(t,e,i,n){i=null==i?A.identity:S(i);for(var r=i.call(n,e),s=0,a=t.length;a>s;){var o=s+a>>>1;r>i.call(n,t[o])?s=o+1:a=o}return s},A.toArray=function(t){return t?A.isArray(t)?o.call(t):t.length===+t.length?A.map(t,A.identity):A.values(t):[]},A.size=function(t){return null==t?0:t.length===+t.length?t.length:A.keys(t).length},A.first=A.head=A.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:o.call(t,0,e)},A.initial=function(t,e,i){return o.call(t,0,t.length-(null==e||i?1:e))},A.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:o.call(t,Math.max(t.length-e,0))},A.rest=A.tail=A.drop=function(t,e,i){return o.call(t,null==e||i?1:e)},A.compact=function(t){return A.filter(t,A.identity)};var D=function(t,e,i){return C(t,function(t){A.isArray(t)?e?a.apply(i,t):D(t,e,i):i.push(t)}),i};A.flatten=function(t,e){return D(t,e,[])},A.without=function(t){return A.difference(t,o.call(arguments,1))},A.uniq=A.unique=function(t,e,i,n){A.isFunction(e)&&(n=i,i=e,e=!1);var r=i?A.map(t,i,n):t,s=[],a=[];return C(r,function(i,n){(e?n&&a[a.length-1]===i:A.contains(a,i))||(a.push(i),s.push(t[n]))}),s},A.union=function(){return A.uniq(u.apply(n,arguments))},A.intersection=function(t){var e=o.call(arguments,1);return A.filter(A.uniq(t),function(t){return A.every(e,function(e){return A.indexOf(e,t)>=0})})},A.difference=function(t){var e=u.apply(n,o.call(arguments,1));return A.filter(t,function(t){return!A.contains(e,t)})},A.zip=function(){for(var t=o.call(arguments),e=A.max(A.pluck(t,"length")),i=Array(e),n=0;e>n;n++)i[n]=A.pluck(t,""+n);return i},A.object=function(t,e){if(null==t)return{};for(var i={},n=0,r=t.length;r>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},A.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return n=A.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,r+i):i}if(v&&t.indexOf===v)return t.indexOf(e,i);for(;r>n;n++)if(t[n]===e)return n;return-1},A.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(y&&t.lastIndexOf===y)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var r=n?i:t.length;r--;)if(t[r]===e)return r;return-1},A.range=function(t,e,i){1>=arguments.length&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=0,s=Array(n);n>r;)s[r++]=t,t+=i;return s},A.bind=function(t,e){if(t.bind===x&&x)return x.apply(t,o.call(arguments,1));var i=o.call(arguments,2);return function(){return t.apply(e,i.concat(o.call(arguments)))}},A.partial=function(t){var e=o.call(arguments,1);return function(){return t.apply(this,e.concat(o.call(arguments)))}},A.bindAll=function(t){var e=o.call(arguments,1);return 0===e.length&&(e=A.functions(t)),C(e,function(e){t[e]=A.bind(t[e],t)}),t},A.memoize=function(t,e){var i={};return e||(e=A.identity),function(){var n=e.apply(this,arguments);return A.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},A.delay=function(t,e){var i=o.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},A.defer=function(t){return A.delay.apply(A,[t,1].concat(o.call(arguments,1)))},A.throttle=function(t,e){var i,n,r,s,a=0,o=function(){a=new Date,r=null,s=t.apply(i,n)};return function(){var u=new Date,c=e-(u-a);return i=this,n=arguments,0>=c?(clearTimeout(r),r=null,a=u,s=t.apply(i,n)):r||(r=setTimeout(o,c)),s}},A.debounce=function(t,e,i){var n,r;return function(){var s=this,a=arguments,o=function(){n=null,i||(r=t.apply(s,a))},u=i&&!n;return clearTimeout(n),n=setTimeout(o,e),u&&(r=t.apply(s,a)),r}},A.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},A.wrap=function(t,e){return function(){var i=[t];return a.apply(i,arguments),e.apply(this,i)}},A.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},A.after=function(t,e){return 0>=t?e():function(){return 1>--t?e.apply(this,arguments):void 0}},A.keys=w||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)A.has(t,i)&&(e[e.length]=i);return e},A.values=function(t){var e=[];for(var i in t)A.has(t,i)&&e.push(t[i]);return e},A.pairs=function(t){var e=[];for(var i in t)A.has(t,i)&&e.push([i,t[i]]);return e},A.invert=function(t){var e={};for(var i in t)A.has(t,i)&&(e[t[i]]=i);return e},A.functions=A.methods=function(t){var e=[];for(var i in t)A.isFunction(t[i])&&e.push(i);return e.sort()},A.extend=function(t){return C(o.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},A.pick=function(t){var e={},i=u.apply(n,o.call(arguments,1));return C(i,function(i){i in t&&(e[i]=t[i])}),e},A.omit=function(t){var e={},i=u.apply(n,o.call(arguments,1));for(var r in t)A.contains(i,r)||(e[r]=t[r]);return e},A.defaults=function(t){return C(o.call(arguments,1),function(e){if(e)for(var i in e)null==t[i]&&(t[i]=e[i])}),t},A.clone=function(t){return A.isObject(t)?A.isArray(t)?t.slice():A.extend({},t):t},A.tap=function(t,e){return e(t),t};var R=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof A&&(t=t._wrapped),e instanceof A&&(e=e._wrapped);var r=c.call(t);if(r!=c.call(e))return!1;switch(r){case"[object String]":return t==e+"";case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=i.length;s--;)if(i[s]==t)return n[s]==e;i.push(t),n.push(e);var a=0,o=!0;if("[object Array]"==r){if(a=t.length,o=a==e.length)for(;a--&&(o=R(t[a],e[a],i,n)););}else{var u=t.constructor,h=e.constructor;if(u!==h&&!(A.isFunction(u)&&u instanceof u&&A.isFunction(h)&&h instanceof h))return!1;for(var l in t)if(A.has(t,l)&&(a++,!(o=A.has(e,l)&&R(t[l],e[l],i,n))))break;if(o){for(l in e)if(A.has(e,l)&&!a--)break;o=!a}}return i.pop(),n.pop(),o};A.isEqual=function(t,e){return R(t,e,[],[])},A.isEmpty=function(t){if(null==t)return!0;if(A.isArray(t)||A.isString(t))return 0===t.length;for(var e in t)if(A.has(t,e))return!1;return!0},A.isElement=function(t){return!(!t||1!==t.nodeType)},A.isArray=b||function(t){return"[object Array]"==c.call(t)},A.isObject=function(t){return t===Object(t)},C(["Arguments","Function","String","Number","Date","RegExp"],function(t){A["is"+t]=function(e){return c.call(e)=="[object "+t+"]"}}),A.isArguments(arguments)||(A.isArguments=function(t){return!(!t||!A.has(t,"callee"))}),A.isFunction=function(t){return"function"==typeof t},A.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},A.isNaN=function(t){return A.isNumber(t)&&t!=+t},A.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==c.call(t)},A.isNull=function(t){return null===t},A.isUndefined=function(t){return void 0===t},A.has=function(t,e){return h.call(t,e)},A.noConflict=function(){return t._=e,this},A.identity=function(t){return t},A.times=function(t,e,i){for(var n=Array(t),r=0;t>r;r++)n[r]=e.call(i,r);return n},A.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var P={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};P.unescape=A.invert(P.escape);var k={escape:RegExp("["+A.keys(P.escape).join("")+"]","g"),unescape:RegExp("("+A.keys(P.unescape).join("|")+")","g")};A.each(["escape","unescape"],function(t){A[t]=function(e){return null==e?"":(""+e).replace(k[t],function(e){return P[t][e]})}}),A.result=function(t,e){if(null==t)return null;var i=t[e];return A.isFunction(i)?i.call(t):i},A.mixin=function(t){C(A.functions(t),function(e){var i=A[e]=t[e];A.prototype[e]=function(){var t=[this._wrapped];return a.apply(t,arguments),F.call(this,i.apply(A,t))}})};var j=0;A.uniqueId=function(t){var e=++j+"";return t?t+e:e},A.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},T=/\\|'|\r|\n|\t|\u2028|\u2029/g;A.template=function(t,e,i){var n;i=A.defaults({},i,A.templateSettings);var r=RegExp([(i.escape||N).source,(i.interpolate||N).source,(i.evaluate||N).source].join("|")+"|$","g"),s=0,a="__p+='";t.replace(r,function(e,i,n,r,o){return a+=t.slice(s,o).replace(T,function(t){return"\\"+I[t]}),i&&(a+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(a+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),r&&(a+="';\n"+r+"\n__p+='"),s=o+e.length,e}),a+="';\n",i.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=Function(i.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(e)return n(e,A);var u=function(t){return n.call(this,t,A)};return u.source="function("+(i.variable||"obj")+"){\n"+a+"}",u},A.chain=function(t){return A(t).chain()};var F=function(t){return this._chain?A(t).chain():t};A.mixin(A),C(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];A.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],F.call(this,i)}}),C(["concat","join","slice"],function(t){var e=n[t];A.prototype[t]=function(){return F.call(this,e.apply(this._wrapped,arguments))}}),A.extend(A.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(t){t.Parse=t.Parse||{};var e=t.Parse;"undefined"!=typeof exports&&exports._?(e._=exports._.noConflict(),e.localStorage=require("localStorage"),e.XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,exports.Parse=e):(e._=_.noConflict(),"undefined"!=typeof localStorage&&(e.localStorage=localStorage),"undefined"!=typeof XMLHttpRequest&&(e.XMLHttpRequest=XMLHttpRequest)),"undefined"!=typeof $&&(e.$=$);var i=function(){},n=function(t,n,r){var s;return s=n&&n.hasOwnProperty("constructor")?n.constructor:function(){t.apply(this,arguments)},e._.extend(s,t),i.prototype=t.prototype,s.prototype=new i,n&&e._.extend(s.prototype,n),r&&e._.extend(s,r),s.prototype.constructor=s,s.__super__=t.prototype,s};e.serverURL="https://api.parse.com","undefined"!=typeof process&&process.versions&&process.versions.node&&(e._isNode=!0),e.initialize=function(t,i,n){if(n)throw"Parse.initialize() was passed a Master Key, which is only allowed from within Node.js.";e._initialize(t,i)},e._initialize=function(t,i,n){e.applicationId=t,e.javaScriptKey=i,e.masterKey=n,e._useMasterKey=!1},e._isNode&&(e.initialize=e._initialize,e.Cloud=e.Cloud||{},e.Cloud.useMasterKey=function(){e._useMasterKey=!0}),e._getParsePath=function(t){if(!e.applicationId)throw"You need to call Parse.initialize before using Parse.";if(t||(t=""),!e._.isString(t))throw"Tried to get a localStorage path that wasn't a String.";return"/"===t[0]&&(t=t.substring(1)),"Parse/"+e.applicationId+"/"+t},e._installationId=null,e._getInstallationId=function(){if(e._installationId)return e._installationId;var t=e._getParsePath("installationId");if(e._installationId=e.localStorage.getItem(t),!e._installationId||""===e._installationId){var i=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};e._installationId=i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i(),e.localStorage.setItem(t,e._installationId)}return e._installationId},e._parseDate=function(t){var e=RegExp("^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$"),i=e.exec(t);if(!i)return null;var n=i[1]||0,r=(i[2]||1)-1,s=i[3]||0,a=i[4]||0,o=i[5]||0,u=i[6]||0,c=i[8]||0;return new Date(Date.UTC(n,r,s,a,o,u,c))},e._ajaxIE8=function(t,i,n){var r=new e.Promise,s=new XDomainRequest;return s.onload=function(){var t;try{t=JSON.parse(s.responseText)}catch(e){r.reject(e)}t&&r.resolve(t)},s.onerror=s.ontimeout=function(){var t={responseText:JSON.stringify({code:e.Error.X_DOMAIN_REQUEST,error:"IE's XDomainRequest does not supply error info."})};r.reject(t)},s.onprogress=function(){},s.open(t,i),s.send(n),r},e._useXDomainRequest=function(){return"undefined"!=typeof XDomainRequest?"withCredentials"in new XMLHttpRequest?!1:!0:!1},e._ajax=function(t,i,n,r,s){var a={success:r,error:s};if(e._useXDomainRequest())return e._ajaxIE8(t,i,n)._thenRunCallbacks(a);var o=new e.Promise,u=!1,c=new e.XMLHttpRequest;return c.onreadystatechange=function(){if(4===c.readyState){if(u)return;if(u=!0,c.status>=200&&300>c.status){var t;try{t=JSON.parse(c.responseText)}catch(e){o.reject(e)}t&&o.resolve(t,c.status,c)}else o.reject(c)}},c.open(t,i,!0),c.setRequestHeader("Content-Type","text/plain"),e._isNode&&c.setRequestHeader("User-Agent","Parse/"+e.VERSION+" (NodeJS "+process.versions.node+")"),c.send(n),o._thenRunCallbacks(a)},e._extend=function(t,e){var i=n(this,t,e);return i.extend=this.extend,i},e._request=function(t){var i=t.route,n=t.className,r=t.objectId,s=t.method,a=t.useMasterKey,o=t.sessionToken,u=t.data;if(!e.applicationId)throw"You must specify your applicationId using Parse.initialize.";if(!e.javaScriptKey&&!e.masterKey)throw"You must specify a key using Parse.initialize.";if(!o){var c=e.User.current();c&&c._sessionToken&&(o=c._sessionToken)}if("batch"!==i&&"classes"!==i&&"events"!==i&&"files"!==i&&"functions"!==i&&"login"!==i&&"push"!==i&&"requestPasswordReset"!==i&&"rest_verify_analytics"!==i&&"users"!==i&&"jobs"!==i)throw"Bad route: '"+i+"'.";var h=e.serverURL;"/"!==h.charAt(h.length-1)&&(h+="/"),h+="1/"+i,n&&(h+="/"+n),r&&(h+="/"+r),u=e._.clone(u||{}),"POST"!==s&&(u._method=s,s="POST"),e._.isUndefined(a)&&(a=e._useMasterKey),u._ApplicationId=e.applicationId,a?u._MasterKey=e.masterKey:u._JavaScriptKey=e.javaScriptKey,u._ClientVersion=e.VERSION,u._InstallationId=e._getInstallationId(),o&&(u._SessionToken=o);var l=JSON.stringify(u);return e._ajax(s,h,l).then(null,function(t){var i;if(t&&t.responseText)try{var n=JSON.parse(t.responseText);i=new e.Error(n.code,n.error)}catch(r){i=new e.Error(e.Error.INVALID_JSON,"Received an error with invalid JSON from Parse: "+t.responseText)}else i=new e.Error(e.Error.CONNECTION_FAILED,"XMLHttpRequest failed: "+JSON.stringify(t));return e.Promise.error(i)})},e._getValue=function(t,i){return t&&t[i]?e._.isFunction(t[i])?t[i]():t[i]:null},e._encode=function(t,i,n){var r=e._;if(t instanceof e.Object){if(n)throw"Parse.Objects not allowed here";if(!i||r.include(i,t)||!t._hasData)return t._toPointer();if(!t.dirty())return i=i.concat(t),e._encode(t._toFullJSON(i),i,n);throw"Tried to save an object with a pointer to a new, unsaved object."}if(t instanceof e.ACL)return t.toJSON();if(r.isDate(t))return{__type:"Date",iso:t.toJSON()};if(t instanceof e.GeoPoint)return t.toJSON();if(r.isArray(t))return r.map(t,function(t){return e._encode(t,i,n)});if(r.isRegExp(t))return t.source;if(t instanceof e.Relation)return t.toJSON();if(t instanceof e.Op)return t.toJSON();if(t instanceof e.File){if(!t.url())throw"Tried to save an object containing an unsaved file.";return{__type:"File",name:t.name(),url:t.url()}}if(r.isObject(t)){var s={};return e._objectEach(t,function(t,r){s[r]=e._encode(t,i,n)}),s}return t},e._decode=function(t,i){var n=e._;if(!n.isObject(i))return i;if(n.isArray(i))return e._arrayEach(i,function(t,n){i[n]=e._decode(n,t)}),i;if(i instanceof e.Object)return i;if(i instanceof e.File)return i;if(i instanceof e.Op)return i;if(i.__op)return e.Op._decode(i);if("Pointer"===i.__type){var r=e.Object._create(i.className);return r._finishFetch({objectId:i.objectId},!1),r}if("Object"===i.__type){var s=i.className;delete i.__type,delete i.className;var a=e.Object._create(s);return a._finishFetch(i,!0),a}if("Date"===i.__type)return e._parseDate(i.iso);if("GeoPoint"===i.__type)return new e.GeoPoint({latitude:i.latitude,longitude:i.longitude});if("ACL"===t)return i instanceof e.ACL?i:new e.ACL(i);if("Relation"===i.__type){var o=new e.Relation(null,t);return o.targetClassName=i.className,o}if("File"===i.__type){var u=new e.File(i.name);return u._url=i.url,u}return e._objectEach(i,function(t,n){i[n]=e._decode(n,t)}),i},e._arrayEach=e._.each,e._traverse=function(t,i,n){if(t instanceof e.Object){if(n=n||[],e._.indexOf(n,t)>=0)return;return n.push(t),e._traverse(t.attributes,i,n),i(t)}return t instanceof e.Relation||t instanceof e.File?i(t):e._.isArray(t)?(e._.each(t,function(r,s){var a=e._traverse(r,i,n);a&&(t[s]=a)}),i(t)):e._.isObject(t)?(e._each(t,function(r,s){var a=e._traverse(r,i,n);a&&(t[s]=a)}),i(t)):i(t)},e._objectEach=e._each=function(t,i){var n=e._;n.isObject(t)?n.each(n.keys(t),function(e){i(t[e],e)}):n.each(t,i)},e._isNullOrUndefined=function(t){return e._.isNull(t)||e._.isUndefined(t)}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Analytics=e.Analytics||{},i.extend(e.Analytics,{track:function(t,n){if(t=t||"",t=t.replace(/^\s*/,""),t=t.replace(/\s*$/,""),0===t.length)throw"A name for the custom event must be provided";return i.each(n,function(t,e){if(!i.isString(e)||!i.isString(t))throw'track() dimensions expects keys and values of type "string".'}),e._request({route:"events",className:t,method:"POST",data:{dimensions:n}})}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Error=function(t,e){this.code=t,this.message=e},i.extend(e.Error,{OTHER_CAUSE:-1,INTERNAL_SERVER_ERROR:1,CONNECTION_FAILED:100,OBJECT_NOT_FOUND:101,INVALID_QUERY:102,INVALID_CLASS_NAME:103,MISSING_OBJECT_ID:104,INVALID_KEY_NAME:105,INVALID_POINTER:106,INVALID_JSON:107,COMMAND_UNAVAILABLE:108,NOT_INITIALIZED:109,INCORRECT_TYPE:111,INVALID_CHANNEL_NAME:112,PUSH_MISCONFIGURED:115,OBJECT_TOO_LARGE:116,OPERATION_FORBIDDEN:119,CACHE_MISS:120,INVALID_NESTED_KEY:121,INVALID_FILE_NAME:122,INVALID_ACL:123,TIMEOUT:124,INVALID_EMAIL_ADDRESS:125,MISSING_CONTENT_TYPE:126,MISSING_CONTENT_LENGTH:127,INVALID_CONTENT_LENGTH:128,FILE_TOO_LARGE:129,FILE_SAVE_ERROR:130,FILE_DELETE_ERROR:153,DUPLICATE_VALUE:137,INVALID_ROLE_NAME:139,EXCEEDED_QUOTA:140,SCRIPT_FAILED:141,VALIDATION_ERROR:142,INVALID_IMAGE_DATA:150,UNSAVED_FILE_ERROR:151,INVALID_PUSH_TIME_ERROR:152,USERNAME_MISSING:200,PASSWORD_MISSING:201,USERNAME_TAKEN:202,EMAIL_TAKEN:203,EMAIL_MISSING:204,EMAIL_NOT_FOUND:205,SESSION_MISSING:206,MUST_CREATE_USER_THROUGH_SIGNUP:207,ACCOUNT_ALREADY_LINKED:208,LINKED_ID_MISSING:250,INVALID_LINKED_SESSION:251,UNSUPPORTED_SERVICE:252,AGGREGATE_ERROR:600,FILE_READ_ERROR:601,X_DOMAIN_REQUEST:602})}(this),function(){var t=this,e=t.Parse||(t.Parse={}),i=/\s+/,n=Array.prototype.slice;e.Events={on:function(t,e,n){var r,s,a,o,u;if(!e)return this;for(t=t.split(i),r=this._callbacks||(this._callbacks={}),s=t.shift();s;)u=r[s],a=u?u.tail:{},a.next=o={},a.context=n,a.callback=e,r[s]={tail:o,next:u?u.next:a},s=t.shift();return this},off:function(t,e,n){var r,s,a,o,u,c;if(s=this._callbacks){if(!(t||e||n))return delete this._callbacks,this;for(t=t?t.split(i):_.keys(s),r=t.shift();r;)if(a=s[r],delete s[r],a&&(e||n)){for(o=a.tail,a=a.next;a!==o;)u=a.callback,c=a.context,(e&&u!==e||n&&c!==n)&&this.on(r,u,c),a=a.next;r=t.shift()}return this}},trigger:function(t){var e,r,s,a,o,u,c;if(!(s=this._callbacks))return this;for(u=s.all,t=t.split(i),c=n.call(arguments,1),e=t.shift();e;){if(r=s[e])for(a=r.tail;(r=r.next)!==a;)r.callback.apply(r.context||this,c);if(r=u)for(a=r.tail,o=[e].concat(c);(r=r.next)!==a;)r.callback.apply(r.context||this,o);e=t.shift()}return this}},e.Events.bind=e.Events.on,e.Events.unbind=e.Events.off}.call(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.GeoPoint=function(t,n){i.isArray(t)?(e.GeoPoint._validate(t[0],t[1]),this.latitude=t[0],this.longitude=t[1]):i.isObject(t)?(e.GeoPoint._validate(t.latitude,t.longitude),this.latitude=t.latitude,this.longitude=t.longitude):i.isNumber(t)&&i.isNumber(n)?(e.GeoPoint._validate(t,n),this.latitude=t,this.longitude=n):(this.latitude=0,this.longitude=0);var r=this;this.__defineGetter__&&this.__defineSetter__&&(this._latitude=this.latitude,this._longitude=this.longitude,this.__defineGetter__("latitude",function(){return r._latitude}),this.__defineGetter__("longitude",function(){return r._longitude}),this.__defineSetter__("latitude",function(t){e.GeoPoint._validate(t,r.longitude),r._latitude=t}),this.__defineSetter__("longitude",function(t){e.GeoPoint._validate(r.latitude,t),r._longitude=t}))},e.GeoPoint._validate=function(t,e){if(-90>t)throw"Parse.GeoPoint latitude "+t+" < -90.0.";if(t>90)throw"Parse.GeoPoint latitude "+t+" > 90.0.";if(-180>e)throw"Parse.GeoPoint longitude "+e+" < -180.0.";if(e>180)throw"Parse.GeoPoint longitude "+e+" > 180.0."},e.GeoPoint.current=function(t){var i=new e.Promise;return navigator.geolocation.getCurrentPosition(function(t){i.resolve(new e.GeoPoint({latitude:t.coords.latitude,longitude:t.coords.longitude}))},function(t){i.reject(t)}),i._thenRunCallbacks(t)},e.GeoPoint.prototype={toJSON:function(){return e.GeoPoint._validate(this.latitude,this.longitude),{__type:"GeoPoint",latitude:this.latitude,longitude:this.longitude}},radiansTo:function(t){var e=Math.PI/180,i=this.latitude*e,n=this.longitude*e,r=t.latitude*e,s=t.longitude*e,a=i-r,o=n-s,u=Math.sin(a/2),c=Math.sin(o/2),h=u*u+Math.cos(i)*Math.cos(r)*c*c;return h=Math.min(1,h),2*Math.asin(Math.sqrt(h))},kilometersTo:function(t){return 6371*this.radiansTo(t)},milesTo:function(t){return 3958.8*this.radiansTo(t)}}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._,n="*";e.ACL=function(t){var n=this;if(n.permissionsById={},i.isObject(t))if(t instanceof e.User)n.setReadAccess(t,!0),n.setWriteAccess(t,!0);else{if(i.isFunction(t))throw"Parse.ACL() called with a function.  Did you forget ()?";e._objectEach(t,function(t,r){if(!i.isString(r))throw"Tried to create an ACL with an invalid userId.";n.permissionsById[r]={},e._objectEach(t,function(t,e){if("read"!==e&&"write"!==e)throw"Tried to create an ACL with an invalid permission type.";if(!i.isBoolean(t))throw"Tried to create an ACL with an invalid permission value.";n.permissionsById[r][e]=t})})}},e.ACL.prototype.toJSON=function(){return i.clone(this.permissionsById)},e.ACL.prototype._setAccess=function(t,n,r){if(n instanceof e.User?n=n.id:n instanceof e.Role&&(n="role:"+n.getName()),!i.isString(n))throw"userId must be a string.";if(!i.isBoolean(r))throw"allowed must be either true or false.";var s=this.permissionsById[n];if(!s){if(!r)return;s={},this.permissionsById[n]=s}r?this.permissionsById[n][t]=!0:(delete s[t],i.isEmpty(s)&&delete s[n])},e.ACL.prototype._getAccess=function(t,i){i instanceof e.User?i=i.id:i instanceof e.Role&&(i="role:"+i.getName());var n=this.permissionsById[i];return n&&n[t]?!0:!1},e.ACL.prototype.setReadAccess=function(t,e){this._setAccess("read",t,e)},e.ACL.prototype.getReadAccess=function(t){return this._getAccess("read",t)},e.ACL.prototype.setWriteAccess=function(t,e){this._setAccess("write",t,e)},e.ACL.prototype.getWriteAccess=function(t){return this._getAccess("write",t)},e.ACL.prototype.setPublicReadAccess=function(t){this.setReadAccess(n,t)},e.ACL.prototype.getPublicReadAccess=function(){return this.getReadAccess(n)},e.ACL.prototype.setPublicWriteAccess=function(t){this.setWriteAccess(n,t)},e.ACL.prototype.getPublicWriteAccess=function(){return this.getWriteAccess(n)},e.ACL.prototype.getRoleReadAccess=function(t){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return this.getReadAccess("role:"+t);throw"role must be a Parse.Role or a String"},e.ACL.prototype.getRoleWriteAccess=function(t){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return this.getWriteAccess("role:"+t);throw"role must be a Parse.Role or a String"},e.ACL.prototype.setRoleReadAccess=function(t,n){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return void this.setReadAccess("role:"+t,n);throw"role must be a Parse.Role or a String"},e.ACL.prototype.setRoleWriteAccess=function(t,n){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return void this.setWriteAccess("role:"+t,n);throw"role must be a Parse.Role or a String"}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Op=function(){this._initialize.apply(this,arguments)},e.Op.prototype={_initialize:function(){}},i.extend(e.Op,{_extend:e._extend,_opDecoderMap:{},_registerDecoder:function(t,i){e.Op._opDecoderMap[t]=i},_decode:function(t){var i=e.Op._opDecoderMap[t.__op];return i?i(t):void 0}}),e.Op._registerDecoder("Batch",function(t){var i=null;return e._arrayEach(t.ops,function(t){t=e.Op._decode(t),i=t._mergeWithPrevious(i)}),i}),e.Op.Set=e.Op._extend({_initialize:function(t){this._value=t},value:function(){return this._value},toJSON:function(){return e._encode(this.value())},_mergeWithPrevious:function(){return this},_estimate:function(){return this.value()}}),e.Op._UNSET={},e.Op.Unset=e.Op._extend({toJSON:function(){return{__op:"Delete"}},_mergeWithPrevious:function(){return this},_estimate:function(){return e.Op._UNSET}}),e.Op._registerDecoder("Delete",function(){return new e.Op.Unset}),e.Op.Increment=e.Op._extend({_initialize:function(t){this._amount=t},amount:function(){return this._amount},toJSON:function(){return{__op:"Increment",amount:this._amount}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return new e.Op.Set(this.amount());if(t instanceof e.Op.Set)return new e.Op.Set(t.value()+this.amount());if(t instanceof e.Op.Increment)return new e.Op.Increment(this.amount()+t.amount());throw"Op is invalid after previous op."}return this},_estimate:function(t){return t?t+this.amount():this.amount()}}),e.Op._registerDecoder("Increment",function(t){return new e.Op.Increment(t.amount)}),e.Op.Add=e.Op._extend({_initialize:function(t){this._objects=t},objects:function(){return this._objects},toJSON:function(){return{__op:"Add",objects:e._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return new e.Op.Set(this.objects());if(t instanceof e.Op.Set)return new e.Op.Set(this._estimate(t.value()));if(t instanceof e.Op.Add)return new e.Op.Add(t.objects().concat(this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){return t?t.concat(this.objects()):i.clone(this.objects())}}),e.Op._registerDecoder("Add",function(t){return new e.Op.Add(e._decode(void 0,t.objects))}),e.Op.AddUnique=e.Op._extend({_initialize:function(t){this._objects=i.uniq(t)},objects:function(){return this._objects},toJSON:function(){return{__op:"AddUnique",objects:e._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return new e.Op.Set(this.objects());if(t instanceof e.Op.Set)return new e.Op.Set(this._estimate(t.value()));if(t instanceof e.Op.AddUnique)return new e.Op.AddUnique(this._estimate(t.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){if(t){var n=i.clone(t);return e._arrayEach(this.objects(),function(t){if(t instanceof e.Object&&t.id){var r=i.find(n,function(i){return i instanceof e.Object&&i.id===t.id});if(r){var s=i.indexOf(n,r);n[s]=t}else n.push(t)}else i.contains(n,t)||n.push(t)}),n}return i.clone(this.objects())}}),e.Op._registerDecoder("AddUnique",function(t){return new e.Op.AddUnique(e._decode(void 0,t.objects))}),e.Op.Remove=e.Op._extend({_initialize:function(t){this._objects=i.uniq(t)},objects:function(){return this._objects},toJSON:function(){return{__op:"Remove",objects:e._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return t;if(t instanceof e.Op.Set)return new e.Op.Set(this._estimate(t.value()));if(t instanceof e.Op.Remove)return new e.Op.Remove(i.union(t.objects(),this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){if(t){var n=i.difference(t,this.objects());return e._arrayEach(this.objects(),function(t){t instanceof e.Object&&t.id&&(n=i.reject(n,function(i){return i instanceof e.Object&&i.id===t.id}))}),n}return[]}}),e.Op._registerDecoder("Remove",function(t){return new e.Op.Remove(e._decode(void 0,t.objects))}),e.Op.Relation=e.Op._extend({_initialize:function(t,n){this._targetClassName=null;var r=this,s=function(t){if(t instanceof e.Object){if(!t.id)throw"You can't add an unsaved Parse.Object to a relation.";if(r._targetClassName||(r._targetClassName=t.className),r._targetClassName!==t.className)throw"Tried to create a Parse.Relation with 2 different types: "+r._targetClassName+" and "+t.className+".";return t.id}return t};this.relationsToAdd=i.uniq(i.map(t,s)),this.relationsToRemove=i.uniq(i.map(n,s))},added:function(){var t=this;return i.map(this.relationsToAdd,function(i){var n=e.Object._create(t._targetClassName);return n.id=i,n})},removed:function(){var t=this;return i.map(this.relationsToRemove,function(i){var n=e.Object._create(t._targetClassName);return n.id=i,n})},toJSON:function(){var t=null,e=null,n=this,r=function(t){return{__type:"Pointer",className:n._targetClassName,objectId:t}},s=null;return this.relationsToAdd.length>0&&(s=i.map(this.relationsToAdd,r),t={__op:"AddRelation",objects:s}),this.relationsToRemove.length>0&&(s=i.map(this.relationsToRemove,r),e={__op:"RemoveRelation",objects:s}),t&&e?{__op:"Batch",ops:[t,e]}:t||e||{}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)throw"You can't modify a relation after deleting it.";if(t instanceof e.Op.Relation){if(t._targetClassName&&t._targetClassName!==this._targetClassName)throw"Related object must be of class "+t._targetClassName+", but "+this._targetClassName+" was passed in.";var n=i.union(i.difference(t.relationsToAdd,this.relationsToRemove),this.relationsToAdd),r=i.union(i.difference(t.relationsToRemove,this.relationsToAdd),this.relationsToRemove),s=new e.Op.Relation(n,r);return s._targetClassName=this._targetClassName,s}throw"Op is invalid after previous op."}return this},_estimate:function(t,i,n){if(t){if(t instanceof e.Relation){if(this._targetClassName)if(t.targetClassName){if(t.targetClassName!==this._targetClassName)throw"Related object must be a "+t.targetClassName+", but a "+this._targetClassName+" was passed in."}else t.targetClassName=this._targetClassName;return t}throw"Op is invalid after previous op."}var r=new e.Relation(i,n);r.targetClassName=this._targetClassName}}),e.Op._registerDecoder("AddRelation",function(t){return new e.Op.Relation(e._decode(void 0,t.objects),[])}),e.Op._registerDecoder("RemoveRelation",function(t){return new e.Op.Relation([],e._decode(void 0,t.objects))})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Relation=function(t,e){this.parent=t,this.key=e,this.targetClassName=null},e.Relation.prototype={_ensureParentAndKey:function(t,e){if(this.parent=this.parent||t,this.key=this.key||e,this.parent!==t)throw"Internal Error. Relation retrieved from two different Objects.";if(this.key!==e)throw"Internal Error. Relation retrieved from two different keys."},add:function(t){i.isArray(t)||(t=[t]);var n=new e.Op.Relation(t,[]);
this.parent.set(this.key,n),this.targetClassName=n._targetClassName},remove:function(t){i.isArray(t)||(t=[t]);var n=new e.Op.Relation([],t);this.parent.set(this.key,n),this.targetClassName=n._targetClassName},toJSON:function(){return{__type:"Relation",className:this.targetClassName}},query:function(){var t,i;return this.targetClassName?(t=e.Object._getSubclass(this.targetClassName),i=new e.Query(t)):(t=e.Object._getSubclass(this.parent.className),i=new e.Query(t),i._extraOptions.redirectClassNameForKey=this.key),i._addCondition("$relatedTo","object",this.parent._toPointer()),i._addCondition("$relatedTo","key",this.key),i}}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Promise=function(){this._resolved=!1,this._rejected=!1,this._resolvedCallbacks=[],this._rejectedCallbacks=[]},i.extend(e.Promise,{is:function(t){return t&&t.then&&i.isFunction(t.then)},as:function(){var t=new e.Promise;return t.resolve.apply(t,arguments),t},error:function(){var t=new e.Promise;return t.reject.apply(t,arguments),t},when:function(t){var i;i=t&&e._isNullOrUndefined(t.length)?arguments:t;var n=i.length,r=!1,s=[],a=[];if(s.length=i.length,a.length=i.length,0===n)return e.Promise.as.apply(this,s);var o=new e.Promise,u=function(){n-=1,0===n&&(r?o.reject(a):o.resolve.apply(o,s))};return e._arrayEach(i,function(t,i){e.Promise.is(t)?t.then(function(t){s[i]=t,u()},function(t){a[i]=t,r=!0,u()}):(s[i]=t,u())}),o},_continueWhile:function(t,i){return t()?i().then(function(){return e.Promise._continueWhile(t,i)}):e.Promise.as()}}),i.extend(e.Promise.prototype,{resolve:function(){if(this._resolved||this._rejected)throw"A promise was resolved even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._resolved=!0,this._result=arguments;var t=arguments;e._arrayEach(this._resolvedCallbacks,function(e){e.apply(this,t)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},reject:function(t){if(this._resolved||this._rejected)throw"A promise was rejected even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._rejected=!0,this._error=t,e._arrayEach(this._rejectedCallbacks,function(e){e(t)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},then:function(t,i){var n=new e.Promise,r=function(){var i=arguments;t&&(i=[t.apply(this,i)]),1===i.length&&e.Promise.is(i[0])?i[0].then(function(){n.resolve.apply(n,arguments)},function(t){n.reject(t)}):n.resolve.apply(n,i)},s=function(t){var r=[];i?(r=[i(t)],1===r.length&&e.Promise.is(r[0])?r[0].then(function(){n.resolve.apply(n,arguments)},function(t){n.reject(t)}):n.reject(r[0])):n.reject(t)};return this._resolved?r.apply(this,this._result):this._rejected?s(this._error):(this._resolvedCallbacks.push(r),this._rejectedCallbacks.push(s)),n},always:function(t){return this.then(t,t)},done:function(t){return this.then(t)},fail:function(t){return this.then(null,t)},_thenRunCallbacks:function(t,n){var r;if(i.isFunction(t)){var s=t;r={success:function(t){s(t,null)},error:function(t){s(null,t)}}}else r=i.clone(t);return r=r||{},this.then(function(t){return r.success?r.success.apply(this,arguments):n&&n.trigger("sync",n,t,r),e.Promise.as.apply(e.Promise,arguments)},function(t){return r.error?i.isUndefined(n)?r.error(t):r.error(n,t):n&&n.trigger("error",n,t,r),e.Promise.error(t)})},_continueWith:function(t){return this.then(function(){return t(arguments,null)},function(e){return t(null,e)})}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._,n=function(t){if(26>t)return String.fromCharCode(65+t);if(52>t)return String.fromCharCode(97+(t-26));if(62>t)return String.fromCharCode(48+(t-52));if(62===t)return"+";if(63===t)return"/";throw"Tried to encode large digit "+t+" in base64."},r=function(t){var e=[];return e.length=Math.ceil(t.length/3),i.times(e.length,function(i){var r=t[3*i],s=t[3*i+1]||0,a=t[3*i+2]||0,o=t.length>3*i+1,u=t.length>3*i+2;e[i]=[n(63&r>>2),n(48&r<<4|15&s>>4),o?n(60&s<<2|3&a>>6):"=",u?n(63&a):"="].join("")}),e.join("")},s={ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",asc:"text/plain",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",cdf:"application/x-netcdf",cgm:"image/cgm","class":"application/octet-stream",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",dcr:"application/x-director",dif:"video/x-dv",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",docm:"application/vnd.ms-word.document.macroEnabled.12",dotm:"application/vnd.ms-word.template.macroEnabled.12",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",dxr:"application/x-director",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",ez:"application/andrew-inset",gif:"image/gif",gram:"application/srgs",grxml:"application/srgs+xml",gtar:"application/x-gtar",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htm:"text/html",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/x-javascript",kar:"audio/midi",latex:"application/x-latex",lha:"application/octet-stream",lzh:"application/octet-stream",m3u:"audio/x-mpegurl",m4a:"audio/mp4a-latm",m4b:"audio/mp4a-latm",m4p:"audio/mp4a-latm",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mac:"image/x-macpaint",man:"application/x-troff-man",mathml:"application/mathml+xml",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/vnd.mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",ms:"application/x-troff-ms",msh:"model/mesh",mxu:"video/vnd.mpegurl",nc:"application/x-netcdf",oda:"application/oda",ogg:"application/ogg",pbm:"image/x-portable-bitmap",pct:"image/pict",pdb:"chemical/x-pdb",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pic:"image/pict",pict:"image/pict",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",pntg:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ps:"application/postscript",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"application/x-troff",rtf:"text/rtf",rtx:"text/richtext",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",smi:"application/smil",smil:"application/smil",snd:"audio/basic",so:"application/octet-stream",spl:"application/x-futuresplash",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",swf:"application/x-shockwave-flash",t:"application/x-troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",tsv:"text/tab-separated-values",txt:"text/plain",ustar:"application/x-ustar",vcd:"application/x-cdlink",vrml:"model/vrml",vxml:"application/voicexml+xml",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wbmxl:"application/vnd.wap.wbxml",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wrl:"model/vrml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",zip:"application/zip"},a=function(t,i){var n=new e.Promise;if("undefined"==typeof FileReader)return e.Promise.error(new e.Error(e.Error.FILE_READ_ERROR,"Attempted to use a FileReader on an unsupported browser."));var r=new FileReader;return r.onloadend=function(){if(2!==r.readyState)return void n.reject(new e.Error(e.Error.FILE_READ_ERROR,"Error reading file."));var t=r.result,s=/^data:([^;]*);base64,(.*)$/.exec(t);return s?void n.resolve(s[2],i||s[1]):void n.reject(new e.Error(e.ERROR.FILE_READ_ERROR,"Unable to interpret data URL: "+t))},r.readAsDataURL(t),n};e.File=function(t,n,o){this._name=t;var u=/\.([^.]*)$/.exec(t);u&&(u=u[1].toLowerCase());var c=o||s[u]||"text/plain";if(i.isArray(n))this._source=e.Promise.as(r(n),c);else if(n&&n.base64){var h=/^data:([a-zA-Z]*\/[a-zA-Z+.-]*);(charset=[a-zA-Z0-9\-\/\s]*,)?base64,(\S+)/,l=h.exec(n.base64);this._source=l&&l.length>0?e.Promise.as(4===l.length?l[3]:l[2],l[1]):e.Promise.as(n.base64,c)}else if("undefined"!=typeof File&&n instanceof File)this._source=a(n,o);else if(i.isString(n))throw"Creating a Parse.File from a String is not yet supported."},e.File.prototype={name:function(){return this._name},url:function(){return this._url},save:function(t){t=t||{};var i=this;return i._previousSave||(i._previousSave=i._source.then(function(n,r){var s={base64:n,_ContentType:r};return e._request({route:"files",className:i._name,method:"POST",data:s,useMasterKey:t.useMasterKey})}).then(function(t){return i._name=t.name,i._url=t.url,i})),i._previousSave._thenRunCallbacks(t)}}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Object=function(t,n){if(i.isString(t))return e.Object._create.apply(this,arguments);t=t||{},n&&n.parse&&(t=this.parse(t));var r=e._getValue(this,"defaults");if(r&&(t=i.extend({},r,t)),n&&n.collection&&(this.collection=n.collection),this._serverData={},this._opSetQueue=[{}],this.attributes={},this._hashedJSON={},this._escapedAttributes={},this.cid=i.uniqueId("c"),this.changed={},this._silent={},this._pending={},!this.set(t,{silent:!0}))throw Error("Can't create an invalid Parse.Object");this.changed={},this._silent={},this._pending={},this._hasData=!0,this._previousAttributes=i.clone(this.attributes),this.initialize.apply(this,arguments)},e.Object.saveAll=function(t,i){return i=i||{},e.Object._deepSaveAsync(t,{useMasterKey:i.useMasterKey})._thenRunCallbacks(i)},e.Object.destroyAll=function(t,n){n=n||{};var r=function(t){t.trigger("destroy",t,t.collection,n)},s=[],a=function(t){var a=e.Promise.as();return t.length>0&&(a=a.then(function(){return e._request({route:"batch",method:"POST",useMasterKey:n.useMasterKey,data:{requests:i.map(t,function(t){return{method:"DELETE",path:"/1/classes/"+t.className+"/"+t.id}})}})}).then(function(i){e._arrayEach(t,function(t,a){if(i[a].success&&n.wait)r(t);else if(i[a].error){var o=new e.Error(i[a].error.code,i[a].error.error);o.object=t,s.push(o)}})})),a},o=e.Promise.as(),u=[];return e._arrayEach(t,function(e,i){if(e.id&&n.wait||r(e),e.id&&u.push(e),20===u.length||i+1===t.length){var s=u;u=[],o=o.then(function(){return a(s)})}}),o.then(function(){if(0===s.length)return!0;var t=new e.Error(e.Error.AGGREGATE_ERROR,"Error deleting an object in destroyAll");return t.errors=s,e.Promise.error(t)})._thenRunCallbacks(n)},i.extend(e.Object.prototype,e.Events,{_existed:!1,initialize:function(){},toJSON:function(){var t=this._toFullJSON();return e._arrayEach(["__type","className"],function(e){delete t[e]}),t},_toFullJSON:function(t){var n=i.clone(this.attributes);return e._objectEach(n,function(i,r){n[r]=e._encode(i,t)}),e._objectEach(this._operations,function(t,e){n[e]=t}),i.has(this,"id")&&(n.objectId=this.id),i.has(this,"createdAt")&&(n.createdAt=i.isDate(this.createdAt)?this.createdAt.toJSON():this.createdAt),i.has(this,"updatedAt")&&(n.updatedAt=i.isDate(this.updatedAt)?this.updatedAt.toJSON():this.updatedAt),n.__type="Object",n.className=this.className,n},_refreshCache:function(){var t=this;t._refreshingCache||(t._refreshingCache=!0,e._objectEach(this.attributes,function(n,r){n instanceof e.Object?n._refreshCache():i.isObject(n)&&t._resetCacheForKey(r)&&t.set(r,new e.Op.Set(n),{silent:!0})}),delete t._refreshingCache)},dirty:function(t){this._refreshCache();var e=i.last(this._opSetQueue);return t?e[t]?!0:!1:this.id?i.keys(e).length>0?!0:!1:!0},dirtyKeys:function(){return i.keys(i.last(this._opSetQueue))},_toPointer:function(){if(!this.id)throw Error("Can't serialize an unsaved Parse.Object");return{__type:"Pointer",className:this.className,objectId:this.id}},get:function(t){return this.attributes[t]},relation:function(t){var i=this.get(t);if(i){if(!(i instanceof e.Relation))throw"Called relation() on non-relation field "+t;return i._ensureParentAndKey(this,t),i}return new e.Relation(this,t)},escape:function(t){var n=this._escapedAttributes[t];if(n)return n;var r,s=this.attributes[t];return r=e._isNullOrUndefined(s)?"":i.escape(""+s),this._escapedAttributes[t]=r,r},has:function(t){return!e._isNullOrUndefined(this.attributes[t])},_mergeMagicFields:function(t){var n=this,r=["id","objectId","createdAt","updatedAt"];e._arrayEach(r,function(r){t[r]&&("objectId"===r?n.id=t[r]:n[r]="createdAt"!==r&&"updatedAt"!==r||i.isDate(t[r])?t[r]:e._parseDate(t[r]),delete t[r])})},_startSave:function(){this._opSetQueue.push({})},_cancelSave:function(){var t=i.first(this._opSetQueue);this._opSetQueue=i.rest(this._opSetQueue);var n=i.first(this._opSetQueue);e._objectEach(t,function(e,i){var r=t[i],s=n[i];r&&s?n[i]=s._mergeWithPrevious(r):r&&(n[i]=r)}),this._saving=this._saving-1},_finishSave:function(t){var n={};e._traverse(this.attributes,function(t){t instanceof e.Object&&t.id&&t._hasData&&(n[t.id]=t)});var r=i.first(this._opSetQueue);this._opSetQueue=i.rest(this._opSetQueue),this._applyOpSet(r,this._serverData),this._mergeMagicFields(t);var s=this;e._objectEach(t,function(t,i){s._serverData[i]=e._decode(i,t);var r=e._traverse(s._serverData[i],function(t){return t instanceof e.Object&&n[t.id]?n[t.id]:void 0});r&&(s._serverData[i]=r)}),this._rebuildAllEstimatedData(),this._saving=this._saving-1},_finishFetch:function(t,i){this._opSetQueue=[{}],this._mergeMagicFields(t);var n=this,r={};e._objectEach(t,function(t,i){r[i]=e._decode(i,t)}),n._serverData=r,this._rebuildAllEstimatedData(),this._refreshCache(),this._opSetQueue=[{}],this._hasData=i},_applyOpSet:function(t,i){var n=this;e._objectEach(t,function(t,r){i[r]=t._estimate(i[r],n,r),i[r]===e.Op._UNSET&&delete i[r]})},_resetCacheForKey:function(t){var n=this.attributes[t];if(!(!i.isObject(n)||n instanceof e.Object||n instanceof e.File)){n=n.toJSON?n.toJSON():n;var r=JSON.stringify(n);if(this._hashedJSON[t]!==r)return this._hashedJSON[t]=r,!0}return!1},_rebuildEstimatedDataForKey:function(t){var i=this;delete this.attributes[t],this._serverData[t]&&(this.attributes[t]=this._serverData[t]),e._arrayEach(this._opSetQueue,function(n){var r=n[t];r&&(i.attributes[t]=r._estimate(i.attributes[t],i,t),i.attributes[t]===e.Op._UNSET?delete i.attributes[t]:i._resetCacheForKey(t))})},_rebuildAllEstimatedData:function(){var t=this,n=i.clone(this.attributes);this.attributes=i.clone(this._serverData),e._arrayEach(this._opSetQueue,function(i){t._applyOpSet(i,t.attributes),e._objectEach(i,function(e,i){t._resetCacheForKey(i)})}),e._objectEach(n,function(e,i){t.attributes[i]!==e&&t.trigger("change:"+i,t,t.attributes[i],{})}),e._objectEach(this.attributes,function(e,r){i.has(n,r)||t.trigger("change:"+r,t,e,{})})},set:function(t,n,r){var s;if(i.isObject(t)||e._isNullOrUndefined(t)?(s=t,e._objectEach(s,function(t,i){s[i]=e._decode(i,t)}),r=n):(s={},s[t]=e._decode(t,n)),r=r||{},!s)return this;s instanceof e.Object&&(s=s.attributes),r.unset&&e._objectEach(s,function(t,i){s[i]=new e.Op.Unset});var a=i.clone(s),o=this;if(e._objectEach(a,function(t,i){t instanceof e.Op&&(a[i]=t._estimate(o.attributes[i],o,i),a[i]===e.Op._UNSET&&delete a[i])}),!this._validate(s,r))return!1;this._mergeMagicFields(s),r.changes={};var u=this._escapedAttributes;return this._previousAttributes||{},e._arrayEach(i.keys(s),function(t){var n=s[t];n instanceof e.Relation&&(n.parent=o),n instanceof e.Op||(n=new e.Op.Set(n));var a=!0;n instanceof e.Op.Set&&i.isEqual(o.attributes[t],n.value)&&(a=!1),a&&(delete u[t],r.silent?o._silent[t]=!0:r.changes[t]=!0);var c=i.last(o._opSetQueue);c[t]=n._mergeWithPrevious(c[t]),o._rebuildEstimatedDataForKey(t),a?(o.changed[t]=o.attributes[t],r.silent||(o._pending[t]=!0)):(delete o.changed[t],delete o._pending[t])}),r.silent||this.change(r),this},unset:function(t,e){return e=e||{},e.unset=!0,this.set(t,null,e)},increment:function(t,n){return(i.isUndefined(n)||i.isNull(n))&&(n=1),this.set(t,new e.Op.Increment(n))},add:function(t,i){return this.set(t,new e.Op.Add([i]))},addUnique:function(t,i){return this.set(t,new e.Op.AddUnique([i]))},remove:function(t,i){return this.set(t,new e.Op.Remove([i]))},op:function(t){return i.last(this._opSetQueue)[t]},clear:function(t){t=t||{},t.unset=!0;var e=i.extend(this.attributes,this._operations);return this.set(e,t)},_getSaveJSON:function(){var t=i.clone(i.first(this._opSetQueue));return e._objectEach(t,function(e,i){t[i]=e.toJSON()}),t},_canBeSerialized:function(){return e.Object._canBeSerializedAsValue(this.attributes)},fetch:function(t){var i=this;t=t||{};var n=e._request({method:"GET",route:"classes",className:this.className,objectId:this.id,useMasterKey:t.useMasterKey});return n.then(function(t,e,n){return i._finishFetch(i.parse(t,e,n),!0),i})._thenRunCallbacks(t,this)},save:function(t,n,r){var s,a,o;if(i.isObject(t)||e._isNullOrUndefined(t)?(s=t,o=n):(s={},s[t]=n,o=r),!o&&s){var u=i.reject(s,function(t,e){return i.include(["success","error","wait"],e)});if(0===u.length){var c=!0;if(i.has(s,"success")&&!i.isFunction(s.success)&&(c=!1),i.has(s,"error")&&!i.isFunction(s.error)&&(c=!1),c)return this.save(null,s)}}o=i.clone(o)||{},o.wait&&(a=i.clone(this.attributes));var h=i.clone(o)||{};h.wait&&(h.silent=!0);var l;if(h.error=function(t,e){l=e},s&&!this.set(s,h))return e.Promise.error(l)._thenRunCallbacks(o,this);var d=this;d._refreshCache();var f=[],p=[];return e.Object._findUnsavedChildren(d.attributes,f,p),f.length+p.length>0?e.Object._deepSaveAsync(this.attributes,{useMasterKey:o.useMasterKey}).then(function(){return d.save(null,o)},function(t){return e.Promise.error(t)._thenRunCallbacks(o,d)}):(this._startSave(),this._saving=(this._saving||0)+1,this._allPreviousSaves=this._allPreviousSaves||e.Promise.as(),this._allPreviousSaves=this._allPreviousSaves._continueWith(function(){var t=d.id?"PUT":"POST",n=d._getSaveJSON(),r="classes",u=d.className;"_User"!==d.className||d.id||(r="users",u=null);var c=e._request({route:r,className:u,objectId:d.id,method:t,useMasterKey:o.useMasterKey,data:n});return c=c.then(function(t,e,n){var r=d.parse(t,e,n);return o.wait&&(r=i.extend(s||{},r)),d._finishSave(r),o.wait&&d.set(a,h),d},function(t){return d._cancelSave(),e.Promise.error(t)})._thenRunCallbacks(o,d)}),this._allPreviousSaves)},destroy:function(t){t=t||{};var i=this,n=function(){i.trigger("destroy",i,i.collection,t)};if(!this.id)return n();t.wait||n();var r=e._request({route:"classes",className:this.className,objectId:this.id,method:"DELETE",useMasterKey:t.useMasterKey});return r.then(function(){return t.wait&&n(),i})._thenRunCallbacks(t,this)},parse:function(t,n){var r=i.clone(t);return i(["createdAt","updatedAt"]).each(function(t){r[t]&&(r[t]=e._parseDate(r[t]))}),r.updatedAt||(r.updatedAt=r.createdAt),n&&(this._existed=201!==n),r},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.id},change:function(t){t=t||{};var n=this._changing;this._changing=!0;var r=this;e._objectEach(this._silent,function(t){r._pending[t]=!0});var s=i.extend({},t.changes,this._silent);if(this._silent={},e._objectEach(s,function(e,i){r.trigger("change:"+i,r,r.get(i),t)}),n)return this;for(var a=function(t,e){r._pending[e]||r._silent[e]||delete r.changed[e]};!i.isEmpty(this._pending);)this._pending={},this.trigger("change",this,t),e._objectEach(this.changed,a),r._previousAttributes=i.clone(this.attributes);return this._changing=!1,this},existed:function(){return this._existed},hasChanged:function(t){return arguments.length?this.changed&&i.has(this.changed,t):!i.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?i.clone(this.changed):!1;var n={},r=this._previousAttributes;return e._objectEach(t,function(t,e){i.isEqual(r[e],t)||(n[e]=t)}),n},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},validate:function(t){if(i.has(t,"ACL")&&!(t.ACL instanceof e.ACL))return new e.Error(e.Error.OTHER_CAUSE,"ACL must be a Parse.ACL.");var n=!0;return e._objectEach(t,function(t,e){/^[A-Za-z][0-9A-Za-z_]*$/.test(e)||(n=!1)}),n?!1:new e.Error(e.Error.INVALID_KEY_NAME)},_validate:function(t,e){if(e.silent||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validate(t,e);return n?(e&&e.error?e.error(this,n,e):this.trigger("error",this,n,e),!1):!0},getACL:function(){return this.get("ACL")},setACL:function(t,e){return this.set("ACL",t,e)}}),e.Object._getSubclass=function(t){if(!i.isString(t))throw"Parse.Object._getSubclass requires a string argument.";var n=e.Object._classMap[t];return n||(n=e.Object.extend(t),e.Object._classMap[t]=n),n},e.Object._create=function(t,i,n){var r=e.Object._getSubclass(t);return new r(i,n)},e.Object._classMap={},e.Object._extend=e._extend,e.Object.extend=function(t,n,r){if(!i.isString(t)){if(t&&i.has(t,"className"))return e.Object.extend(t.className,t,n);throw Error("Parse.Object.extend's first argument should be the className.")}"User"===t&&e.User._performUserRewrite&&(t="_User"),n=n||{},n.className=t;var s=null;if(i.has(e.Object._classMap,t)){var a=e.Object._classMap[t];s=a._extend(n,r)}else s=this._extend(n,r);return s.extend=function(n){if(i.isString(n)||n&&i.has(n,"className"))return e.Object.extend.apply(s,arguments);var r=[t].concat(e._.toArray(arguments));return e.Object.extend.apply(s,r)},e.Object._classMap[t]=s,s},e.Object._findUnsavedChildren=function(t,i,n){e._traverse(t,function(t){return t instanceof e.Object?(t._refreshCache(),void(t.dirty()&&i.push(t))):t instanceof e.File?void(t.url()||n.push(t)):void 0})},e.Object._canBeSerializedAsValue=function(t){if(t instanceof e.Object)return!!t.id;if(t instanceof e.File)return!0;var n=!0;return i.isArray(t)?e._arrayEach(t,function(t){e.Object._canBeSerializedAsValue(t)||(n=!1)}):i.isObject(t)&&e._objectEach(t,function(t){e.Object._canBeSerializedAsValue(t)||(n=!1)}),n},e.Object._deepSaveAsync=function(t,n){var r=[],s=[];e.Object._findUnsavedChildren(t,r,s);var a=e.Promise.as();i.each(s,function(t){a=a.then(function(){return t.save(n)})});var o=i.uniq(r),u=i.uniq(o);return a.then(function(){return e.Promise._continueWhile(function(){return u.length>0},function(){var t=[],r=[];if(e._arrayEach(u,function(e){return t.length>20?void r.push(e):void(e._canBeSerialized()?t.push(e):r.push(e))}),u=r,0===t.length)return e.Promise.error(new e.Error(e.Error.OTHER_CAUSE,"Tried to save a batch with a cycle."));var s=e.Promise.when(i.map(t,function(t){return t._allPreviousSaves||e.Promise.as()})),a=new e.Promise;return e._arrayEach(t,function(t){t._allPreviousSaves=a}),s._continueWith(function(){return e._request({route:"batch",method:"POST",useMasterKey:n.useMasterKey,data:{requests:i.map(t,function(t){var e=t._getSaveJSON(),i="POST",n="/1/classes/"+t.className;return t.id&&(n=n+"/"+t.id,i="PUT"),t._startSave(),{method:i,path:n,body:e}})}}).then(function(i,n,r){var s;return e._arrayEach(t,function(t,e){i[e].success?t._finishSave(t.parse(i[e].success,n,r)):(s=s||i[e].error,t._cancelSave())}),s?e.Promise.error(new e.Error(s.code,s.error)):void 0}).then(function(t){return a.resolve(t),t},function(t){return a.reject(t),e.Promise.error(t)})})})}).then(function(){return t})}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Role=e.Object.extend("_Role",{constructor:function(t,n){i.isString(t)&&n instanceof e.ACL?(e.Object.prototype.constructor.call(this,null,null),this.setName(t),this.setACL(n)):e.Object.prototype.constructor.call(this,t,n)},getName:function(){return this.get("name")},setName:function(t,e){return this.set("name",t,e)},getUsers:function(){return this.relation("users")},getRoles:function(){return this.relation("roles")},validate:function(t,n){if("name"in t&&t.name!==this.getName()){var r=t.name;if(this.id&&this.id!==t.objectId)return new e.Error(e.Error.OTHER_CAUSE,"A role's name can only be set before it has been saved.");if(!i.isString(r))return new e.Error(e.Error.OTHER_CAUSE,"A role's name must be a String.");if(!/^[0-9a-zA-Z\-_ ]+$/.test(r))return new e.Error(e.Error.OTHER_CAUSE,"A role's name can only contain alphanumeric characters, _, -, and spaces.")}return e.Object.prototype.validate?e.Object.prototype.validate.call(this,t,n):!1}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Collection=function(t,e){e=e||{},e.comparator&&(this.comparator=e.comparator),e.model&&(this.model=e.model),e.query&&(this.query=e.query),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})},i.extend(e.Collection.prototype,e.Events,{model:e.Object,initialize:function(){},toJSON:function(){return this.map(function(t){return t.toJSON()})},add:function(t,n){var r,s,a,o,u,c,h={},l={};for(n=n||{},t=i.isArray(t)?t.slice():[t],r=0,a=t.length;a>r;r++){if(t[r]=this._prepareModel(t[r],n),o=t[r],!o)throw Error("Can't add an invalid model to a collection");if(u=o.cid,h[u]||this._byCid[u])throw Error("Duplicate cid: can't add the same model to a collection twice");if(c=o.id,!e._isNullOrUndefined(c)&&(l[c]||this._byId[c]))throw Error("Duplicate id: can't add the same model to a collection twice");l[c]=o,h[u]=o}for(r=0;a>r;r++)(o=t[r]).on("all",this._onModelEvent,this),this._byCid[o.cid]=o,o.id&&(this._byId[o.id]=o);if(this.length+=a,s=e._isNullOrUndefined(n.at)?this.models.length:n.at,this.models.splice.apply(this.models,[s,0].concat(t)),this.comparator&&this.sort({silent:!0}),n.silent)return this;for(r=0,a=this.models.length;a>r;r++)o=this.models[r],h[o.cid]&&(n.index=r,o.trigger("add",o,this,n));return this},remove:function(t,e){var n,r,s,a;for(e=e||{},t=i.isArray(t)?t.slice():[t],n=0,r=t.length;r>n;n++)a=this.getByCid(t[n])||this.get(t[n]),a&&(delete this._byId[a.id],delete this._byCid[a.cid],s=this.indexOf(a),this.models.splice(s,1),this.length--,e.silent||(e.index=s,a.trigger("remove",a,this,e)),this._removeReference(a));return this},get:function(t){return t&&this._byId[t.id||t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},sort:function(t){if(t=t||{},!this.comparator)throw Error("Cannot sort a set without a comparator");var e=i.bind(this.comparator,this);return 1===this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return i.map(this.models,function(e){return e.get(t)})},reset:function(t,i){var n=this;return t=t||[],i=i||{},e._arrayEach(this.models,function(t){n._removeReference(t)}),this._reset(),this.add(t,{silent:!0,parse:i.parse}),i.silent||this.trigger("reset",this,i),this},fetch:function(t){t=i.clone(t)||{},void 0===t.parse&&(t.parse=!0);var n=this,r=this.query||new e.Query(this.model);return r.find({useMasterKey:t.useMasterKey}).then(function(e){return t.add?n.add(e,t):n.reset(e,t),n})._thenRunCallbacks(t,this)},create:function(t,e){var n=this;if(e=e?i.clone(e):{},t=this._prepareModel(t,e),!t)return!1;e.wait||n.add(t,e);var r=e.success;return e.success=function(i,s){e.wait&&n.add(i,e),r?r(i,s):i.trigger("sync",t,s,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return i(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,i){if(t instanceof e.Object)t.collection||(t.collection=this);else{var n=t;i.collection=this,t=new this.model(n,i),t._validate(t.attributes,i)||(t=!1)}return t},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&"change:objectId"===t&&(delete this._byId[e.previous("objectId")],this._byId[e.id]=e),this.trigger.apply(this,arguments))}});var n=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];e._arrayEach(n,function(t){e.Collection.prototype[t]=function(){return i[t].apply(i,[this.models].concat(i.toArray(arguments)))}}),e.Collection.extend=e._extend}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.View=function(t){this.cid=i.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()};var n=/^(\S+)\s*(.*)$/,r=["model","collection","el","id","attributes","className","tagName"];i.extend(e.View.prototype,e.Events,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,i,n){var r=document.createElement(t);return i&&e.$(r).attr(i),n&&e.$(r).html(n),r},setElement:function(t,i){return this.$el=e.$(t),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(t=t||e._getValue(this,"events")){this.undelegateEvents();var r=this;e._objectEach(t,function(e,s){if(i.isFunction(e)||(e=r[t[s]]),!e)throw Error('Event "'+t[s]+'" does not exist');var a=s.match(n),o=a[1],u=a[2];e=i.bind(e,r),o+=".delegateEvents"+r.cid,""===u?r.$el.bind(o,e):r.$el.delegate(u,o,e)})}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=i.extend({},this.options,t));var e=this;i.each(r,function(i){t[i]&&(e[i]=t[i])}),this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=e._getValue(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}}),e.View.extend=e._extend}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.User=e.Object.extend("_User",{_isCurrentUser:!1,_mergeMagicFields:function(t){t.sessionToken&&(this._sessionToken=t.sessionToken,delete t.sessionToken),e.User.__super__._mergeMagicFields.call(this,t)},_cleanupAuthData:function(){if(this.isCurrent()){var t=this.get("authData");
t&&e._objectEach(this.get("authData"),function(e,i){t[i]||delete t[i]})}},_synchronizeAllAuthData:function(){var t=this.get("authData");if(t){var i=this;e._objectEach(this.get("authData"),function(t,e){i._synchronizeAuthData(e)})}},_synchronizeAuthData:function(t){if(this.isCurrent()){var n;i.isString(t)?(n=t,t=e.User._authProviders[n]):n=t.getAuthType();var r=this.get("authData");if(r&&t){var s=t.restoreAuthentication(r[n]);s||this._unlinkFrom(t)}}},_handleSaveResult:function(t){t&&(this._isCurrentUser=!0),this._cleanupAuthData(),this._synchronizeAllAuthData(),delete this._serverData.password,this._rebuildEstimatedDataForKey("password"),this._refreshCache(),(t||this.isCurrent())&&e.User._saveCurrentUser(this)},_linkWith:function(t,n){var r;if(i.isString(t)?(r=t,t=e.User._authProviders[t]):r=t.getAuthType(),i.has(n,"authData")){var s=this.get("authData")||{};s[r]=n.authData,this.set("authData",s);var a=i.clone(n)||{};return a.success=function(t){t._handleSaveResult(!0),n.success&&n.success.apply(this,arguments)},this.save({authData:s},a)}var o=this,u=new e.Promise;return t.authenticate({success:function(t,e){o._linkWith(t,{authData:e,success:n.success,error:n.error}).then(function(){u.resolve(o)})},error:function(t,e){n.error&&n.error(o,e),u.reject(e)}}),u},_unlinkFrom:function(t,n){var r;i.isString(t)?(r=t,t=e.User._authProviders[t]):r=t.getAuthType();var s=i.clone(n),a=this;return s.authData=null,s.success=function(){a._synchronizeAuthData(t),n.success&&n.success.apply(this,arguments)},this._linkWith(t,s)},_isLinked:function(t){var e;e=i.isString(t)?t:t.getAuthType();var n=this.get("authData")||{};return!!n[e]},_logOutWithAll:function(){var t=this.get("authData");if(t){var i=this;e._objectEach(this.get("authData"),function(t,e){i._logOutWith(e)})}},_logOutWith:function(t){this.isCurrent()&&(i.isString(t)&&(t=e.User._authProviders[t]),t&&t.deauthenticate&&t.deauthenticate())},signUp:function(t,n){var r;n=n||{};var s=t&&t.username||this.get("username");if(!s||""===s)return r=new e.Error(e.Error.OTHER_CAUSE,"Cannot sign up user with an empty name."),n&&n.error&&n.error(this,r),e.Promise.error(r);var a=t&&t.password||this.get("password");if(!a||""===a)return r=new e.Error(e.Error.OTHER_CAUSE,"Cannot sign up user with an empty password."),n&&n.error&&n.error(this,r),e.Promise.error(r);var o=i.clone(n);return o.success=function(t){t._handleSaveResult(!0),n.success&&n.success.apply(this,arguments)},this.save(t,o)},logIn:function(t){var i=this;t=t||{};var n=e._request({route:"login",method:"GET",useMasterKey:t.useMasterKey,data:this.toJSON()});return n.then(function(t,e,n){var r=i.parse(t,e,n);return i._finishFetch(r),i._handleSaveResult(!0),i})._thenRunCallbacks(t,this)},save:function(t,n,r){var s,a;i.isObject(t)||i.isNull(t)||i.isUndefined(t)?(s=t,a=n):(s={},s[t]=n,a=r),a=a||{};var o=i.clone(a);return o.success=function(t){t._handleSaveResult(!1),a.success&&a.success.apply(this,arguments)},e.Object.prototype.save.call(this,s,o)},fetch:function(t){var n=t?i.clone(t):{};return n.success=function(e){e._handleSaveResult(!1),t&&t.success&&t.success.apply(this,arguments)},e.Object.prototype.fetch.call(this,n)},isCurrent:function(){return this._isCurrentUser},getUsername:function(){return this.get("username")},setUsername:function(t,e){return this.set("username",t,e)},setPassword:function(t,e){return this.set("password",t,e)},getEmail:function(){return this.get("email")},setEmail:function(t,e){return this.set("email",t,e)},authenticated:function(){return!!this._sessionToken&&e.User.current()&&e.User.current().id===this.id},getSessionToken:function(){return this._sessionToken}},{_currentUser:null,_currentUserMatchesDisk:!1,_CURRENT_USER_KEY:"currentUser",_authProviders:{},_performUserRewrite:!0,signUp:function(t,i,n,r){n=n||{},n.username=t,n.password=i;var s=e.Object._create("_User");return s.signUp(n,r)},logIn:function(t,i,n){var r=e.Object._create("_User");return r._finishFetch({username:t,password:i}),r.logIn(n)},become:function(t,i){i=i||{};var n=e.Object._create("_User");return e._request({route:"users",className:"me",method:"GET",useMasterKey:i.useMasterKey,sessionToken:t}).then(function(t,e,i){var r=n.parse(t,e,i);return n._finishFetch(r),n._handleSaveResult(!0),n})._thenRunCallbacks(i,n)},logOut:function(){null!==e.User._currentUser&&(e.User._currentUser._logOutWithAll(),e.User._currentUser._isCurrentUser=!1),e.User._currentUserMatchesDisk=!0,e.User._currentUser=null,e.localStorage.removeItem(e._getParsePath(e.User._CURRENT_USER_KEY))},requestPasswordReset:function(t,i){i=i||{};var n=e._request({route:"requestPasswordReset",method:"POST",useMasterKey:i.useMasterKey,data:{email:t}});return n._thenRunCallbacks(i)},current:function(){if(e.User._currentUser)return e.User._currentUser;if(e.User._currentUserMatchesDisk)return e.User._currentUser;e.User._currentUserMatchesDisk=!0;var t=e.localStorage.getItem(e._getParsePath(e.User._CURRENT_USER_KEY));if(!t)return null;e.User._currentUser=e.Object._create("_User"),e.User._currentUser._isCurrentUser=!0;var i=JSON.parse(t);return e.User._currentUser.id=i._id,delete i._id,e.User._currentUser._sessionToken=i._sessionToken,delete i._sessionToken,e.User._currentUser.set(i),e.User._currentUser._synchronizeAllAuthData(),e.User._currentUser._refreshCache(),e.User._currentUser._opSetQueue=[{}],e.User._currentUser},allowCustomUserClass:function(t){this._performUserRewrite=!t},_saveCurrentUser:function(t){e.User._currentUser!==t&&e.User.logOut(),t._isCurrentUser=!0,e.User._currentUser=t,e.User._currentUserMatchesDisk=!0;var i=t.toJSON();i._id=t.id,i._sessionToken=t._sessionToken,e.localStorage.setItem(e._getParsePath(e.User._CURRENT_USER_KEY),JSON.stringify(i))},_registerAuthenticationProvider:function(t){e.User._authProviders[t.getAuthType()]=t,e.User.current()&&e.User.current()._synchronizeAuthData(t.getAuthType())},_logInWith:function(t,i){var n=e.Object._create("_User");return n._linkWith(t,i)}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Query=function(t){i.isString(t)&&(t=e.Object._getSubclass(t)),this.objectClass=t,this.className=t.prototype.className,this._where={},this._include=[],this._limit=-1,this._skip=0,this._extraOptions={}},e.Query.or=function(){var t=i.toArray(arguments),n=null;e._arrayEach(t,function(t){if(i.isNull(n)&&(n=t.className),n!==t.className)throw"All queries must be for the same class"});var r=new e.Query(n);return r._orQuery(t),r},e.Query.prototype={get:function(t,i){var n=this;return n.equalTo("objectId",t),n.first().then(function(t){if(t)return t;var i=new e.Error(e.Error.OBJECT_NOT_FOUND,"Object not found.");return e.Promise.error(i)})._thenRunCallbacks(i,null)},toJSON:function(){var t={where:this._where};return this._include.length>0&&(t.include=this._include.join(",")),this._select&&(t.keys=this._select.join(",")),this._limit>=0&&(t.limit=this._limit),this._skip>0&&(t.skip=this._skip),void 0!==this._order&&(t.order=this._order),e._objectEach(this._extraOptions,function(e,i){t[i]=e}),t},find:function(t){var n=this;t=t||{};var r=e._request({route:"classes",className:this.className,method:"GET",useMasterKey:t.useMasterKey,data:this.toJSON()});return r.then(function(t){return i.map(t.results,function(i){var r;return r=t.className?new e.Object(t.className):new n.objectClass,r._finishFetch(i,!0),r})})._thenRunCallbacks(t)},count:function(t){var i=this;t=t||{};var n=this.toJSON();n.limit=0,n.count=1;var r=e._request({route:"classes",className:i.className,method:"GET",useMasterKey:t.useMasterKey,data:n});return r.then(function(t){return t.count})._thenRunCallbacks(t)},first:function(t){var n=this;t=t||{};var r=this.toJSON();r.limit=1;var s=e._request({route:"classes",className:this.className,method:"GET",useMasterKey:t.useMasterKey,data:r});return s.then(function(t){return i.map(t.results,function(t){var e=new n.objectClass;return e._finishFetch(t,!0),e})[0]})._thenRunCallbacks(t)},collection:function(t,n){return n=n||{},new e.Collection(t,i.extend(n,{model:this.objectClass,query:this}))},skip:function(t){return this._skip=t,this},limit:function(t){return this._limit=t,this},equalTo:function(t,n){return i.isUndefined(n)?this.doesNotExist(t):(this._where[t]=e._encode(n),this)},_addCondition:function(t,i,n){return this._where[t]||(this._where[t]={}),this._where[t][i]=e._encode(n),this},notEqualTo:function(t,e){return this._addCondition(t,"$ne",e),this},lessThan:function(t,e){return this._addCondition(t,"$lt",e),this},greaterThan:function(t,e){return this._addCondition(t,"$gt",e),this},lessThanOrEqualTo:function(t,e){return this._addCondition(t,"$lte",e),this},greaterThanOrEqualTo:function(t,e){return this._addCondition(t,"$gte",e),this},containedIn:function(t,e){return this._addCondition(t,"$in",e),this},notContainedIn:function(t,e){return this._addCondition(t,"$nin",e),this},containsAll:function(t,e){return this._addCondition(t,"$all",e),this},exists:function(t){return this._addCondition(t,"$exists",!0),this},doesNotExist:function(t){return this._addCondition(t,"$exists",!1),this},matches:function(t,e,i){return this._addCondition(t,"$regex",e),i||(i=""),e.ignoreCase&&(i+="i"),e.multiline&&(i+="m"),i&&i.length&&this._addCondition(t,"$options",i),this},matchesQuery:function(t,e){var i=e.toJSON();return i.className=e.className,this._addCondition(t,"$inQuery",i),this},doesNotMatchQuery:function(t,e){var i=e.toJSON();return i.className=e.className,this._addCondition(t,"$notInQuery",i),this},matchesKeyInQuery:function(t,e,i){var n=i.toJSON();return n.className=i.className,this._addCondition(t,"$select",{key:e,query:n}),this},doesNotMatchKeyInQuery:function(t,e,i){var n=i.toJSON();return n.className=i.className,this._addCondition(t,"$dontSelect",{key:e,query:n}),this},_orQuery:function(t){var e=i.map(t,function(t){return t.toJSON().where});return this._where.$or=e,this},_quote:function(t){return"\\Q"+t.replace("\\E","\\E\\\\E\\Q")+"\\E"},contains:function(t,e){return this._addCondition(t,"$regex",this._quote(e)),this},startsWith:function(t,e){return this._addCondition(t,"$regex","^"+this._quote(e)),this},endsWith:function(t,e){return this._addCondition(t,"$regex",this._quote(e)+"$"),this},ascending:function(t){return this._order=t,this},descending:function(t){return this._order="-"+t,this},near:function(t,i){return i instanceof e.GeoPoint||(i=new e.GeoPoint(i)),this._addCondition(t,"$nearSphere",i),this},withinRadians:function(t,e,i){return this.near(t,e),this._addCondition(t,"$maxDistance",i),this},withinMiles:function(t,e,i){return this.withinRadians(t,e,i/3958.8)},withinKilometers:function(t,e,i){return this.withinRadians(t,e,i/6371)},withinGeoBox:function(t,i,n){return i instanceof e.GeoPoint||(i=new e.GeoPoint(i)),n instanceof e.GeoPoint||(n=new e.GeoPoint(n)),this._addCondition(t,"$within",{$box:[i,n]}),this},include:function(){var t=this;return e._arrayEach(arguments,function(e){i.isArray(e)?t._include=t._include.concat(e):t._include.push(e)}),this},select:function(){var t=this;return this._select=this._select||[],e._arrayEach(arguments,function(e){i.isArray(e)?t._select=t._select.concat(e):t._select.push(e)}),this},each:function(t,n){if(n=n||{},this._order||this._skip||this._limit>=0){var r="Cannot iterate on a query with sort, skip, or limit.";return e.Promise.error(r)._thenRunCallbacks(n)}new e.Promise;var s=new e.Query(this.objectClass);s._limit=n.batchSize||100,s._where=i.clone(this._where),s._include=i.clone(this._include),s.ascending("objectId");var a=!1;return e.Promise._continueWhile(function(){return!a},function(){return s.find().then(function(i){var n=e.Promise.as();return e._.each(i,function(e){n=n.then(function(){return t(e)})}),n.then(function(){i.length>=s._limit?s.greaterThan("objectId",i[i.length-1].id):a=!0})})})._thenRunCallbacks(n)}}}(this),function(t){t.Parse=t.Parse||{};var e,i,n=t.Parse,r=n._,s=!1,a={authenticate:function(t){var i=this;FB.login(function(e){e.authResponse?t.success&&t.success(i,{id:e.authResponse.userID,access_token:e.authResponse.accessToken,expiration_date:new Date(1e3*e.authResponse.expiresIn+(new Date).getTime()).toJSON()}):t.error&&t.error(i,e)},{scope:e})},restoreAuthentication:function(t){if(t){var e={userID:t.id,accessToken:t.access_token,expiresIn:(n._parseDate(t.expiration_date).getTime()-(new Date).getTime())/1e3},s=r.clone(i);s.authResponse=e,s.status=!1;var a=FB.getAuthResponse();a&&a.userID!==e.userID&&FB.logout(),FB.init(s)}return!0},getAuthType:function(){return"facebook"},deauthenticate:function(){this.restoreAuthentication(null)}};n.FacebookUtils={init:function(t){if("undefined"==typeof FB)throw"The Facebook JavaScript SDK must be loaded before calling init.";if(i=r.clone(t)||{},i.status&&"undefined"!=typeof console){var e=console.warn||console.log||function(){};e.call(console,"The 'status' flag passed into FB.init, when set to true, can interfere with Parse Facebook integration, so it has been suppressed. Please call FB.getLoginStatus() explicitly if you require this behavior.")}i.status=!1,FB.init(i),n.User._registerAuthenticationProvider(a),s=!0},isLinked:function(t){return t._isLinked("facebook")},logIn:function(t,i){if(!t||r.isString(t)){if(!s)throw"You must initialize FacebookUtils before calling logIn.";return e=t,n.User._logInWith("facebook",i)}var a=r.clone(i)||{};return a.authData=t,n.User._logInWith("facebook",a)},link:function(t,i,n){if(!i||r.isString(i)){if(!s)throw"You must initialize FacebookUtils before calling link.";return e=i,t._linkWith("facebook",n)}var a=r.clone(n)||{};return a.authData=i,t._linkWith("facebook",a)},unlink:function(t,e){if(!s)throw"You must initialize FacebookUtils before calling unlink.";return t._unlinkFrom("facebook",e)}}}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl")};var n=/^[#\/]/,r=/msie [\w.]+/;e.History.started=!1,i.extend(e.History.prototype,e.Events,{interval:50,getHash:function(t){var e=t?t.location:window.location,i=e.href.match(/#(.*)$/);return i?i[1]:""},getFragment:function(t,i){if(e._isNullOrUndefined(t))if(this._hasPushState||i){t=window.location.pathname;var r=window.location.search;r&&(t+=r)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(n,"")},start:function(t){if(e.History.started)throw Error("Parse.history has already been started");e.History.started=!0,this.options=i.extend({},{root:"/"},this.options,t),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var s=this.getFragment(),a=document.documentMode,o=r.exec(navigator.userAgent.toLowerCase())&&(!a||7>=a);o&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(s)),this._hasPushState?e.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?e.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=window.setInterval(this.checkUrl,this.interval)),this.fragment=s;var u=window.location,c=u.pathname===this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!c?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&c&&u.hash&&(this.fragment=this.getHash().replace(n,""),window.history.replaceState({},document.title,u.protocol+"//"+u.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){e.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),window.clearInterval(this._checkUrlInterval),e.History.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=i.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return n},navigate:function(t,i){if(!e.History.started)return!1;i&&i!==!0||(i={trigger:i});var r=(t||"").replace(n,"");if(this.fragment!==r){if(this._hasPushState){0!==r.indexOf(this.options.root)&&(r=this.options.root+r),this.fragment=r;var s=i.replace?"replaceState":"pushState";window.history[s]({},document.title,r)}else this._wantsHashChange?(this.fragment=r,this._updateHash(window.location,r,i.replace),this.iframe&&r!==this.getFragment(this.getHash(this.iframe))&&(i.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,r,i.replace))):window.location.assign(this.options.root+t);i.trigger&&this.loadUrl(t)}},_updateHash:function(t,e,i){if(i){var n=(""+t).replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash=e}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Router=function(t){t=t||{},t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var n=/:\w+/g,r=/\*\w+/g,s=/[\-\[\]{}()+?.,\\\^\$\|#\s]/g;i.extend(e.Router.prototype,e.Events,{initialize:function(){},route:function(t,n,r){return e.history=e.history||new e.History,i.isRegExp(t)||(t=this._routeToRegExp(t)),r||(r=this[n]),e.history.route(t,i.bind(function(i){var s=this._extractParameters(t,i);r&&r.apply(this,s),this.trigger.apply(this,["route:"+n].concat(s)),e.history.trigger("route",this,n,s)},this)),this},navigate:function(t,i){e.history.navigate(t,i)},_bindRoutes:function(){if(this.routes){var t=[];for(var e in this.routes)this.routes.hasOwnProperty(e)&&t.unshift([e,this.routes[e]]);for(var i=0,n=t.length;n>i;i++)this.route(t[i][0],t[i][1],this[t[i][1]])}},_routeToRegExp:function(t){return t=t.replace(s,"\\$&").replace(n,"([^/]+)").replace(r,"(.*?)"),RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}}),e.Router.extend=e._extend}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse,i=e._;e.Cloud=e.Cloud||{},i.extend(e.Cloud,{run:function(t,i,n){n=n||{};var r=e._request({route:"functions",className:t,method:"POST",useMasterKey:n.useMasterKey,data:e._encode(i,null,!0)});return r.then(function(t){return e._decode(null,t).result})._thenRunCallbacks(n)}})}(this),function(t){t.Parse=t.Parse||{};var e=t.Parse;e.Installation=e.Object.extend("_Installation"),e.Push=e.Push||{},e.Push.send=function(t,i){if(i=i||{},t.where&&(t.where=t.where.toJSON().where),t.push_time&&(t.push_time=t.push_time.toJSON()),t.expiration_time&&(t.expiration_time=t.expiration_time.toJSON()),t.expiration_time&&t.expiration_time_interval)throw"Both expiration_time and expiration_time_interval can't be set";var n=e._request({route:"push",method:"POST",data:t,useMasterKey:i.useMasterKey});return n._thenRunCallbacks(i)}}(this);var internalCounter=0,gameHasBeenWon=!0,textScale=1,analyticSaved=!1,AnalyticsArr=[],answersArr=[],indAnalytics={},resultMark,successful_msg,lead_id="",unsuccessful_msg,G_outcome="Not Completed",G_score=0,timebar,runningcounter,gameresult;Crafty.scene("finalScene",function(){runningcounter&&clearInterval(runningcounter),clearInterval(increaseCounter),Parse.Cloud.run("increaseNWinLose",{game_id:gameAssets.game_id,oid:gameAssets.oid,won:gameHasBeenWon?"true":"false"}),saveGroupedAnalytics(),!gameAssets.record_ind_analytics||gameAssets.capture_leads_successful||gameAssets.capture_leads_unsuccessful||saveIndAnalytics(),Crafty.stop(!0),gameHasBeenWon&&!gameAssets.capture_leads_successful&&gameAssets.view_result_on_successful&&gameAssets.skip_resultpage_successful||!gameHasBeenWon&&!gameAssets.capture_leads_unsuccessful&&gameAssets.view_result_on_unsuccessful&&gameAssets.skip_resultpage_unsuccessful?gotoResultPage(!0):(document.getElementById("endscreen").style.display="block",gameHasBeenWon?(document.getElementById("message_box").className="successful_msg",gameAssets.redirect_on_successful?(4!=gameAssets.game_type&&(gameresult.redirect_link=gameAssets.successful_btn.link),gameresult.redirect=!0):gameAssets.view_result_on_successful?gameresult.view_result_page=!0:gameAssets.retry_btn_successful&&(gameresult.retry_btn=!0),gameresult.capture_leads=gameAssets.capture_leads_successful,gameAssets.capture_leads_successful?(gameresult.collect_email=gameAssets.collect_email_successful,gameresult.collect_name=gameAssets.collect_name_successful,gameresult.collect_address=gameAssets.collect_address_successful,gameresult.collect_phone=gameAssets.collect_phone_successful):loadSharingButtons(),document.getElementById("leadform_btn").className+=" successful_btn",document.getElementById("leadform_btn_span").innerHTML=gameAssets.successful_btn.text):(document.getElementById("message_box").className="unsuccessful_msg",gameAssets.redirect_on_unsuccessful?(gameresult.redirect_link=gameAssets.unsuccessful_btn.link,gameresult.redirect=!0):gameAssets.view_result_on_unsuccessful?gameresult.view_result_page=!0:gameAssets.retry_btn_unsuccessful&&(gameresult.retry_btn=!0),gameresult.capture_leads=gameAssets.capture_leads_unsuccessful,gameAssets.capture_leads_unsuccessful?(gameresult.collect_email=gameAssets.collect_email_unsuccessful,gameresult.collect_name=gameAssets.collect_name_unsuccessful,gameresult.collect_address=gameAssets.collect_address_unsuccessful,gameresult.collect_phone=gameAssets.collect_phone_unsuccessful):loadSharingButtons(),document.getElementById("leadform_btn").className+=" unsuccessful_btn",document.getElementById("leadform_btn_span").innerHTML=gameAssets.unsuccessful_btn.text))}),Crafty.scene("homeScene",function(){if(internalCounter=0,gameAssets.record_ind_analytics&&gameAssets.skip_instructions)setInterval(increaseCounter,1e3),increaseNPlayers(),Crafty.scene("gameScene");else{displayBG();var t={display:"table","background-color":hex2rgb(gameAssets.game_instructions.bgnd_color,gameAssets.game_instructions.opacity),"text-align":"center","border-radius":"5px"};(5==gameAssets.language_idx||6==gameAssets.language_idx)&&(t.direction="rtl",t["text-align"]="right"),Crafty.e("2D, DOM, Text").textFont({size:gameAssets.game_instructions.text_size*textScale+"px",family:gameAssets.text_font}).textColor(gameAssets.text_color).text(centerAlignStr(gameAssets.game_instructions.text)).css(t).attr({x:gameAssets.game_instructions.left,y:gameAssets.game_instructions.top,w:gameAssets.game_instructions.width,h:gameAssets.game_instructions.height}),Crafty.e("2D, DOM, Text, Mouse").text(centerAlignStr(gameAssets.start_btn.text)).css({display:"table",border:"1px solid #fff",cursor:"pointer","border-radius":"5px","background-color":hex2rgb(gameAssets.start_btn.bgnd_color),"text-align":"center"}).textFont({size:gameAssets.start_btn.text_size*textScale+"px",family:gameAssets.text_font}).textColor(gameAssets.text_color).attr({x:gameAssets.start_btn.left,y:gameAssets.start_btn.top,w:gameAssets.start_btn.width,h:gameAssets.start_btn.height}).bind("Click",function(){this.css({"background-color":darkenColor(gameAssets.start_btn.bgnd_color)}),setInterval(increaseCounter,1e3),increaseNPlayers(),setTimeout(function(){Crafty.scene("gameScene")},1e3)})}}),Crafty.scene("loadingScene",function(){initVariables(),Crafty.background("#ffffff"),Crafty.e("2D, DOM, Image").attr({x:285,y:Crafty.viewport.height/3,z:10}).image("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH4AAACWCAMAAAAv6sxVAAAAk1BMVEX///9BU2lxfo/P1Nllc4Xz9Pa3vsdNXnKgqbRZaXyJOpGJlKHn6eyUn6t9iZjb3+PDydD48/iss73cyqDezabw5vH7+POfX6aueLTEnMiYU5/p3sT9/Pn49e3l17jTtda9kcG1hLqQRpina63t5M/hzuPp2ur07uHg0azawdzw6NXr4crLqM/y69v28ufn277j1LKvL5vRAAAGgklEQVR4Xu3a53LiShAF4NOjnEXOOOawu+//dHcpG/VILbAYCetuFecXVbLrY3qmW4IC/24uyZI+dcuLe9RdinrVKe5VV73qlPeqB73q1FvX5bRL1pOeeTs96E/vsfaOTUT9nXtFn3F60ZMv3e7v0O+S9qHH3p73++Bt2mfYg+5TEevndYvOyft0JDHgBGXepdNimfNJcZ1568d4zwHiEpD/JD/kcceNl52B92sDIK/ZjcaJmvI4lKDMK5wSqyUvj/nP8oHYyZ/kZY8nP8kHgg/qocdz8FbjPrqenIGPSCaq5V9mZ+C9ArX5ZVzrLxdd8/rI8fJvln8dPnTHy9ojOr78h3A56JgPdN4Jji//Nrzulo9JC5AdP/zzMHzslHfLPHw69rT9HoazTvmkwkMde+B8DMPwvUteVXln331eDJm//O2gQ570lKeggszsr3/dHe9U+PspkBwp/134N5POeKvKbwHYXP5aft4Z71b50av2ccuu58OHrnhf8OOp1o1+PX93Pn60BZDy8BFHj5ffnk8lP3rVui9woGcQfmbeEa9q+PH04Gf9l/ArE0M+T+ODvPfJc/lF9833/I0hj4j8Q7z65Mvlp4ylSVhkYMg7HtnZMf6r/MM9b/P23zC/MOD3Lz33OD/Shw8lvHjO0pSPuaErfASsRp/50Adizk3PeTHkYX9SkveB7Rc/XmvXvM/yX4V65qZ8Quwf4kdvQKzvCjC4DUsZGPIusV/iLWA82meqzyS/aDrOlSFvcUcLflRkpe8+ZXgJK5mZ8syVeWAz4kwBWyv/LKxmYsbHfKRKfAD80vgV4GqFWQj+yozPtE5Tou05U34WcvnkceYti09k+eW+W+n8PZAWOnAtlt+aVzqfA886/wy4rGMi+BfDxuNExImxHpXyhHivb6fF0ONcG/H6ioPSyXsq8ysg+NRXu9dXovWM+JRqkwBvZX4MKEp2+m4KYyCqPzCd+Ry59ZwNfBtfB/JDzr3wwYSv171i6HBeMYz37fCnpvoLA96q56Oi9pzfAPBajAFR/bkB79fzFtdebz08cSnE4F0a8KoK87kXWWM65lLIwWvAU21cYCv5X9jqffAgzt7JfM6kuN2IfHyU+gBi7p3MJ4e6blvD33Mr1m7+4lS+vusV73wpz5UheNOWd5oee5mtPHt3p/LWgcV/CE0GeGnL+weO/XMDfo2Hc/DegZ2XbYi2vKqftysz/rYLPgfGZnxoxsvaN+SXZX3WAZ8C9035u+733ge2PfIWMG7K33bPZwATpzXedQd9D0yb8RvBLzrhfzXjgUnbG65lzj/L543Jqbxjzv8G3sXQO5FHIHmgEf8K3LR+0o2M+Y0Yeu/o4FkvbjZ2nuXJm5zOw5NjB28N+Dfgvf1HTFl9v9ktZyqeNK/QxYcsBay/11fAY+XcD0x4OXedJo8bG3HuF62+VuS4DTp/BUzE4k14uXwb35798RqYi8Wb8ZY8+9gc55/EwF0OTHlEcvl4+6bpBktxtzHlHU/+bAx/jm28KP0NjHlZfi8G1uNj+qKszwYteHnbtx1gw77QryotP0EbXm5/BGDzXH+jk/ojzPjj/lq23/MGwLXQ2/LSTx0A95UNuF8Dgzuht+elb2cApit916cAXm7FqeuEh1vpP28I7Q2M73f4ZC6frTvikYnxawHA+uP3ePWEHX5TwWcP6I6XBSCVo8hDFb+9Ajrl4fgBlRMkGQBM3pcVfHk1QGteJk+pksB9nFXtGy57S17G8pW9p1XixgBeFnf75d/dvHOvteHN8w/zF/58+X/zF97yz5sY58kll1xyySXW6YCv/+h7SC4QU6p/2ZM6BVC+iXhEFPFFuPqvHeEFQEbR93zk+/v/csgGhpQXfJCnpJgP9JsI2VbK7xQ52UOPiqsRWUgo+563wEkphh2g4BVgE/MKWqh80SYHLv9+c7fywMZpfE7DmHyd1/9A8qrgHUrLf2F7Frkn8ghsn+LGq8+Ys8hHqRouBZ7TgB9aFoMJBSk03hlSUt575j1Fyinzinl4FDU8+VzumCjX+K+uYFApnffIPczbfLFx8fXyAcp2bb4ui+8EFAueF2KfzqsSrxBTdJjHkNwSb3vaNkaUteb17pG8S0P9oqPVx0tjitrzio7wihe4eznkd+OSC9tzjHjZ93z0Mq0PbG3qWeQlFBSeIgfu943vqgx6EgVOkgCWyrkYOq+CQA3BcQNKi4uO8gFHJTp1yX/1POp8MV8pugAAAABJRU5ErkJggg==");var t=Crafty.e("2D, DOM, Color").attr({x:0,y:Crafty.viewport.height-10,w:10,h:10}).color("#883b90");void 0!=gameAssets.bgnd_image&&""!=gameAssets.bgnd_image?Crafty.load({images:[gameAssets.bgnd_image]},function(){Crafty.scene("homeScene")},function(e){t.attr({w:e.percent/100*Crafty.viewport.width})},function(){console.log("there was an error")}):(t.attr({w:700}),Crafty.scene("homeScene"))}),window.onbeforeunload=function(){analyticSaved||saveGroupedAnalytics()},Crafty.scene("gameScene",function(){function t(){var t,e=o.slice(0),i=[];t=Math.max.apply(null,e);for(var n=0;n<e.length;n++)e[n]===t&&e[n]>Number.NEGATIVE_INFINITY&&(i.push(u[n]),e[n]=Number.NEGATIVE_INFINITY);return i.join(",")}function e(){if(s<gameAssets.questions.length){""!=gameAssets.bgnd_images[s]&&void 0!=gameAssets.bgnd_images[s]&&gameAssets.image_quiz?Crafty.background("url('"+gameAssets.bgnd_images[s]+"') no-repeat"):setBG(),r.text(centerAlignStr(gameAssets.questions[s]));for(var e=0;4>e;e++){var i=gameAssets.answers_MCQ[s];a[e].text(centerAlignStr(u[e]+". "+i[e])),a[e].css({"background-color":gameAssets.banner.bgnd_color}),a[e].bind("Click",h),a[e].visible=""==i[e]||void 0==i[e]?!1:!0}}else{if(G_outcome=t(),console.log(G_outcome),gameresult.message=gameAssets.successful_msg.text.replace("[mostly]",t()),gameAssets.is_rule_based){for(var n=-1,e=0;e<results.length;e++)if(G_outcome==results[e].mostly_answered){n=e;break}-1!=n&&copyToGameResult(n)}Crafty.scene("finalScene")}}function i(t){var i={};i[s.toString()]=t,answersArr.push(i),o[t]+=1,s++,setTimeout(function(){e()},700)}function n(){for(var t=0;4>t;t++)a[t]=Crafty.e("AnswerLabel"),a[t].setTag(t);a[0].attr({x:25,y:225}),a[1].attr({x:355,y:225}),a[2].attr({x:25,y:305}),a[3].attr({x:355,y:305}),e()}var r,s=0,a=new Array,o=[0,0,0,0],u=["A","B","C","D"];G_score=0,displayBG();var c={display:"table","background-color":hex2rgb(gameAssets.banner.bgnd_color,gameAssets.banner.opacity),"text-align":"center"};(5==gameAssets.language_idx||6==gameAssets.language_idx)&&(c["text-align"]="right",c.direction="rtl"),r=Crafty.e("2D, DOM, Text, Mouse").textFont({size:gameAssets.text_size+"px",family:gameAssets.text_font}).textColor(gameAssets.text_color).attr({x:0,y:0,w:Crafty.viewport.width,h:Crafty.viewport.height/2}).css(c);var h=function(){this.css({"background-color":darkenColor(gameAssets.banner.bgnd_color)}),i(this.tag),Crafty("AnswerLabel").unbind("Click")};Crafty.c("AnswerLabel",{init:function(){this.tag=0,this.addComponent("2D, DOM, Mouse , Text"),this.attr({x:0,y:0,w:320,h:70}).css({display:"table","background-color":gameAssets.banner.bgnd_color,"text-align":"center",cursor:"pointer","text-shadow":"1px 1px 3px #888",border:"1px solid #fff","border-radius":"5px"}).textFont({size:gameAssets.text_size-6+"px",family:gameAssets.text_font}).textColor(gameAssets.text_color)},setTag:function(t){this.tag=t}}),n()});