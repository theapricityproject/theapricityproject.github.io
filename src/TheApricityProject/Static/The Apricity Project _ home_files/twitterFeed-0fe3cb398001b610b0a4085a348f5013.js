function fixUrls(e){var t=/[@]\w*[\s]?/g,n=/[#]\w*[\s]?/g,o=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;return e=e.replace(o,function(e){return'<span class="twitterURL twitterLink"><a href="'+e+'" target="_blank">'+e+"</a></span>"}),e=e.replace(t,function(e){var t="@"==e.substr(0,1),n=t?e.substr(1):e;return'<span class="twitterName twitterLink"><a href="https://twitter.com/'+n+'"target="_blank">'+e+"</a></span>"}),e=e.replace(n,function(e){var t="#"==e.substr(0,1),n=t?e.substr(1):e;return' <span class="twitterHashtag twitterLink"><a href="https://twitter.com/hashtag/'+n+'"target="_blank">'+e+"</a></span>"})}function loadView(e){var t="undefined"!=typeof e&&void 0!=e.use_backup_content?e.use_backup_content:!1,n="undefined"!=typeof e&&void 0!=e.app_el?e.app_el:$("#appView");for(var o in GLOBALS)window[o]=GLOBALS[o];var r=META.app_type+"AppModel";if(debug("META IS ",META),META.soft_alias&&(debug("Setting soft alias"),window[r]=window[META.app_namespace+"AppModel"].extend({defaults:function(){return META.default_content}})),debug("Load App called. Model name is "+r+"; type is "+typeof window[r]),APP_MODEL=new window[r],t)for(var o in BACKUP_CONTENT)"undefined"!=BACKUP_CONTENT[o]&&APP_MODEL.set(o,BACKUP_CONTENT[o]);else for(var o in CONTENT)"undefined"!=CONTENT[o]&&APP_MODEL.set(o,CONTENT[o]);APP_MODEL.meta={};for(var o in META)"undefined"!=META[o]&&(APP_MODEL.meta[o]=META[o]);META.password_protected_template&&$("body").append(META.password_protected_template),APP_VIEW=new window[META.app_namespace+"AppView"]({el:"#"+n.attr("id"),model:APP_MODEL}),"weebly"==HOST&&(debug("Host is weebly"),setInterval(function(){if("undefined"!=typeof META){var e=localStorage.getItem("powr_data_"+META.id);if(void 0!=e&&null!=e&&"null"!=e){e=JSON.parse(e);{APP_MODEL.get("locals")}for(var t in e.content)if("locals"==t)for(var n in e.content.locals)APP_MODEL.attributes.locals[n]=e.content.locals[n];else APP_MODEL.attributes[t]=e.content[t];APP_VIEW.render(),localStorage.removeItem("powr_data_"+META.id)}}},100)),loadViewInitializers()}function loadViewInitializers(){META.premium||$(".loadingWrapper").show(),META.edit_me&&$("#editMe").fadeIn("fast"),META.edit_me_helper&&$(".editMeHelper").fadeIn("fast"),$('link[rel="canonical"]').attr("href",baseUri()+"/plugins/view?id="+META.id),META.admin_debug_panel&&$("body").append(META.admin_debug_panel),"undefined"==typeof _gaq&&(_gaq=[]);var e="UA-46595223-1";_gaq.push(["powr._setAccount",e]),_gaq.push(["powr._trackPageview"]),analyticsEvent(META.id.toString(),"view",""),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();var t=getURLParameter("mode");"page"==t?$("#appView").css({margin:"5% 15%"}):"scroll"==t||$("html").css({overflow:"hidden"})}function loadViewListeners(){function e(e){function t(){PARENT_ORIGIN=e.origin,IFRAME_INDEX=n.data.iframe_index,"undefined"==typeof APP_MODEL?setTimeout(t,50):APP_MODEL.setLocals({parent_origin:e.origin,iframe_index:n.data.iframe_index,parent_window_height:n.data.parent_window_height,parent_window_width:n.data.parent_window_width})}debug("View received settings, evt is",e);var n=JSON.parse(e.data);if("loaded"==n.message){debug("View received settings loaded. Evt origin is ",e.origin),t();var o={message:"viewLoaded",data:{iframe_index:n.data.iframe_index}};parent.postMessage(JSON.stringify(o),e.origin),"undefined"!=typeof APP_VIEW&&APP_VIEW.postSizeToSocket()}if("loadView"==n.message)META=n.data.meta,GLOBALS=n.data.globals,CONTENT=n.data.content,loadView(),APP_MODEL.setLocals({parent_origin:e.origin,iframe_index:n.data.iframe_index});else if("showEdit"==n.message)$("#editMe, .adminAppInfo").fadeIn();else if("hideEdit"==n.message)$("#editMe, .adminAppInfo").hide();else if("update"==n.message){{APP_MODEL.get("locals")}for(var r in n.data.content)if("locals"==r)for(var a in n.data.content.locals)APP_MODEL.attributes.locals[a]=n.data.content.locals[a];else APP_MODEL.attributes[r]=n.data.content[r];APP_VIEW.render()}}function t(){$("#editMe").popover({html:!0,trigger:"hover",delay:{hide:850},viewport:{selector:"#apps-view",padding:0},template:'<div class="popover" role="tooltip" style="font-size: 12px;margin-top: 5px;z-index: 10000000;"><div class="arrow"></div><div class="popover-content"></div></div>'})}try{APP_SOCKET=new easyXDM.Socket({onMessage:function(e){var t=JSON.parse(e);debug("Message in app:",t),t.action&&"activate"==t.action?$("#editMe").fadeIn():t.action&&"deactivate"==t.action&&$("#editMe").fadeOut()}})}catch(n){debug("Could not establish socket connection: "+n)}return window.addEventListener?window.addEventListener("message",e):window.attachEvent("onmessage",e),$("#editMe").click(function(){"undefined"!=typeof SETTINGS_WINDOW&&SETTINGS_WINDOW.close(),$(".editMeHelper").css("display","none");var e=Math.round(.9*screen.height),t=Math.round(screen.width/3);t=Math.min(t,500);var n=Math.round(screen.width-t-.1*screen.width),o="/apps/"+META.app_type+"/settings?id="+META.true_id+"&demo_mode="+META.demo_mode;void 0!=META.template&&(o+="&template="+META.template),SETTINGS_WINDOW=window.open(o,"POWr Editor","width="+t+",height="+e+",top=-1000,left="+n+",location=no,status=no","false")}),void 0==$(window).popover?void setTimeout(function(){t()},2e3):(t(),void $(window).on("beforeunload",function(){return APP_MODEL.get("locals").isDirty?"You have unsaved work with a POWr Plugin! If you leave this page you will lose any unsaved changes.":void 0}))}!function(e){"use strict";e.fn.konami=function(t){var n,o,r;return n=e.extend({},e.fn.konami.defaults,t),this.each(function(){o=[],e(window).keyup(function(e){r=e.keyCode||e.which,n.code.length>o.push(r)||(n.code.length<o.length&&o.shift(),n.code.toString()===o.toString()&&n.cheat())})})},e.fn.konami.defaults={code:[38,38,40,40,37,39,37,39,66,65],cheat:null}}(jQuery),function(e,t,n,o,r,a){function i(e,t){var n=typeof e[t];return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function s(e,t){return!("object"!=typeof e[t]||!e[t])}function l(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(){var e="Shockwave Flash",t="application/x-shockwave-flash";if(!_(navigator.plugins)&&"object"==typeof navigator.plugins[e]){var n=navigator.plugins[e].description;n&&!_(navigator.mimeTypes)&&navigator.mimeTypes[t]&&navigator.mimeTypes[t].enabledPlugin&&(x=n.match(/\d+/g))}if(!x){var o;try{o=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),x=Array.prototype.slice.call(o.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),o=null}catch(r){}}if(!x)return!1;var a=parseInt(x[0],10),i=parseInt(x[1],10);return O=a>9&&i>0,!0}function d(){if(!G){G=!0;for(var e=0;e<j.length;e++)j[e]();j.length=0}}function u(e,t){return G?void e.call(t):void j.push(function(){e.call(t)})}function p(){var e=parent;if(""!==W)for(var t=0,n=W.split(".");t<n.length;t++)e=e[n[t]];return e.easyXDM}function f(t){return e.easyXDM=B,W=t,W&&(H="easyXDM_"+W.replace(".","_")+"_"),$}function g(e){return e.match(N)[3]}function h(e){return e.match(N)[4]||""}function m(e){var t=e.toLowerCase().match(N),n=t[2],o=t[3],r=t[4]||"";return("http:"==n&&":80"==r||"https:"==n&&":443"==r)&&(r=""),n+"//"+o+r}function w(e){if(e=e.replace(R,"$1/"),!e.match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":n.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=n.protocol+"//"+n.host+t+e}for(;F.test(e);)e=e.replace(F,"");return e}function v(e,t){var n="",o=e.indexOf("#");-1!==o&&(n=e.substring(o),e=e.substring(0,o));var r=[];for(var i in t)t.hasOwnProperty(i)&&r.push(i+"="+a(t[i]));return e+(U?"#":-1==e.indexOf("?")?"?":"&")+r.join("&")+n}function _(e){return"undefined"==typeof e}function y(e,t,n){var o;for(var r in t)t.hasOwnProperty(r)&&(r in e?(o=t[r],"object"==typeof o?y(e[r],o,n):n||(e[r]=t[r])):e[r]=t[r]);return e}function E(){var e=t.body.appendChild(t.createElement("form")),n=e.appendChild(t.createElement("input"));n.name=H+"TEST"+L,A=n!==e.elements[n.name],t.body.removeChild(e)}function b(e){_(A)&&E();var n;A?n=t.createElement('<iframe name="'+e.props.name+'"/>'):(n=t.createElement("IFRAME"),n.name=e.props.name),n.id=n.name=e.props.name,delete e.props.name,"string"==typeof e.container&&(e.container=t.getElementById(e.container)),e.container||(y(n.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=t.body);var o=e.props.src;if(e.props.src="javascript:false",y(n,e.props),n.border=n.frameBorder=0,n.allowTransparency=!0,e.container.appendChild(n),e.onLoad&&C(n,"load",e.onLoad),e.usePost){var r,a=e.container.appendChild(t.createElement("form"));if(a.target=n.name,a.action=o,a.method="POST","object"==typeof e.usePost)for(var i in e.usePost)e.usePost.hasOwnProperty(i)&&(A?r=t.createElement('<input name="'+i+'"/>'):(r=t.createElement("INPUT"),r.name=i),r.value=e.usePost[i],a.appendChild(r));a.submit(),a.parentNode.removeChild(a)}else n.src=o;return e.props.src=o,n}function T(e,t){"string"==typeof e&&(e=[e]);for(var n,o=e.length;o--;)if(n=e[o],n=new RegExp("^"==n.substr(0,1)?n:"^"+n.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),n.test(t))return!0;return!1}function M(o){var r,a=o.protocol;if(o.isHost=o.isHost||_(J.xdm_p),U=o.hash||!1,o.props||(o.props={}),o.isHost)o.remote=w(o.remote),o.channel=o.channel||"default"+L++,o.secret=Math.random().toString(16).substring(2),_(a)&&(a=m(n.href)==m(o.remote)?"4":i(e,"postMessage")||i(t,"postMessage")?"1":o.swf&&i(e,"ActiveXObject")&&c()?"6":"Gecko"===navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?"5":o.remoteHelper?"2":"0");else if(o.channel=J.xdm_c.replace(/["'<>\\]/g,""),o.secret=J.xdm_s,o.remote=J.xdm_e.replace(/["'<>\\]/g,""),a=J.xdm_p,o.acl&&!T(o.acl,o.remote))throw new Error("Access denied for "+o.remote);switch(o.protocol=a,a){case"0":if(y(o,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),o.isHost){if(!o.local){for(var s,l=n.protocol+"//"+n.host,d=t.body.getElementsByTagName("img"),u=d.length;u--;)if(s=d[u],s.src.substring(0,l.length)===l){o.local=s.src;break}o.local||(o.local=e)}var p={xdm_c:o.channel,xdm_p:0};o.local===e?(o.usePolling=!0,o.useParent=!0,o.local=n.protocol+"//"+n.host+n.pathname+n.search,p.xdm_e=o.local,p.xdm_pa=1):p.xdm_e=w(o.local),o.container&&(o.useResize=!1,p.xdm_po=1),o.remote=v(o.remote,p)}else y(o,{channel:J.xdm_c,remote:J.xdm_e,useParent:!_(J.xdm_pa),usePolling:!_(J.xdm_po),useResize:o.useParent?!1:o.useResize});r=[new $.stack.HashTransport(o),new $.stack.ReliableBehavior({}),new $.stack.QueueBehavior({encode:!0,maxLength:4e3-o.remote.length}),new $.stack.VerifyBehavior({initiate:o.isHost})];break;case"1":r=[new $.stack.PostMessageTransport(o)];break;case"2":o.remoteHelper=w(o.remoteHelper),r=[new $.stack.NameTransport(o),new $.stack.QueueBehavior,new $.stack.VerifyBehavior({initiate:o.isHost})];break;case"3":r=[new $.stack.NixTransport(o)];break;case"4":r=[new $.stack.SameOriginTransport(o)];break;case"5":r=[new $.stack.FrameElementTransport(o)];break;case"6":x||c(),r=[new $.stack.FlashTransport(o)]}return r.push(new $.stack.QueueBehavior({lazy:o.lazy,remove:!0})),r}function k(e){for(var t,n={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},o=0,r=e.length;r>o;o++)t=e[o],y(t,n,!0),0!==o&&(t.down=e[o-1]),o!==r-1&&(t.up=e[o+1]);return t}function P(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var A,x,O,C,S,I=this,L=Math.floor(1e4*Math.random()),D=Function.prototype,N=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,F=/[\-\w]+\/\.\.\//,R=/([^:])\/\//g,W="",$={},B=e.easyXDM,H="easyXDM_",U=!1;if(i(e,"addEventListener"))C=function(e,t,n){e.addEventListener(t,n,!1)},S=function(e,t,n){e.removeEventListener(t,n,!1)};else{if(!i(e,"attachEvent"))throw new Error("Browser not supported");C=function(e,t,n){e.attachEvent("on"+t,n)},S=function(e,t,n){e.detachEvent("on"+t,n)}}var V,G=!1,j=[];if("readyState"in t?(V=t.readyState,G="complete"==V||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==V||"interactive"==V)):G=!!t.body,!G){if(i(e,"addEventListener"))C(t,"DOMContentLoaded",d);else if(C(t,"readystatechange",function(){"complete"==t.readyState&&d()}),t.documentElement.doScroll&&e===top){var z=function(){if(!G){try{t.documentElement.doScroll("left")}catch(e){return void o(z,1)}d()}};z()}C(e,"load",d)}var J=function(e){e=e.substring(1).split("&");for(var t,n={},o=e.length;o--;)t=e[o].split("="),n[t[0]]=r(t[1]);return n}(/xdm_e=/.test(n.search)?n.search:n.hash),X=function(){var e={},t={a:[1,2,3]},n='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(t).replace(/\s/g,"")===n?JSON:(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")===n&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(t=n.evalJSON(),t.a&&3===t.a.length&&3===t.a[2]&&(e.parse=function(e){return e.evalJSON()})),e.stringify&&e.parse?(X=function(){return e},e):null)};y($,{version:"2.4.17.1",query:J,stack:{},apply:y,getJSONObject:X,whenReady:u,noConflict:f}),$.DomHelper={on:C,un:S,requiresJSON:function(n){s(e,"JSON")||t.write('<script type="text/javascript" src="'+n+'"></script>')}},function(){var e={};$.Fn={set:function(t,n){e[t]=n},get:function(t,n){var o=e[t];return n&&delete e[t],o}}}(),$.Socket=function(e){var t=k(M(e).concat([{incoming:function(t,n){e.onMessage(t,n)},callback:function(t){e.onReady&&e.onReady(t)}}])),n=m(e.remote);this.origin=m(e.remote),this.destroy=function(){t.destroy()},this.postMessage=function(e){t.outgoing(e,n)},t.init()},$.Rpc=function(e,t){if(t.local)for(var n in t.local)if(t.local.hasOwnProperty(n)){var o=t.local[n];"function"==typeof o&&(t.local[n]={method:o})}var r=k(M(e).concat([new $.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=m(e.remote),this.destroy=function(){r.destroy()},r.init()},$.stack.SameOriginTransport=function(e){var t,r,a,i;return t={outgoing:function(e,t,n){a(e),n&&n()},destroy:function(){r&&(r.parentNode.removeChild(r),r=null)},onDOMReady:function(){i=m(e.remote),e.isHost?(y(e.props,{src:v(e.remote,{xdm_e:n.protocol+"//"+n.host+n.pathname,xdm_c:e.channel,xdm_p:4}),name:H+e.channel+"_provider"}),r=b(e),$.Fn.set(e.channel,function(e){return a=e,o(function(){t.up.callback(!0)},0),function(e){t.up.incoming(e,i)}})):(a=p().Fn.get(e.channel,!0)(function(e){t.up.incoming(e,i)}),o(function(){t.up.callback(!0)},0))},init:function(){u(t.onDOMReady,t)}}},$.stack.FlashTransport=function(e){function r(e){o(function(){i.up.incoming(e,l)},0)}function a(n){var o=e.swf+"?host="+e.isHost,r="easyXDM_swf_"+Math.floor(1e4*Math.random());$.Fn.set("flash_loaded"+n.replace(/[\-.]/g,"_"),function(){$.stack.FlashTransport[n].swf=c=d.firstChild;for(var e=$.stack.FlashTransport[n].queue,t=0;t<e.length;t++)e[t]();e.length=0}),e.swfContainer?d="string"==typeof e.swfContainer?t.getElementById(e.swfContainer):e.swfContainer:(d=t.createElement("div"),y(d.style,O&&e.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),t.body.appendChild(d));var a="callback=flash_loaded"+n.replace(/[\-.]/g,"_")+"&proto="+I.location.protocol+"&domain="+g(I.location.href)+"&port="+h(I.location.href)+"&ns="+W;d.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+r+"' data='"+o+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+o+"'></param><param name='flashvars' value='"+a+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+a+"' allowScriptAccess='always' wmode='transparent' src='"+o+"' height='1' width='1'></embed></object>"}var i,s,l,c,d;return i={outgoing:function(t,n,o){c.postMessage(e.channel,t.toString()),o&&o()},destroy:function(){try{c.destroyChannel(e.channel)}catch(t){}c=null,s&&(s.parentNode.removeChild(s),s=null)},onDOMReady:function(){l=e.remote,$.Fn.set("flash_"+e.channel+"_init",function(){o(function(){i.up.callback(!0)})}),$.Fn.set("flash_"+e.channel+"_onMessage",r),e.swf=w(e.swf);var t=g(e.swf),d=function(){$.stack.FlashTransport[t].init=!0,c=$.stack.FlashTransport[t].swf,c.createChannel(e.channel,e.secret,m(e.remote),e.isHost),e.isHost&&(O&&e.swfNoThrottle&&y(e.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),y(e.props,{src:v(e.remote,{xdm_e:m(n.href),xdm_c:e.channel,xdm_p:6,xdm_s:e.secret}),name:H+e.channel+"_provider"}),s=b(e))};$.stack.FlashTransport[t]&&$.stack.FlashTransport[t].init?d():$.stack.FlashTransport[t]?$.stack.FlashTransport[t].queue.push(d):($.stack.FlashTransport[t]={queue:[d]},a(t))},init:function(){u(i.onDOMReady,i)}}},$.stack.PostMessageTransport=function(t){function r(e){if(e.origin)return m(e.origin);if(e.uri)return m(e.uri);if(e.domain)return n.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}function a(e){var n=r(e);n==c&&e.data.substring(0,t.channel.length+1)==t.channel+" "&&i.up.incoming(e.data.substring(t.channel.length+1),n)}var i,s,l,c;return i={outgoing:function(e,n,o){l.postMessage(t.channel+" "+e,n||c),o&&o()},destroy:function(){S(e,"message",a),s&&(l=null,s.parentNode.removeChild(s),s=null)},onDOMReady:function(){if(c=m(t.remote),t.isHost){var r=function(n){n.data==t.channel+"-ready"&&(l="postMessage"in s.contentWindow?s.contentWindow:s.contentWindow.document,S(e,"message",r),C(e,"message",a),o(function(){i.up.callback(!0)},0))};C(e,"message",r),y(t.props,{src:v(t.remote,{xdm_e:m(n.href),xdm_c:t.channel,xdm_p:1}),name:H+t.channel+"_provider"}),s=b(t)}else C(e,"message",a),l="postMessage"in e.parent?e.parent:e.parent.document,l.postMessage(t.channel+"-ready",c),o(function(){i.up.callback(!0)},0)},init:function(){u(i.onDOMReady,i)}}},$.stack.FrameElementTransport=function(r){var a,i,s,l;return a={outgoing:function(e,t,n){s.call(this,e),n&&n()},destroy:function(){i&&(i.parentNode.removeChild(i),i=null)},onDOMReady:function(){l=m(r.remote),r.isHost?(y(r.props,{src:v(r.remote,{xdm_e:m(n.href),xdm_c:r.channel,xdm_p:5}),name:H+r.channel+"_provider"}),i=b(r),i.fn=function(e){return delete i.fn,s=e,o(function(){a.up.callback(!0)},0),function(e){a.up.incoming(e,l)}}):(t.referrer&&m(t.referrer)!=J.xdm_e&&(e.top.location=J.xdm_e),s=e.frameElement.fn(function(e){a.up.incoming(e,l)}),a.up.callback(!0))},init:function(){u(a.onDOMReady,a)}}},$.stack.NameTransport=function(e){function t(t){var n=e.remoteHelper+(s?"#_3":"#_2")+e.channel;l.contentWindow.sendMessage(t,n)}function n(){s?2!==++d&&s||i.up.callback(!0):(t("ready"),i.up.callback(!0))}function r(e){i.up.incoming(e,f)}function a(){p&&o(function(){p(!0)},0)}var i,s,l,c,d,p,f,g;return i={outgoing:function(e,n,o){p=o,t(e)},destroy:function(){l.parentNode.removeChild(l),l=null,s&&(c.parentNode.removeChild(c),c=null)},onDOMReady:function(){s=e.isHost,d=0,f=m(e.remote),e.local=w(e.local),s?($.Fn.set(e.channel,function(t){s&&"ready"===t&&($.Fn.set(e.channel,r),n())}),g=v(e.remote,{xdm_e:e.local,xdm_c:e.channel,xdm_p:2}),y(e.props,{src:g+"#"+e.channel,name:H+e.channel+"_provider"}),c=b(e)):(e.remoteHelper=e.remote,$.Fn.set(e.channel,r));var t=function(){var r=l||this;S(r,"load",t),$.Fn.set(e.channel+"_load",a),function i(){"function"==typeof r.contentWindow.sendMessage?n():o(i,50)}()};l=b({props:{src:e.local+"#_4"+e.channel},onLoad:t})},init:function(){u(i.onDOMReady,i)}}},$.stack.HashTransport=function(t){function n(e){if(h){var n=t.remote+"#"+f++ +"_"+e;(l||!w?h.contentWindow:h).location=n}}function r(e){p=e,s.up.incoming(p.substring(p.indexOf("_")+1),v)}function a(){if(g){var e=g.location.href,t="",n=e.indexOf("#");-1!=n&&(t=e.substring(n)),t&&t!=p&&r(t)}}function i(){c=setInterval(a,d)}var s,l,c,d,p,f,g,h,w,v;return s={outgoing:function(e){n(e)},destroy:function(){e.clearInterval(c),(l||!w)&&h.parentNode.removeChild(h),h=null},onDOMReady:function(){if(l=t.isHost,d=t.interval,p="#"+t.channel,f=0,w=t.useParent,v=m(t.remote),l){if(y(t.props,{src:t.remote,name:H+t.channel+"_provider"}),w)t.onLoad=function(){g=e,i(),s.up.callback(!0)};else{var n=0,r=t.delay/50;!function a(){if(++n>r)throw new Error("Unable to reference listenerwindow");try{g=h.contentWindow.frames[H+t.channel+"_consumer"]}catch(e){}g?(i(),s.up.callback(!0)):o(a,50)}()}h=b(t)}else g=e,i(),w?(h=parent,s.up.callback(!0)):(y(t,{props:{src:t.remote+"#"+t.channel+new Date,name:H+t.channel+"_consumer"},onLoad:function(){s.up.callback(!0)}}),h=b(t))},init:function(){u(s.onDOMReady,s)}}},$.stack.ReliableBehavior=function(){var e,t,n=0,o=0,r="";return e={incoming:function(a,i){var s=a.indexOf("_"),l=a.substring(0,s).split(",");a=a.substring(s+1),l[0]==n&&(r="",t&&(t(!0),t=null)),a.length>0&&(e.down.outgoing(l[1]+","+n+"_"+r,i),o!=l[1]&&(o=l[1],e.up.incoming(a,i)))},outgoing:function(a,i,s){r=a,t=s,e.down.outgoing(o+","+ ++n+"_"+a,i)}}},$.stack.QueueBehavior=function(e){function t(){if(e.remove&&0===s.length)return void P(n);if(!l&&0!==s.length&&!i){l=!0;var r=s.shift();n.down.outgoing(r.data,r.origin,function(e){l=!1,r.callback&&o(function(){r.callback(e)},0),t()})}}var n,i,s=[],l=!0,c="",d=0,u=!1,p=!1;return n={init:function(){_(e)&&(e={}),e.maxLength&&(d=e.maxLength,p=!0),e.lazy?u=!0:n.down.init()},callback:function(e){l=!1;var o=n.up;t(),o.callback(e)},incoming:function(t,o){if(p){var a=t.indexOf("_"),i=parseInt(t.substring(0,a),10);c+=t.substring(a+1),0===i&&(e.encode&&(c=r(c)),n.up.incoming(c,o),c="")}else n.up.incoming(t,o)},outgoing:function(o,r,i){e.encode&&(o=a(o));var l,c=[];if(p){for(;0!==o.length;)l=o.substring(0,d),o=o.substring(l.length),c.push(l);for(;l=c.shift();)s.push({data:c.length+"_"+l,origin:r,callback:0===c.length?i:null})}else s.push({data:o,origin:r,callback:i});u?n.down.init():t()},destroy:function(){i=!0,n.down.destroy()}}},$.stack.VerifyBehavior=function(e){function t(){o=Math.random().toString(16).substring(2),n.down.outgoing(o)}var n,o,r;return n={incoming:function(a,i){var s=a.indexOf("_");-1===s?a===o?n.up.callback(!0):r||(r=a,e.initiate||t(),n.down.outgoing(a)):a.substring(0,s)===r&&n.up.incoming(a.substring(s+1),i)},outgoing:function(e,t,r){n.down.outgoing(o+"_"+e,t,r)},callback:function(){e.initiate&&t()}}},$.stack.RpcBehavior=function(e,t){function n(e){e.jsonrpc="2.0",a.down.outgoing(i.stringify(e))}function o(e,t){var o=Array.prototype.slice;return function(){var r,a=arguments.length,i={method:t};a>0&&"function"==typeof arguments[a-1]?(a>1&&"function"==typeof arguments[a-2]?(r={success:arguments[a-2],error:arguments[a-1]},i.params=o.call(arguments,0,a-2)):(r={success:arguments[a-1]},i.params=o.call(arguments,0,a-1)),c[""+ ++s]=r,i.id=s):i.params=o.call(arguments,0),e.namedParams&&1===i.params.length&&(i.params=i.params[0]),n(i)}}function r(e,t,o,r){if(!o)return void(t&&n({id:t,error:{code:-32601,message:"Procedure not found."}}));var a,i;t?(a=function(e){a=D,n({id:t,result:e})},i=function(e,o){i=D;var r={id:t,error:{code:-32099,message:e}};o&&(r.error.data=o),n(r)}):a=i=D,l(r)||(r=[r]);try{var s=o.method.apply(o.scope,r.concat([a,i]));_(s)||a(s)}catch(c){i(c.message)}}var a,i=t.serializer||X(),s=0,c={};return a={incoming:function(e){var o=i.parse(e);if(o.method)t.handle?t.handle(o,n):r(o.method,o.id,t.local[o.method],o.params);else{var a=c[o.id];o.error?a.error&&a.error(o.error):a.success&&a.success(o.result),delete c[o.id]}},init:function(){if(t.remote)for(var n in t.remote)t.remote.hasOwnProperty(n)&&(e[n]=o(t.remote[n],n));a.down.init()},destroy:function(){for(var n in t.remote)t.remote.hasOwnProperty(n)&&e.hasOwnProperty(n)&&delete e[n];a.down.destroy()}}},I.easyXDM=$}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent),$(function(){twitterFeedAppModel=appModel.extend({defaults:function(){var e={twitterUsername:"@POWrPlugins",tweetNumber:5,rawResponseTimestamp:-1,titleText:"@POWrPlugins",titleAlign:"center",titleFontColor:"#333",titleBackgroundColor:"#EEE",titleFontFamily:"Open Sans",titleFontSize:"20px",tweetHeadSize:"",showHeader:!0,showUserHandle:!0,showDate:!0,userImage:"big",circularImageRadius:40,tweetHeaderBackgroundColor:"#4099ff",tweetHeaderFontColor:"#FFF",tweetHeaderFontFamily:"Open Sans",tweetHeaderFontSize:"10px",tweetBodyFontColor:"#333",tweetBodyFontFamily:"Open Sans",tweetBodyFontSize:"12px",tweetBodyBackgroundColor:"#DDD",tweetBorderColor:"#FFF",tweetBorderRadius:"3px",tweetBorderWidth:"0px",tweetSpacing:"7px",tweetButtons:"onmouseover",backgroundGradient:!1,backgroundColor:"#fff",backgroundStartColor:"#fff",backgroundEndColor:"#c0c0c0",backgroundBorderColor:"#c0c0c0",backgroundBorderRadius:"3px",backgroundBorderWidth:"0px",backgroundShadow:"none",pluginWidth:"450px",passwordProtectOn:!1,customCSS:"",customJS:"",locals:{tweets:[]}};return"wix"==HOST&&(e.titleFontColorWix="color-3",e.titleBackgroundColorWix="color-1",e.tweetHeaderBackgroundColorWix="color-2",e.tweetHeaderFontColorWix="color-4",e.tweetBodyFontColorWix="color-5",e.tweetBodyBackgroundColorWix="color-1",e.tweetBorderColorWix="color-3",e.backgroundColor="rgba(255, 255, 255, 0)",e.backgroundStartColorWix="color-1",e.backgroundEndColorWix="color-2",e.backgroundBorderWidth="0px",e.backgroundShadow="none",e.backgroundBorderColorWix="color-3"),e},presets:function(){var e={titleFontColor:"text-color-2",titleBackgroundColor:"background-color-2",tweetHeaderBackgroundColor:"text-color-2",tweetHeaderFontColor:"background-color-2",tweetBodyFontColor:"text-color-2",tweetBodyBackgroundColor:"background-color-2",tweetBorderColor:"accent-color",backgroundColor:"background-color-1",backgroundStartColor:"background-color-1",backgroundEndColor:"background-color-2",backgroundBorderColor:"accent-color",titleFontFamily:"header-font",tweetHeaderFontFamily:"text-font",tweetBodyFontFamily:"text-font"};return e},getTweets:function(){var e=this;$(".fetching").removeClass("hid");var t=e.meta.premium?15:60;if((new Date).valueOf()/1e3-(e.get("rawResponseTimestamp")||0)>60*t||"undefined"==typeof APP_SETTINGS){if(GET_WAIT_TIME=500,"undefined"==typeof TWEET_TIMER)var n=0;else{var n=1e3;clearTimeout(TWEET_TIMER)}TWEET_TIMER=setTimeout(function(){debug(2),e._getTweets()},n)}},_getTweets:function(){debug("Get tweets called");var e=this,t=this.get("twitterUsername"),n=function(e){if("string"!=typeof e&&(e=e.following),null==e||""==e)return debug("Username is null or blank"),{};var t="#"==e.substr(0,1);return("#"==e.substr(0,1)||"@"==e.substr(0,1))&&(e=e.substr(1,e.length)),{type:"twitter",following:(t?"#":"@")+e}},o=[];if("string"==typeof t)o=[n(t)];else for(i in t)o.push(n(t[i]));debug("Following data is",o);var r={url:cloudfrontNodeUri()+"/social-feed",type:"GET",data:{data:o,premium:e.meta.premium,app_id:e.meta.id}};$(".tweetErrors").slideDown(),ajaxController(r,function(t){t.success?t.done?(e.set("rawResponseTimestamp",t.timestamp),e.parseResponse(t.data)):("undefined"==typeof GET_WAIT_TIME?GET_WAIT_TIME=500:GET_WAIT_TIME*=1.5,setTimeout(function(){e._getTweets()},GET_WAIT_TIME)):$(".tweetErrors").text("Difficulty getting data, please try again or contact support.")})},parseResponse:function(e){var t=this;$(".fetching").addClass("hid"),debug("Parse response:",e);var n=t.get("twitterUsername");"string"==typeof n&&(n=[{following:n,priority:50}]);var o=[];for(var r in e){for(var a=e[r].response,i=0;i<a.length;i++){var s=a[i];s.priority=n[r].priority,s.usernameIndex=r,o.push(s)}if("undefined"!=typeof APP_SETTINGS){var l=$('[name="following"]').filter(function(){var t=this.value.toLowerCase();t=t.substr("@"==t.substr(0,1)?1:0);var n=e[r].following.toLowerCase();return n=n.substr("@"==n.substr(0,1)?1:0),t==n})[0],c="";"string"==typeof e[r].errors&&(e[r].errors=JSON.parse(e[r].errors)),debug("Errors are :",e[r].errors),c=void 0==e[r].errors||0==e[r].errors.length?a.length>0?"":"Nothing found for "+e[r].pageName:1==e[r].errors.length?e[r].errors[0]:JSON.stringify(c=e[r].errors),APP_SETTINGS.setInputErrors($(l),c)}}o.sort(function(e,t){if(!e)return 1;if(!t)return-1;var n=(new Date).valueOf()/1e3,o=10;return Math.pow(101-e.priority,o)*(n-e.post_date)-Math.pow(101-t.priority,o)*(n-t.post_date)}),t.setLocals({tweets:o}),t.triggerChange()},sortTweets:function(){var e=this,t=e.get("locals").tweets||[],n=e.get("twitterUsername");"string"==typeof n&&(n=[{following:n,priority:50}]);for(var o in t)t[o].priority=parseInt(n[t[o].usernameIndex].priority);t.sort(function(e,t){if(!e)return 1;if(!t)return-1;var n=(new Date).valueOf()/1e3,o=10;return Math.pow(101-e.priority,o)*(n-e.post_date)-Math.pow(101-t.priority,o)*(n-t.post_date)}),e.setLocals({tweets:t}),e.triggerChange()}}),twitterFeedAppSettings=appSettings.extend({afterInitialize:function(){var e=this;e.$el.on("click",".add, .delete",function(){e.checkAddAllowed()}),this.$el.on("keyup",'[name="following"]',function(){e.model.set({rawResponseTimestamp:0},{silent:!0}),e.setInputGetting($(this)),e.updateTweets()}),this.$el.on("change",'[name="priority"]',function(){e.model.sortTweets()}),"wix"==HOST&&e.model.getTweets(),e.afterAdd()},updateTweets:function(){var e=this,t=this.$el.find('[name="twitterUsername"]').val();this.model.set({twitterUsername:t},{silent:!0}),this.$el.find(".tweetErrors").hide(),"undefined"!=typeof UPDATE_TWEETS_TIMER&&clearTimeout(UPDATE_TWEETS_TIMER),UPDATE_TWEETS_TIMER=setTimeout(function(){e.model.getTweets()},300)},afterRender:function(){this.loadData(),this.updateConditionals(),this.initializeInputs()},afterUpdate:function(){var e=this;1==e.model.get("locals").render_style_only?this.model.triggerChange():(e.saveData(),this.model.triggerChange(),e.updateConditionals(),e.checkAddAllowed())},updateConditionals:function(){this.model.get("showHeader")?this.$el.find(".headerDetails").slideDown():this.$el.find(".headerDetails").slideUp()},loadData:function(){var e=this.model.get("twitterUsername");"string"==typeof e&&(e=[{following:e,priority:50}]);for(var t in e){var n=this.$el.find(".feedsWrapper").addPrototype(null,{speed:"instant"}),o=e[t];n.objectToForm(o),0==t&&n.find(".innerPanelToggle").click()}},saveData:function(){var e=[];this.$el.find(".feeds:not(.prototype)").each(function(){var t=$(this).formToObject();e.push(t)}),this.model.attributes.twitterUsername=e},afterAdd:function(){var e=this;e.checkAddAllowed();var t=this.$el.find(".prototype-wrapper").find('[name="priority"]');(null==t.val()||0==t.val())&&t.val(50),this.initializeInputs()},checkAddAllowed:function(){var e=this.model.get("twitterUsername");if("string"==typeof e)var t=1;else if(_.isEmpty(e))var t=0;else var t=e.length;var n=this.$el.find(".add");t>=1&&0==this.model.meta.premium?n.toggleClass("premium",!0):t>=5?n.hide():(n.show().toggleClass("premium",!1),n.tooltip("destroy")),this.updatePremiumContent()},setInputGetting:function(e){var t=APP_SETTINGS;""==$(e).val()?t.setInputErrors(e,""):t.setInputErrors(e,"Getting "+$(e).val()+" from Twitter...")},setInputErrors:function(e,t){debug("Setting errors to ",t);var n=e.parents(".innerPanelContent").find(".followingErrors");n.text(t),""==t?n.slideUp():n.slideDown()},initializeInputs:function(){this.updateInputFields(),this.initializePopovers(),this.initializeSliders()}}),twitterFeedAppView=appView.extend({afterCorrectPassword:function(){this.model.getTweets()},afterInitialize:function(){var e=this;debug("After initialize",e.model.get("locals")),(!e.model.get("passwordProtectOn")||e.model.get("locals").passwordProtectSuccess||e.model.get("locals").skipPassword)&&e.model.getTweets()},setMetaContent:function(){var e=this.model.get("titleText");this.writeMetaContent(e)},afterRender:function(){var e=this.$el,t=this.model;"onmouseover"==t.get("tweetButtons")?(e.find(".tweet").on("mouseover",function(){$(this).addClass("highlighted"),$(this).find(".twitterLinks").addClass("show"),$(this).find(".circular-profile").addClass("highlighted")}),e.find(".tweet").on("mouseout",function(){$(this).removeClass("highlighted"),$(this).find(".twitterLinks").removeClass("show"),$(this).find(".circular-profile").removeClass("highlighted")})):(e.find(".tweet").on("mouseover",function(){$(this).addClass("highlighted"),$(this).find(".circular-profile").addClass("highlighted")}),e.find(".tweet").on("mouseout",function(){$(this).removeClass("highlighted"),$(this).find(".circular-profile").removeClass("highlighted")}))}})}),$(function(){if($("#apps-view, #apps-facebook_view").length>0&&(loadView(),loadViewListeners()),$("#apps-cached_view").length>0)if(debug("In apps cached view"),loadViewListeners(),"async"==getURLParameter("load"))debug("Async loading"),LOAD_ME_INTERVAL=setInterval(function(){if("undefined"==typeof META||void 0==META){if("undefined"!=typeof PARENT_ORIGIN&&"undefined"!=typeof IFRAME_INDEX){var e={message:"loadMe",data:{iframe_index:IFRAME_INDEX}};
parent.postMessage(JSON.stringify(e),PARENT_ORIGIN)}}else clearInterval(LOAD_ME_INTERVAL)},5e3);else{var e="/plugins/"+APP_DETAILS.slug+"/view?";e+=getURLParameter("id")?"id="+getURLParameter("id")+".json":"powr_token="+getURLParameter("powr_token")+"&user_label="+getURLParameter("user_label"),getURLParameter("external_type")&&(e+="&external_type="+getURLParameter("external_type")),debug("Calling to get app json. Url is "+e),ajaxController({url:e,type:"GET"},function(e){e.success?(debug("Success getting view data"),META=e.meta,GLOBALS=e.globals,CONTENT=e.content,loadView()):debug("Error getting view data")})}$("#apps-wix_view").length>0&&("undefined"!=typeof WIX_LOCAL_APP_TYPE&&(wixLocalAppModel=window[WIX_LOCAL_APP_TYPE+"AppModel"],localDevAppModel=wixLocalAppModel,wixIeLocalAppModel=wixLocalAppModel),VIEW_MODE=Wix.Utils.getViewMode(),loadView("site"!=VIEW_MODE?{use_backup_content:!0}:{use_backup_content:!1}),Wix.addEventListener(Wix.Events.SETTINGS_UPDATED,function(e){debug("Wix settings updated:",e),APP_MODEL.attributes=e,APP_MODEL.meta.saved=!0,APP_VIEW.render()}),Wix.addEventListener(Wix.Events.SITE_PUBLISHED,function(){debug("site published"),APP_MODEL.doSave({post_params:{wix_published:!0}})}),Wix.addEventListener(Wix.Events.COMPONENT_DELETED,function(){debug("app deleted"),APP_MODEL.doSave({post_params:{wix_deleted:!0}})}),"site"==VIEW_MODE&&Wix.currentMember(function(e){debug("member details: ",e),"site"==VIEW_MODE&&e&&1==e.owner&&APP_MODEL.get("wix_admin_email")!=e.email&&(APP_MODEL.set({wix_admin_email:e.email},{silent:!0}),APP_MODEL.doSave())}))});